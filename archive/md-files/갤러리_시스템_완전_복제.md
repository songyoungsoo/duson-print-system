# 🖼️ 명함 페이지 갤러리 시스템 완전 복제

## 📋 개요
명함 페이지(`http://localhost/MlangPrintAuto/NameCard/index.php`)에 구현된 갤러리 시스템을 완전히 복제한 문서입니다. 이 시스템은 **적응형 이미지 표시**와 **부드러운 줌 효과**를 제공하는 고급 갤러리입니다.

## 🎯 주요 특징

### 1. **적응형 이미지 표시**
- 작은 이미지: 1:1 크기로 표시 (1.3배 확대)
- 큰 이미지: contain 방식으로 전체 비율 맞춤 (1.5배 확대)
- 자동 이미지 크기 분석 및 최적 표시 방식 선택

### 2. **부드러운 줌 효과**
- 마우스 이동에 따른 실시간 확대/이동
- lerp 계수 0.15를 사용한 부드러운 애니메이션
- requestAnimationFrame을 활용한 60fps 애니메이션

### 3. **썸네일 네비게이션**
- 클릭 가능한 썸네일 (80x80px)
- active 상태 표시 및 호버 효과
- 자동 첫 번째 이미지 로드

## 📁 파일 구조

```
MlangPrintAuto/NameCard/
├── index.php                    # 메인 페이지 (갤러리 포함)
├── get_namecard_images.php      # 이미지 데이터 AJAX 엔드포인트
└── (기타 명함 관련 파일들)
```

## 🔧 구현 코드

### 1. PHP 백엔드 (get_namecard_images.php)

```php
<?php
// 명함 이미지 가져오기 AJAX 엔드포인트
header('Content-Type: application/json; charset=utf-8');

// 데이터베이스 연결
include "../../db.php";

try {
    // 명함 카테고리 포트폴리오에서 최신 이미지 4개 가져오기
    $query = "SELECT Mlang_bbs_no, Mlang_bbs_title, Mlang_bbs_connent, Mlang_bbs_link 
              FROM Mlang_portfolio_bbs 
              WHERE Mlang_bbs_reply='0' AND CATEGORY='명함'
              ORDER BY Mlang_bbs_no DESC 
              LIMIT 4";
    
    $result = mysqli_query($db, $query);
    
    if (!$result) {
        throw new Exception("쿼리 실행 오류: " . mysqli_error($db));
    }
    
    $images = [];
    while ($row = mysqli_fetch_assoc($result)) {
        $image_path = '';
        $image_title = htmlspecialchars($row['Mlang_bbs_title'], ENT_QUOTES);
        
        // 이미지 경로 결정 (connent 우선, 없으면 link 사용)
        if (!empty($row['Mlang_bbs_connent'])) {
            $image_path = '/bbs/upload/portfolio/' . $row['Mlang_bbs_connent'];
        } else if (!empty($row['Mlang_bbs_link'])) {
            $image_path = $row['Mlang_bbs_link'];
        }
        
        // 이미지가 있는 경우에만 배열에 추가
        if (!empty($image_path)) {
            $images[] = [
                'id' => $row['Mlang_bbs_no'],
                'title' => $image_title,
                'path' => $image_path,
                'thumbnail' => $image_path // 썸네일도 같은 이미지 사용 (CSS로 크기 조정)
            ];
        }
    }
    
    // JSON 응답
    echo json_encode([
        'success' => true,
        'data' => $images,
        'count' => count($images)
    ], JSON_UNESCAPED_UNICODE);

} catch (Exception $e) {
    // 오류 응답
    echo json_encode([
        'success' => false,
        'message' => $e->getMessage(),
        'data' => []
    ], JSON_UNESCAPED_UNICODE);
} finally {
    // 데이터베이스 연결 종료
    if (isset($db)) {
        mysqli_close($db);
    }
}
?>
```

### 2. HTML 구조

```html
<!-- 이미지 갤러리 섹션 -->
<div class="image-gallery-section">
    <h4>🖼️ 명함 샘플</h4>
    
    <!-- 부드러운 확대 갤러리 -->
    <div class="gallery-container">
        <div class="zoom-box" id="zoomBox">
            <!-- 배경 이미지로 표시됩니다 -->
        </div>
        
        <!-- 썸네일 이미지들 -->
        <div class="thumbnails" id="thumbnailGrid">
            <!-- 썸네일들이 여기에 동적으로 로드됩니다 -->
        </div>
    </div>
    
    <!-- 로딩 상태 -->
    <div id="galleryLoading" class="gallery-loading">
        <p>이미지를 불러오는 중...</p>
    </div>
    
    <!-- 에러 상태 -->
    <div id="galleryError" class="gallery-error" style="display: none;">
        <p>이미지를 불러올 수 없습니다.</p>
    </div>
</div>
```

### 3. CSS 스타일

```css
/* 이미지 갤러리 스타일 - gallery3.php 방식 */
.image-gallery-section {
    margin-top: 30px;
}

.image-gallery-section h4 {
    margin: 0 0 20px 0;
    color: #495057;
    font-size: 1.1rem;
    font-weight: 600;
    text-align: center;
}

.gallery-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* 확대 박스: 420px 높이 - 적응형 이미지 표시 */
.zoom-box {
    width: 100%;
    height: 420px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    background-repeat: no-repeat;
    background-position: center center;
    background-size: contain; /* 이미지 전체가 보이도록 */
    background-color: #fff;
    will-change: background-position, background-size;
    cursor: crosshair;
    margin-bottom: 16px;
}

/* 썸네일 */
.thumbnails {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
}

.thumbnails img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid transparent;
    border-radius: 4px;
    transition: all 0.2s ease;
}

.thumbnails img.active {
    border-color: #667eea;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.thumbnails img:hover {
    border-color: #667eea;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.gallery-loading, .gallery-error {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
    font-style: italic;
}

.gallery-error {
    color: #dc3545;
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .zoom-box {
        height: 300px;
    }
}
```

### 4. JavaScript 핵심 로직

```javascript
// 이미지 갤러리 관련 변수들
let galleryImages = [];
let currentImageIndex = 0;

// 갤러리 줌 기능 초기화 - 적응형 이미지 표시 및 확대
let targetX = 50, targetY = 50;
let currentX = 50, currentY = 50;
let targetSize = 100, currentSize = 100;
let currentImageDimensions = { width: 0, height: 0 };
let currentImageType = 'large'; // 'small' 또는 'large'
let originalBackgroundSize = 'contain'; // 원래 배경 크기 저장

// 페이지 로드 시 갤러리 초기화
document.addEventListener('DOMContentLoaded', function() {
    // 이미지 갤러리 초기화
    loadImageGallery();
    initGalleryZoom();
    animate();
});

// === 이미지 갤러리 함수들 ===

// 이미지 갤러리 로드
function loadImageGallery() {
    const loadingElement = document.getElementById('galleryLoading');
    const errorElement = document.getElementById('galleryError');
    
    if (loadingElement) {
        loadingElement.style.display = 'block';
    }
    if (errorElement) {
        errorElement.style.display = 'none';
    }
    
    fetch('get_namecard_images.php')
    .then(response => response.json())
    .then(response => {
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
        
        if (response.success && response.data.length > 0) {
            galleryImages = response.data;
            createThumbnails();
            console.log('명함 갤러리 로드 완료:', response.count + '개 이미지');
        } else {
            showGalleryError('명함 샘플 이미지가 없습니다.');
        }
    })
    .catch(error => {
        if (loadingElement) {
            loadingElement.style.display = 'none';
        }
        
        showGalleryError('이미지를 불러오는 중 오류가 발생했습니다: ' + error.message);
    });
}

// 갤러리 오류 표시
function showGalleryError(message) {
    const errorElement = document.getElementById('galleryError');
    if (errorElement) {
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }
}

// 갤러리 줌 기능 초기화
function initGalleryZoom() {
    const zoomBox = document.getElementById('zoomBox');
    
    if (!zoomBox) return;
    
    // 마우스 이동 → 목표 포지션 & 사이즈 설정
    zoomBox.addEventListener('mousemove', e => {
        const { width, height, left, top } = zoomBox.getBoundingClientRect();
        const xPct = (e.clientX - left) / width * 100;
        const yPct = (e.clientY - top) / height * 100;
        targetX = xPct;
        targetY = yPct;
        
        // 이미지 타입에 따른 확대 비율 설정
        if (currentImageType === 'small') {
            targetSize = 130; // 작은 이미지: 1.3배 확대
        } else {
            targetSize = 150; // 큰 이미지: 1.5배 확대
        }
    });
    
    // 마우스 이탈 → 원상태로 복원
    zoomBox.addEventListener('mouseleave', () => {
        targetX = 50;
        targetY = 50;
        targetSize = 100;
    });
    
    console.log('갤러리 줌 기능 초기화 완료');
}

// 이미지 크기 분석 및 적응형 표시 설정
function analyzeImageSize(imagePath, callback) {
    const img = new Image();
    img.onload = function() {
        const containerHeight = 420; // 컨테이너 높이
        const containerWidth = document.getElementById('zoomBox').getBoundingClientRect().width;
        
        currentImageDimensions.width = this.naturalWidth;
        currentImageDimensions.height = this.naturalHeight;
        
        let backgroundSize;
        
        // 이미지가 420px 높이보다 작고 비율이 적절하면 1:1 표시
        if (this.naturalHeight <= containerHeight && this.naturalWidth <= containerWidth) {
            backgroundSize = `${this.naturalWidth}px ${this.naturalHeight}px`;
            currentImageType = 'small'; // 작은 이미지로 분류
            console.log('1:1 크기로 표시 (1.3배 확대):', backgroundSize);
        } else {
            // 이미지가 크면 contain으로 전체 모양 보이게
            backgroundSize = 'contain';
            currentImageType = 'large'; // 큰 이미지로 분류
            console.log('전체 비율 맞춤으로 표시 (1.5배 확대): contain');
        }
        
        callback(backgroundSize);
    };
    img.onerror = function() {
        console.log('이미지 로드 실패, 기본 contain 사용');
        currentImageType = 'large';
        callback('contain');
    };
    img.src = imagePath;
}

// 부드러운 애니메이션 루프
function animate() {
    const zoomBox = document.getElementById('zoomBox');
    if (!zoomBox) return;
    
    // lerp 계수: 0.15 → 부드러운 추적
    currentX += (targetX - currentX) * 0.15;
    currentY += (targetY - currentY) * 0.15;
    currentSize += (targetSize - currentSize) * 0.15;
    
    zoomBox.style.backgroundPosition = `${currentX}% ${currentY}%`;
    
    // 확대 시에는 항상 퍼센트 방식으로 처리
    if (currentSize > 100.1) { // 확대 중
        // 확대 시에는 이미지가 잘리도록 cover 방식 사용
        zoomBox.style.backgroundSize = `${currentSize}%`;
    } else { // 원래 크기로 복원 중
        // 원래 크기로 복원
        zoomBox.style.backgroundSize = originalBackgroundSize;
    }
    
    requestAnimationFrame(animate);
}

// 메인 이미지 업데이트 함수
function updateMainImage(index) {
    if (galleryImages.length === 0) return;
    
    const zoomBox = document.getElementById('zoomBox');
    const image = galleryImages[index];
    
    console.log('메인 이미지 업데이트:', image);
    
    // 이미지 크기 분석 후 적응형 표시
    analyzeImageSize(image.path, function(backgroundSize) {
        // 배경 이미지 및 크기 설정
        zoomBox.style.backgroundImage = `url('${image.path}')`;
        zoomBox.style.backgroundSize = backgroundSize;
        
        // 원래 배경 크기 저장 (애니메이션에서 사용)
        originalBackgroundSize = backgroundSize;
        
        console.log('이미지 적용 완료:', {
            path: image.path,
            size: backgroundSize,
            dimensions: currentImageDimensions
        });
    });
    
    currentImageIndex = index;
    
    // 타겟 상태 초기화
    targetSize = 100;
    targetX = 50;
    targetY = 50;
    
    // 썸네일 active 상태 업데이트
    updateThumbnailActive(index);
}

// 썸네일 생성 함수
function createThumbnails() {
    const thumbnailGrid = document.getElementById('thumbnailGrid');
    thumbnailGrid.innerHTML = '';
    
    galleryImages.forEach((image, index) => {
        const thumbnail = document.createElement('img');
        thumbnail.src = image.thumbnail;
        thumbnail.alt = image.title;
        thumbnail.className = index === 0 ? 'active' : '';
        thumbnail.title = image.title;
        thumbnail.dataset.src = image.path;
        
        // 썸네일 클릭 이벤트
        thumbnail.addEventListener('click', () => {
            // 모든 썸네일에서 active 클래스 제거
            const allThumbs = thumbnailGrid.querySelectorAll('img');
            allThumbs.forEach(t => t.classList.remove('active'));
            
            // 클릭된 썸네일에 active 클래스 추가
            thumbnail.classList.add('active');
            
            // 메인 이미지 업데이트
            updateMainImage(index);
        });
        
        thumbnailGrid.appendChild(thumbnail);
    });
    
    // 첫 번째 이미지로 초기화
    if (galleryImages.length > 0) {
        updateMainImage(0);
    }
    
    console.log('썸네일 생성 완료:', galleryImages.length + '개');
}

// 썸네일 active 상태 업데이트
function updateThumbnailActive(activeIndex) {
    const thumbnails = document.querySelectorAll('#thumbnailGrid img');
    thumbnails.forEach((thumb, index) => {
        if (index === activeIndex) {
            thumb.classList.add('active');
        } else {
            thumb.classList.remove('active');
        }
    });
}
```

## 🎯 핵심 기술 특징

### 1. **적응형 이미지 표시 알고리즘**
```javascript
// 이미지 크기에 따른 자동 표시 방식 결정
if (this.naturalHeight <= containerHeight && this.naturalWidth <= containerWidth) {
    backgroundSize = `${this.naturalWidth}px ${this.naturalHeight}px`; // 1:1 크기
    currentImageType = 'small'; // 1.3배 확대
} else {
    backgroundSize = 'contain'; // 전체 비율 맞춤
    currentImageType = 'large'; // 1.5배 확대
}
```

### 2. **부드러운 애니메이션 시스템**
```javascript
// lerp(Linear Interpolation) 기법 사용
currentX += (targetX - currentX) * 0.15;
currentY += (targetY - currentY) * 0.15;
currentSize += (targetSize - currentSize) * 0.15;

// 60fps 애니메이션 루프
requestAnimationFrame(animate);
```

### 3. **이미지 타입별 차별화된 확대**
- **작은 이미지**: 1.3배 확대 (세밀한 디테일 확인)
- **큰 이미지**: 1.5배 확대 (전체적인 구성 확인)

## 🔄 다른 품목에 적용하는 방법

### 1. **데이터베이스 쿼리 수정**
```php
// 품목별 카테고리 변경
$query = "SELECT Mlang_bbs_no, Mlang_bbs_title, Mlang_bbs_connent, Mlang_bbs_link 
          FROM Mlang_portfolio_bbs 
          WHERE Mlang_bbs_reply='0' AND CATEGORY='전단지'  -- 카테고리 변경
          ORDER BY Mlang_bbs_no DESC 
          LIMIT 4";
```

### 2. **파일명 변경**
- `get_namecard_images.php` → `get_leaflet_images.php`
- JavaScript에서 fetch URL 변경

### 3. **제목 및 메시지 변경**
```html
<h4>🖼️ 전단지 샘플</h4> <!-- 품목명 변경 -->
```

### 4. **CSS 클래스명 변경 (선택사항)**
- 품목별 고유한 스타일이 필요한 경우

## 📊 성능 최적화 포인트

### 1. **이미지 로딩 최적화**
- 썸네일과 원본 이미지 동일 사용 (CSS로 크기 조정)
- 이미지 preload 없이 필요 시점에 로드
- 오류 처리를 통한 안정성 확보

### 2. **애니메이션 최적화**
- `will-change` 속성으로 GPU 가속 활용
- `requestAnimationFrame` 사용으로 부드러운 60fps
- lerp 계수 0.15로 자연스러운 움직임

### 3. **메모리 관리**
- 이미지 객체 재사용
- 이벤트 리스너 적절한 관리
- 불필요한 DOM 조작 최소화

## 🎉 결론

이 갤러리 시스템은 다음과 같은 장점을 제공합니다:

1. **사용자 경험**: 부드러운 줌과 직관적인 네비게이션
2. **적응성**: 다양한 이미지 크기에 최적화된 표시
3. **성능**: 60fps 애니메이션과 효율적인 메모리 사용
4. **확장성**: 다른 품목에 쉽게 적용 가능
5. **안정성**: 오류 처리와 폴백 메커니즘 완비

이 시스템을 다른 품목 페이지에 적용하면 일관된 고품질 갤러리 경험을 제공할 수 있습니다.

---

**작성일**: 2025년 8월 9일  
**원본 위치**: `http://localhost/MlangPrintAuto/NameCard/index.php`  
**복제 완료**: 전체 갤러리 시스템 코드 및 기술 문서화  
**적용 가능**: 모든 품목 페이지