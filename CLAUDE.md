# MlangPrintAuto í”„ë¡œì íŠ¸ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” MlangPrintAuto ì¸ì‡„ ì£¼ë¬¸ ì‹œìŠ¤í…œì˜ êµ¬ì¡°ì™€ ê°œë°œ ê°€ì´ë“œë¼ì¸ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ“¦ ì‹œìŠ¤í…œ ê°œìš”

MlangPrintAutoëŠ” 9ê°œ í’ˆëª©ì˜ ì¸ì‡„ë¬¼ ì£¼ë¬¸ì„ ì²˜ë¦¬í•˜ëŠ” ì›¹ ê¸°ë°˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### 9ê°œ í’ˆëª© (í•„ìˆ˜ ì•”ê¸°)

1. **inserted** (ì „ë‹¨ì§€) - `/mlangprintauto/inserted/`
2. **sticker_new** (ìŠ¤í‹°ì»¤) - `/mlangprintauto/sticker_new/`
3. **envelope** (ë´‰íˆ¬) - `/mlangprintauto/envelope/`
4. **littleprint** (ì†ŒëŸ‰ì¸ì‡„ë¬¼) - `/mlangprintauto/littleprint/`
5. **cadarok** (ì¹´ë‹¤ë¡) - `/mlangprintauto/cadarok/`
6. **merchandisebond** (ìƒí’ˆê¶Œ) - `/mlangprintauto/merchandisebond/`
7. **namecard** (ëª…í•¨) - `/mlangprintauto/namecard/`
8. **msticker** (ìì„ìŠ¤í‹°ì»¤) - `/mlangprintauto/msticker/`
9. **ncrflambeau** (ì–‘ì‹ì§€) - `/mlangprintauto/ncrflambeau/`

**âš ï¸ ì¤‘ìš”**: ëª¨ë“  ì½”ë“œ ë³€ê²½, ë””ë²„ê¹…, ê¸°ëŠ¥ ì¶”ê°€ ì‹œ **9ê°œ í’ˆëª© ì „ì²´ë¥¼ í•­ìƒ ê³ ë ¤**í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸš¨ **ë§¤ìš° ì¤‘ìš”: leaflet ë””ë ‰í† ë¦¬ ì‚¬ìš© ê¸ˆì§€** ğŸš¨

**ì ˆëŒ€ leaflet ë””ë ‰í† ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”!**

- âŒ **ì‚¬ìš© ê¸ˆì§€**: `/mlangprintauto/leaflet/` - êµ¬ ë””ë ‰í† ë¦¬, í˜„ì¬ ì‚¬ìš© ì•ˆ í•¨
- âœ… **ì •ìƒ ì‚¬ìš©**: `/mlangprintauto/inserted/` - ì „ë‹¨ì§€(flyers)ì˜ ì˜¬ë°”ë¥¸ ë””ë ‰í† ë¦¬

**ì¤‘ìš” ì‚¬í•­**:
- `leaflet` ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•˜ì§€ë§Œ **ì™„ì „íˆ ë¬´ì‹œ**í•´ì•¼ í•©ë‹ˆë‹¤
- ì „ë‹¨ì§€ ê´€ë ¨ ì‘ì—…ì€ **ë¬´ì¡°ê±´ `inserted`ë§Œ ì‚¬ìš©**í•©ë‹ˆë‹¤
- ì´ í˜¼ë™ìœ¼ë¡œ ì¸í•´ ê³¼ê±° ë§ì€ ë””ë²„ê¹… ì‹œê°„ì´ ì†Œëª¨ë˜ì—ˆìŠµë‹ˆë‹¤
- **ì½”ë“œ ìˆ˜ì •, ê²€ìƒ‰, ë¶„ì„ ì‹œ leafletì€ ì œì™¸**í•˜ê³  insertedë§Œ ì‚¬ìš©í•˜ì„¸ìš”

**ì´ìœ **:
- leafletì€ ë ˆê±°ì‹œ ë””ë ‰í† ë¦¬ë¡œ í˜„ì¬ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- ëª¨ë“  ì „ë‹¨ì§€ ê¸°ëŠ¥ì€ insertedë¡œ í†µí•©ë¨
- leaflet ê´€ë ¨ ì½”ë“œ ìˆ˜ì •ì€ ì‹œê°„ ë‚­ë¹„ì…ë‹ˆë‹¤

---

## ğŸ—‚ï¸ íŒŒì¼ ì—…ë¡œë“œ ì‹œìŠ¤í…œ

### ì—…ë¡œë“œ ì‹œìŠ¤í…œ êµ¬ì„±

#### 1. upload_path_manager.php (í‘œì¤€ ì‹œìŠ¤í…œ)

**ì‚¬ìš© í’ˆëª©**: inserted, sticker_new, envelope, cadarok, merchandisebond, ncrflambeau

**ê²½ë¡œ êµ¬ì¡°**:
```
/ImgFolder/_MlangPrintAuto_{product}_index.php/YYYY/MMDD/IP/timestamp/
```

**ì£¼ìš” í•¨ìˆ˜**:
- `generateUploadPath($product_type)` - ì—…ë¡œë“œ ê²½ë¡œ ìƒì„±
- `createUploadDirectory($path)` - ë””ë ‰í† ë¦¬ ìƒì„±
- `generateUniqueFilename($original_filename, $timestamp)` - íŒŒì¼ëª… ìƒì„±

**íŒŒì¼ëª… í˜•ì‹**: `{random}{YYYYMMDDHHmmss}.{ext}`
ì˜ˆ: `4820251120145623.pdf`

**ì‚¬ìš© ì˜ˆì‹œ**:
```php
include "../../includes/upload_path_manager.php";

$upload_path_info = generateUploadPath('inserted');
$physical_path = $upload_path_info['physical_path'];  // ëì— '/' í¬í•¨ë¨
$img_folder = $upload_path_info['img_folder'];

$unique_filename = generateUniqueFilename($filename, $upload_path_info['timestamp']);
$target_path = $upload_path_info['physical_path'] . $unique_filename;  // '/' ì¶”ê°€ ë¶ˆí•„ìš”

if (move_uploaded_file($temp_file, $target_path)) {
    // ì„±ê³µ
}
```

#### 2. UploadPathHelper.php (í—¬í¼ í´ë˜ìŠ¤)

**ì‚¬ìš© í’ˆëª©**: namecard, msticker, littleprint

**ê²½ë¡œ êµ¬ì¡°**: ë™ì¼ (`/ImgFolder/_MlangPrintAuto_{product}_index.php/YYYY/MMDD/IP/timestamp/`)

**ì£¼ìš” ë©”ì„œë“œ**:
- `UploadPathHelper::generateUploadPath($product)` - ê²½ë¡œ ìƒì„±
- `UploadPathHelper::createDirectory($path)` - ë””ë ‰í† ë¦¬ ìƒì„±

**âš ï¸ ì¤‘ìš” ì°¨ì´ì **:
- `full_path`ì— **ë§ˆì§€ë§‰ `/`ê°€ í¬í•¨ë˜ì§€ ì•ŠìŒ**
- íŒŒì¼ ì €ì¥ ì‹œ **ë°˜ë“œì‹œ `'/' .`ë¥¼ ì¶”ê°€**í•´ì•¼ í•¨

**ì‚¬ìš© ì˜ˆì‹œ**:
```php
require_once __DIR__ . '/../../includes/UploadPathHelper.php';

$paths = UploadPathHelper::generateUploadPath('namecard');
$upload_folder = $paths['full_path'];  // ëì— '/' ì—†ìŒ!
$upload_folder_db = $paths['db_path'];

// âš ï¸ í•„ìˆ˜: '/' ì¶”ê°€
$target_path = $upload_folder . '/' . $target_filename;  // '/' ë°˜ë“œì‹œ ì¶”ê°€!
$web_url = '/ImgFolder/' . $upload_folder_db . '/' . $target_filename;  // '/' ë°˜ë“œì‹œ ì¶”ê°€!

if (move_uploaded_file($temp_file, $target_path)) {
    // ì„±ê³µ
}
```

### í’ˆëª©ë³„ ì—…ë¡œë“œ ì‹œìŠ¤í…œ ë§¤í•‘

| í’ˆëª© | ì—…ë¡œë“œ ì‹œìŠ¤í…œ | ê²½ë¡œì— `/` í¬í•¨ | íŒŒì¼ ì €ì¥ ì‹œ ì£¼ì˜ì‚¬í•­ |
|------|--------------|----------------|---------------------|
| inserted | upload_path_manager.php | âœ… Yes | `/` ì¶”ê°€ ë¶ˆí•„ìš” |
| sticker_new | upload_path_manager.php | âœ… Yes | `/` ì¶”ê°€ ë¶ˆí•„ìš” |
| envelope | upload_path_manager.php | âœ… Yes | `/` ì¶”ê°€ ë¶ˆí•„ìš” |
| cadarok | upload_path_manager.php | âœ… Yes | `/` ì¶”ê°€ ë¶ˆí•„ìš” |
| merchandisebond | upload_path_manager.php | âœ… Yes | `/` ì¶”ê°€ ë¶ˆí•„ìš” |
| ncrflambeau | upload_path_manager.php | âœ… Yes | `/` ì¶”ê°€ ë¶ˆí•„ìš” |
| namecard | UploadPathHelper | âŒ No | **`'/' .` í•„ìˆ˜ ì¶”ê°€** |
| msticker | UploadPathHelper | âŒ No | **`'/' .` í•„ìˆ˜ ì¶”ê°€** |
| littleprint | UploadPathHelper | âŒ No | **`'/' .` í•„ìˆ˜ ì¶”ê°€** |

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### ì£¼ìš” í…Œì´ë¸”

#### mlangorder_printauto (ì£¼ë¬¸ ì •ë³´)
- `no` - ì£¼ë¬¸ë²ˆí˜¸ (PK)
- `product_type` - í’ˆëª© íƒ€ì… (9ê°œ ì¤‘ í•˜ë‚˜)
- `ImgFolder` - ì—…ë¡œë“œ ê²½ë¡œ (ì˜ˆ: `_MlangPrintAuto_inserted_index.php/2025/1120/IP/timestamp`)
- `ThingCate` - ëŒ€í‘œ íŒŒì¼ëª…
- `uploaded_files` - JSON í˜•ì‹ íŒŒì¼ ì •ë³´ ë°°ì—´
- `st_price` - ì¸ì‡„ë¹„
- `st_price_vat` - ë¶€ê°€ì„¸ í¬í•¨ ê¸ˆì•¡

#### shop_temp (ì„ì‹œ ì¥ë°”êµ¬ë‹ˆ)
- mlangorder_printautoì™€ ë™ì¼í•œ êµ¬ì¡°
- ê²°ì œ ì™„ë£Œ ì‹œ mlangorder_printautoë¡œ ì´ë™

---

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### ê³µí†µ ëª¨ë‹¬ ì‹œìŠ¤í…œ

**íŒŒì¼**: `/includes/upload_modal.js`

**ì£¼ìš” í•¨ìˆ˜**:
- `window.openUploadModal()` - ì—…ë¡œë“œ ëª¨ë‹¬ ì—´ê¸°
- `window.closeUploadModal()` - ì—…ë¡œë“œ ëª¨ë‹¬ ë‹«ê¸°
- `window.processFiles(files)` - íŒŒì¼ ì²˜ë¦¬ (ê²€ì¦ + ë˜í¼ ê°ì²´ ìƒì„±)
- `window.addToBasketFromModal()` - ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ (ê° í’ˆëª©ë³„ í•¨ìˆ˜ í˜¸ì¶œ)

**íŒŒì¼ ë˜í¼ ê°ì²´ êµ¬ì¡°**:
```javascript
{
    id: 'timestamp_random',
    file: File,              // âš ï¸ ì‹¤ì œ File ê°ì²´ëŠ” ì—¬ê¸°!
    name: 'filename.jpg',
    size: '1.5 MB',
    type: '.jpg'
}
```

**âš ï¸ ì¤‘ìš”**: FormData ì „ì†¡ ì‹œ `fileObj.file`ì„ ì‚¬ìš©í•´ì•¼ í•¨
```javascript
// âŒ ì˜ëª»ëœ ì˜ˆ
formData.append("uploaded_files[]", fileObj);  // ë˜í¼ ê°ì²´ ì „ì†¡

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
formData.append("uploaded_files[]", fileObj.file);  // ì‹¤ì œ File ì „ì†¡
```

### í’ˆëª©ë³„ index.php íŒ¨í„´

ê° í’ˆëª©ì˜ `index.php`ëŠ” ë‹¤ìŒ í•¨ìˆ˜ë¥¼ êµ¬í˜„í•´ì•¼ í•©ë‹ˆë‹¤:

```javascript
// ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì²˜ë¦¬ (ëª¨ë‹¬ì—ì„œ í˜¸ì¶œ)
window.handleModalBasketAdd = function(uploadedFiles, onSuccess, onError) {
    const formData = new FormData();
    formData.append("action", "add_to_basket");
    formData.append("product_type", "{product}");

    // í’ˆëª©ë³„ í•„ë“œ ì¶”ê°€
    // ...

    // âš ï¸ ì¤‘ìš”: fileObj.file ì‚¬ìš©
    uploadedFiles.forEach((fileObj, index) => {
        formData.append("uploaded_files[]", fileObj.file);
    });

    fetch("add_to_basket.php", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            onSuccess(data);
        } else {
            onError(data.message);
        }
    })
    .catch(error => onError(error.message));
};
```

---

## ğŸ”§ ë°±ì—”ë“œ êµ¬ì¡°

### add_to_basket.php í‘œì¤€ íŒ¨í„´

```php
<?php
// 1. ì´ˆê¸°í™”
require_once __DIR__ . '/../../includes/safe_json_response.php';
header('Content-Type: application/json; charset=utf-8');
session_start();

include "../../includes/functions.php";
include "../../includes/upload_path_manager.php";  // ë˜ëŠ” UploadPathHelper
include "../../db.php";

// 2. ì—…ë¡œë“œ ê²½ë¡œ ìƒì„±
$upload_path_info = generateUploadPath('{product}');
$physical_path = $upload_path_info['physical_path'];
$img_folder = $upload_path_info['img_folder'];

// 3. ë””ë ‰í† ë¦¬ ìƒì„±
if (!createUploadDirectory($physical_path)) {
    safe_json_response(false, null, 'ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ ìƒì„± ì‹¤íŒ¨');
}

// 4. íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
$uploaded_files = [];
if (!empty($_FILES['uploaded_files'])) {
    // ë°°ì—´ ì •ê·œí™”
    $files_to_process = [];
    if (is_array($files['name'])) {
        for ($i = 0; $i < count($files['name']); $i++) {
            $files_to_process[] = [
                'name' => $files['name'][$i],
                'tmp_name' => $files['tmp_name'][$i],
                'error' => $files['error'][$i],
                'size' => $files['size'][$i]
            ];
        }
    } else {
        $files_to_process[] = $files;
    }

    foreach ($files_to_process as $file) {
        if ($file['error'] === UPLOAD_ERR_OK) {
            $unique_filename = generateUniqueFilename($file['name'], $upload_path_info['timestamp']);

            // upload_path_manager: '/' ì¶”ê°€ ë¶ˆí•„ìš”
            $target_path = $upload_path_info['physical_path'] . $unique_filename;

            // UploadPathHelper: '/' í•„ìˆ˜ ì¶”ê°€
            // $target_path = $upload_folder . '/' . $unique_filename;

            if (move_uploaded_file($file['tmp_name'], $target_path)) {
                $uploaded_files[] = [
                    'original_name' => $file['name'],
                    'saved_name' => $unique_filename,
                    'path' => $target_path,
                    'size' => $file['size']
                ];
            }
        }
    }
}

// 5. DB ì €ì¥
$thing_cate = !empty($uploaded_files) ? $uploaded_files[0]['saved_name'] : '';
$uploaded_files_json = json_encode($uploaded_files, JSON_UNESCAPED_UNICODE);

$insert_query = "INSERT INTO shop_temp (..., ImgFolder, ThingCate, uploaded_files) VALUES (?, ?, ?)";
$stmt = mysqli_prepare($db, $insert_query);
mysqli_stmt_bind_param($stmt, "sss", $img_folder, $thing_cate, $uploaded_files_json);
mysqli_stmt_execute($stmt);

// 6. ì‘ë‹µ
safe_json_response(true, [
    'basket_id' => mysqli_insert_id($db),
    'uploaded_files_count' => count($uploaded_files),
    'upload_path' => $img_folder
]);
?>
```

---

## ğŸš¨ ê³µí†µ ì£¼ì˜ì‚¬í•­

### 1. 9ê°œ í’ˆëª© ì¼ê´€ì„± ìœ ì§€

ëª¨ë“  ê¸°ëŠ¥ ì¶”ê°€/ìˆ˜ì • ì‹œ:
- âœ… 9ê°œ í’ˆëª© ëª¨ë‘ì— ë™ì¼í•˜ê²Œ ì ìš©
- âœ… í’ˆëª©ë³„ ì°¨ì´ì  ë¬¸ì„œí™”
- âœ… í…ŒìŠ¤íŠ¸ëŠ” 9ê°œ í’ˆëª© ëª¨ë‘ ìˆ˜í–‰

### 2. ê²½ë¡œ `/` ë¬¸ì œ ë°©ì§€

**upload_path_manager.php ì‚¬ìš© ì‹œ**:
```php
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ (physical_pathì— ì´ë¯¸ / í¬í•¨)
$target_path = $upload_path_info['physical_path'] . $unique_filename;
```

**UploadPathHelper ì‚¬ìš© ì‹œ**:
```php
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ (ë°˜ë“œì‹œ '/' ì¶”ê°€)
$target_path = $upload_folder . '/' . $target_filename;
$web_url = '/ImgFolder/' . $upload_folder_db . '/' . $target_filename;

// âŒ ì˜ëª»ëœ ì˜ˆ (íŒŒì¼ëª…ì´ í´ë”ëª…ì— ë¶™ìŒ)
$target_path = $upload_folder . $target_filename;  // .../1763607803filename.jpg
```

### 3. FormData íŒŒì¼ ì „ì†¡

```javascript
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
uploadedFiles.forEach((fileObj, index) => {
    formData.append("uploaded_files[]", fileObj.file);  // .file ì†ì„± ì‚¬ìš©
});

// âŒ ì˜ëª»ëœ ì˜ˆ
uploadedFiles.forEach((fileObj, index) => {
    formData.append("uploaded_files[]", fileObj);  // ë˜í¼ ê°ì²´ ì „ì†¡
});
```

### 4. íŒŒì¼ ë°°ì—´ ì²˜ë¦¬

PHPì—ì„œ FormData ë°°ì—´ ì¸ì‹:
```javascript
// âœ… ì˜¬ë°”ë¥¸ ì˜ˆ (PHPê°€ ìë™ìœ¼ë¡œ ë°°ì—´ ì¸ì‹)
formData.append("uploaded_files[]", file);

// âŒ ì˜ëª»ëœ ì˜ˆ (ë§ˆì§€ë§‰ íŒŒì¼ë§Œ ì €ì¥ë¨)
formData.append("uploaded_files[0]", file);
formData.append("uploaded_files[1]", file);
```

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
/var/www/html/
â”œâ”€â”€ mlangprintauto/
â”‚   â”œâ”€â”€ inserted/           # 1. ì „ë‹¨ì§€
â”‚   â”‚   â”œâ”€â”€ index.php
â”‚   â”‚   â””â”€â”€ add_to_basket.php
â”‚   â”œâ”€â”€ sticker_new/        # 2. ìŠ¤í‹°ì»¤
â”‚   â”œâ”€â”€ envelope/           # 3. ë´‰íˆ¬
â”‚   â”œâ”€â”€ littleprint/        # 4. ì†ŒëŸ‰ì¸ì‡„ë¬¼
â”‚   â”œâ”€â”€ cadarok/            # 5. ì¹´ë‹¤ë¡
â”‚   â”œâ”€â”€ merchandisebond/    # 6. ìƒí’ˆê¶Œ
â”‚   â”œâ”€â”€ namecard/           # 7. ëª…í•¨
â”‚   â”œâ”€â”€ msticker/           # 8. ìì„ìŠ¤í‹°ì»¤
â”‚   â””â”€â”€ ncrflambeau/        # 9. ì–‘ì‹ì§€
â”œâ”€â”€ includes/
â”‚   â”œâ”€â”€ upload_path_manager.php    # í‘œì¤€ ì—…ë¡œë“œ ì‹œìŠ¤í…œ
â”‚   â”œâ”€â”€ UploadPathHelper.php       # í—¬í¼ í´ë˜ìŠ¤ ì‹œìŠ¤í…œ
â”‚   â”œâ”€â”€ upload_modal.js            # ê³µí†µ ëª¨ë‹¬ JavaScript
â”‚   â”œâ”€â”€ functions.php
â”‚   â””â”€â”€ db.php
â”œâ”€â”€ admin/
â”‚   â””â”€â”€ mlangprintauto/
â”‚       â”œâ”€â”€ admin.php              # ì£¼ë¬¸ ê´€ë¦¬
â”‚       â””â”€â”€ download.php           # íŒŒì¼ ë‹¤ìš´ë¡œë“œ
â””â”€â”€ ImgFolder/
    â””â”€â”€ _MlangPrintAuto_{product}_index.php/
        â””â”€â”€ YYYY/MMDD/IP/timestamp/
            â””â”€â”€ files...
```

---

## ğŸ” ë””ë²„ê¹… ê°€ì´ë“œ

### íŒŒì¼ ì—…ë¡œë“œ ë¬¸ì œ ì§„ë‹¨

1. **í´ë”ëŠ” ìƒì„±ë˜ì§€ë§Œ íŒŒì¼ì´ ì—†ëŠ” ê²½ìš°**
   - ì›ì¸: ê²½ë¡œì— `/` ëˆ„ë½
   - í™•ì¸: `target_path` ë³€ìˆ˜ ì¶œë ¥
   - í•´ê²°: UploadPathHelper ì‚¬ìš© ì‹œ `'/' .` ì¶”ê°€

2. **íŒŒì¼ì€ ì €ì¥ë˜ì§€ë§Œ ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì•ˆ ë³´ì´ëŠ” ê²½ìš°**
   - ì›ì¸: `ImgFolder` DB ê°’ê³¼ ì‹¤ì œ ê²½ë¡œ ë¶ˆì¼ì¹˜
   - í™•ì¸: DBì˜ `ImgFolder` ì»¬ëŸ¼ ê°’
   - í•´ê²°: `$img_folder` ê°’ì´ ì˜¬ë°”ë¥´ê²Œ ì €ì¥ë˜ëŠ”ì§€ í™•ì¸

3. **ë‹¤ì¤‘ íŒŒì¼ ì¤‘ 1ê°œë§Œ ì €ì¥ë˜ëŠ” ê²½ìš°**
   - ì›ì¸: FormData ë°°ì—´ í‘œê¸°ë²• ì˜¤ë¥˜
   - í™•ì¸: `uploaded_files[]` vs `uploaded_files[0]`
   - í•´ê²°: `[]` ì‚¬ìš© (ì¸ë±ìŠ¤ ì—†ì´)

4. **íŒŒì¼ì´ ì „ì†¡ë˜ì§€ ì•ŠëŠ” ê²½ìš°**
   - ì›ì¸: `fileObj.file` ëŒ€ì‹  `fileObj` ì „ì†¡
   - í™•ì¸: JavaScript FormData êµ¬ì„± ì½”ë“œ
   - í•´ê²°: `fileObj.file` ì‚¬ìš©

---

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ

- [ ] 9ê°œ í’ˆëª© ëª¨ë‘ì— ì ìš©í–ˆëŠ”ê°€?
- [ ] upload_path_manager vs UploadPathHelper ì°¨ì´ ê³ ë ¤í–ˆëŠ”ê°€?
- [ ] ê²½ë¡œì— `/` ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í–ˆëŠ”ê°€?
- [ ] FormDataì—ì„œ `fileObj.file` ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] ë°°ì—´ í‘œê¸°ëŠ” `uploaded_files[]` ì‚¬ìš©í–ˆëŠ”ê°€?
- [ ] DB ì €ì¥ ì‹œ `ImgFolder`, `ThingCate` ì˜¬ë°”ë¥¸ê°€?
- [ ] ë¡œì»¬ê³¼ ì›¹ ì„œë²„ ëª¨ë‘ í…ŒìŠ¤íŠ¸í–ˆëŠ”ê°€?
- [ ] ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í™•ì¸í–ˆëŠ”ê°€?

---

## ğŸ“¦ íƒë°°ì£¼ì†Œë¡ ì‹œìŠ¤í…œ

### ì„œë²„ í™˜ê²½

#### dsp1830.shop (PHP 7.4, UTF-8)
- **ì£¼ë¬¸ ëª©ë¡**: http://dsp1830.shop/shop_admin/post_list74.php
- **ì—‘ì…€ ë‹¤ìš´ë¡œë“œ**: http://dsp1830.shop/shop_admin/export_excel74.php
- **ë°ì´í„°ë² ì´ìŠ¤**: dsp1830 / dsp1830 / ds701018
- **í…Œì´ë¸”**: `mlangorder_printauto` (ì†Œë¬¸ì)
- **ë¬¸ìì…‹**: UTF-8 (utf8mb4)

#### dsp114.com (PHP 5.2, EUC-KR)
- **ì£¼ë¬¸ ëª©ë¡**: http://dsp114.com/shop_admin/post_list52.php
- **ì—‘ì…€ ë‹¤ìš´ë¡œë“œ**: http://dsp114.com/shop_admin/export_excel52.php
- **ë°ì´í„°ë² ì´ìŠ¤**: duson1830 / duson1830 / du1830
- **í…Œì´ë¸”**: `MlangOrder_PrintAuto` (ëŒ€ì†Œë¬¸ì í˜¼í•©)
- **ë¬¸ìì…‹**: EUC-KR

### ì£¼ìš” ê¸°ëŠ¥

#### 1. ê²€ìƒ‰ ê¸°ëŠ¥
- **ì´ë¦„ ê²€ìƒ‰**: ìˆ˜í•˜ì¸ëª… ë˜ëŠ” íšŒì‚¬ëª…
- **ë‚ ì§œ ë²”ìœ„**: ì£¼ë¬¸ì¼ì‹œ ê¸°ì¤€
- **ì£¼ë¬¸ë²ˆí˜¸ ë²”ìœ„**: ì‹œì‘~ì¢…ë£Œ ë²ˆí˜¸
- **ì£¼ì†Œ í•„í„°**: `(zip1 like '%êµ¬%') or (zip2 like '%-%')`

#### 2. ë°ì´í„° í‘œì‹œ
- **í˜ì´ì§€ë‹¹**: 20ê°œ í•­ëª©
- **ì •ë ¬**: ì£¼ë¬¸ë²ˆí˜¸ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)
- **JSON íŒŒì‹±**: `formatted_display` ìë™ ì¶”ì¶œ
- **í¬ë§·**: í•œ ì¤„ í‘œì‹œ (| êµ¬ë¶„ì)

ì˜ˆì‹œ:
```
ì¹¼ë¼ì¸ì‡„(CMYK) | 90gì•„íŠ¸ì§€(í•©íŒì¸ì‡„) | A4 (210x297) | ë‹¨ë©´ | 1ë§¤ | ì¸ì‡„ë§Œ
```

#### 3. ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
- **í˜•ì‹**: UTF-8 BOM í¬í•¨ (.xls)
- **ì œì™¸ ì»¬ëŸ¼**: ì£¼ë¬¸ë²ˆí˜¸, ë‚ ì§œ (íƒë°°ì‚¬ ì–‘ì‹ í˜¸í™˜)
- **í¬í•¨ ì»¬ëŸ¼**: ìˆ˜í•˜ì¸ëª…, ìš°í¸ë²ˆí˜¸, ì£¼ì†Œ, ì „í™”, í•¸ë“œí°, ë°•ìŠ¤ìˆ˜ëŸ‰, íƒë°°ë¹„, ìš´ì„êµ¬ë¶„, í’ˆëª©ëª…, ê¸°íƒ€, ë°°ì†¡ë©”ì„¸ì§€
- **ë‹¤ìš´ë¡œë“œ ë°©ì‹**:
  - ì„ íƒ í•­ëª©ë§Œ (ì²´í¬ë°•ìŠ¤)
  - ì „ì²´ ë‹¤ìš´ë¡œë“œ (ê²€ìƒ‰ ì¡°ê±´ í¬í•¨)

### ë°ì´í„°ë² ì´ìŠ¤ í•„ë“œ

| í•„ë“œëª… | íƒ€ì… | ì„¤ëª… |
|--------|------|------|
| no | mediumint(8) | ì£¼ë¬¸ë²ˆí˜¸ (PK) |
| date | datetime | ì£¼ë¬¸ì¼ì‹œ |
| name | varchar(250) | ìˆ˜í•˜ì¸ëª… |
| bizname | varchar(50) | íšŒì‚¬ëª… |
| zip | varchar(10) | ìš°í¸ë²ˆí˜¸ |
| zip1 | varchar(250) | ì£¼ì†Œ1 |
| zip2 | varchar(250) | ì£¼ì†Œ2 |
| phone | varchar(20) | ì „í™”ë²ˆí˜¸ |
| Hendphone | varchar(20) | í•¸ë“œí° |
| Type | varchar(250) | í’ˆëª© íƒ€ì… |
| Type_1 | text | ì£¼ë¬¸ ìƒì„¸ (JSON) |
| ImgFolder | text | ì—…ë¡œë“œ ê²½ë¡œ |
| uploaded_files | text | íŒŒì¼ ëª©ë¡ (JSON) |

### ìˆ˜í•˜ì¸ëª… ì²˜ë¦¬ ë¡œì§

```php
// nameì´ "0"ì´ê±°ë‚˜ ë¹ˆê°’ì¸ ê²½ìš° ì²˜ë¦¬
if (name != '0' && !empty(name)) {
    í‘œì‹œ: name
} else if (!empty(bizname)) {
    í‘œì‹œ: bizname
} else {
    í‘œì‹œ: '-'
}
```

### JSON ë°ì´í„° ì²˜ë¦¬

#### ì…ë ¥ í˜•ì‹
```json
{
  "product_type": "inserted",
  "formatted_display": "ì¸ì‡„ìƒ‰ìƒ: ì¹¼ë¼ì¸ì‡„(CMYK)\nìš©ì§€: 90gì•„íŠ¸ì§€\nê·œê²©: A4 (210x297)\nì¸ì‡„ë©´: ë‹¨ë©´\nìˆ˜ëŸ‰: 1ë§¤\në””ìì¸: ì¸ì‡„ë§Œ"
}
```

#### ì¶œë ¥ í˜•ì‹
```php
// 1. "í•­ëª©ëª…: " ì œê±°
$formatted = preg_replace('/^[^:]+:\s*/m', '', $formatted);

// 2. ì¤„ë°”ê¿ˆì„ | ë¡œ ë³€ê²½
$formatted = str_replace("\n", ' | ', $formatted);

// ê²°ê³¼: "ì¹¼ë¼ì¸ì‡„(CMYK) | 90gì•„íŠ¸ì§€ | A4 (210x297) | ë‹¨ë©´ | 1ë§¤ | ì¸ì‡„ë§Œ"
```

### íŒŒì¼ êµ¬ì¡°

```
/shop_admin/
â”œâ”€â”€ post_list74.php          # ì£¼ë¬¸ ëª©ë¡ (PHP 7.4)
â”œâ”€â”€ export_excel74.php        # ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (PHP 7.4)
â”œâ”€â”€ post_list52.php          # ì£¼ë¬¸ ëª©ë¡ (PHP 5.2)
â”œâ”€â”€ export_excel52.php        # ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (PHP 5.2)
â”œâ”€â”€ lib.php                  # êµ¬ë²„ì „ DB ì—°ê²° (ì‚¬ìš© ì•ˆ í•¨)
â””â”€â”€ íƒë°°ì£¼ì†Œë¡_README.md      # ìƒì„¸ ë¬¸ì„œ
```

### í™˜ê²½ë³„ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

```php
// db.php ì‚¬ìš© (í™˜ê²½ ìë™ ê°ì§€)
include "../db.php";
$connect = $db;

// safe_mysqli_query ì‚¬ìš© (í…Œì´ë¸”ëª… ìë™ ë§¤í•‘)
$result = safe_mysqli_query($connect, $query);
```

### FTP ì—…ë¡œë“œ ëª…ë ¹

```bash
# dsp1830.shop ì—…ë¡œë“œ
curl -T /path/to/file.php ftp://dsp1830.shop/shop_admin/ --user dsp1830:ds701018

# ì—¬ëŸ¬ íŒŒì¼ ë™ì‹œ ì—…ë¡œë“œ
curl -T /tmp/post_list74.php ftp://dsp1830.shop/shop_admin/ --user dsp1830:ds701018 && \
curl -T /tmp/export_excel74.php ftp://dsp1830.shop/shop_admin/ --user dsp1830:ds701018
```

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

#### 1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜
- âœ… `db.php` ê²½ë¡œ: `include "../db.php";`
- âœ… `safe_mysqli_query()` í•¨ìˆ˜ ì‚¬ìš©
- âœ… ê³„ì • ì •ë³´: dsp1830 / ds701018

#### 2. í•œê¸€ ê¹¨ì§
- âœ… UTF-8 BOM í¬í•¨
- âœ… `mysqli_set_charset($db, 'utf8mb4');`
- âœ… HTML í—¤ë”: `<meta charset="utf-8">`

#### 3. ìˆ˜í•˜ì¸ëª… "0" í‘œì‹œ
- âœ… `bizname` ëŒ€ì²´ê°’ í™•ì¸
- âœ… ë¹ˆê°’ì€ "-" í‘œì‹œ

#### 4. JSON íŒŒì‹± ì˜¤ë¥˜
- âœ… JSON ì‹œì‘ í™•ì¸: `$data[0] == '{'`
- âœ… `json_decode($data, true)` ì‚¬ìš©
- âœ… `formatted_display` í‚¤ ì¡´ì¬ í™•ì¸

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

### ì¸ì‡„ ì£¼ë¬¸ ì‹œìŠ¤í…œ
- `/admin/mlangprintauto/admin.php` - ì£¼ë¬¸ ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤
- `/includes/upload_path_manager.php` - ì—…ë¡œë“œ ê²½ë¡œ ìƒì„± ë¡œì§
- `/includes/UploadPathHelper.php` - í—¬í¼ í´ë˜ìŠ¤ ì—…ë¡œë“œ ì‹œìŠ¤í…œ
- `/includes/upload_modal.js` - ê³µí†µ ëª¨ë‹¬ JavaScript

### íƒë°°ì£¼ì†Œë¡ ì‹œìŠ¤í…œ
- `/shop_admin/post_list74.php` - ì£¼ë¬¸ ëª©ë¡ (PHP 7.4, UTF-8)
- `/shop_admin/export_excel74.php` - ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (PHP 7.4)
- `/shop_admin/post_list52.php` - ì£¼ë¬¸ ëª©ë¡ (PHP 5.2, EUC-KR)
- `/shop_admin/export_excel52.php` - ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (PHP 5.2)
- `/shop_admin/íƒë°°ì£¼ì†Œë¡_README.md` - íƒë°°ì£¼ì†Œë¡ ìƒì„¸ ê°€ì´ë“œ
- `/db.php` - í™˜ê²½ë³„ ìë™ DB ì—°ê²°
- `/config.env.php` - í™˜ê²½ ì„¤ì • ê´€ë¦¬

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-27
**ì‘ì„±ì**: Claude Code Assistant
