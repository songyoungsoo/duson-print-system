# 관리자 페이지 주문내용 표시 오류 수정 구현 계획

## 구현 작업 목록

- [ ] 1. 주문 데이터 포맷팅 시스템 구축
  - OrderDataFormatter 클래스 생성하여 품목별 주문 정보를 표준화된 형식으로 변환
  - 카테고리 번호를 한글명으로 변환하는 getCategoryName 메서드 구현
  - 스티커, 카다록, 명함, 전단지 등 각 품목별 데이터 포맷팅 메서드 구현
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [x] 1.1 OrderDataFormatter 클래스 기본 구조 생성



  - `includes/OrderDataFormatter.php` 파일 생성
  - 데이터베이스 연결을 받는 생성자 구현
  - formatOrderData 메인 메서드 구현 (품목별 분기 처리)
  - _요구사항: 1.1_

- [ ] 1.2 카테고리 변환 기능 구현
  - getCategoryName 메서드로 mlangprintauto_transactioncate 테이블 조회
  - 캐싱 메커니즘 추가하여 성능 최적화
  - 존재하지 않는 카테고리 번호에 대한 예외 처리
  - _요구사항: 4.2_

- [ ] 1.3 스티커 데이터 포맷팅 구현
  - formatStickerData 메서드 구현
  - jong, garo, sero, mesu, domusong, uhyung 필드 처리
  - 크기 정보를 "가로×세로mm" 형식으로 표시
  - _요구사항: 1.3_

- [ ] 1.4 기타 품목 데이터 포맷팅 구현
  - formatCadarokData, formatNamecardData, formatLeafletData 메서드 구현
  - 각 품목의 특화 필드들을 적절한 형식으로 변환
  - 공통 필드(수량, 가격, 주문방법)에 대한 일관된 표시 형식 적용
  - _요구사항: 1.4, 4.1_

- [ ] 2. 주문 처리 시스템 개선
  - ProcessOrder_unified.php에서 OrderDataFormatter 사용하도록 수정
  - Type_1 필드에 JSON 형태로 구조화된 데이터 저장
  - 기존 텍스트 형식과의 호환성 유지



  - _요구사항: 1.1, 1.2_

- [ ] 2.1 ProcessOrder_unified.php 수정
  - OrderDataFormatter 클래스 include 추가
  - 각 장바구니 아이템 처리 시 formatOrderData 호출
  - JSON 형태로 구조화된 데이터를 Type_1 필드에 저장
  - _요구사항: 1.1, 1.2_

- [ ] 2.2 주문 데이터 저장 로직 개선
  - 품목별 상세 정보와 표시용 포맷된 텍스트를 함께 저장
  - 오류 발생 시 기존 방식으로 폴백하는 안전장치 구현
  - 저장 과정에서 발생하는 오류에 대한 상세 로깅 추가
  - _요구사항: 1.5_

- [ ] 3. 관리자 페이지 표시 시스템 구축
  - OrderDisplayManager 클래스 생성하여 주문 정보 표시 로직 관리
  - JSON 데이터와 기존 텍스트 데이터 모두 처리 가능한 파싱 로직 구현
  - 빈 데이터나 손상된 데이터에 대한 적절한 표시 처리
  - _요구사항: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 3.1 OrderDisplayManager 클래스 생성
  - `includes/OrderDisplayManager.php` 파일 생성
  - formatOrderForDisplay 메인 메서드 구현
  - JSON 데이터와 텍스트 데이터 구분 처리 로직
  - _요구사항: 2.1_

- [ ] 3.2 주문 정보 HTML 포맷팅 구현
  - 품목별로 적절한 HTML 구조로 변환하는 메서드들 구현
  - 가격 정보에 천단위 콤마와 "원" 단위 표시
  - 수량 정보에 적절한 단위(매, 부, 권) 표시
  - _요구사항: 4.3, 4.4_

- [ ] 3.3 빈 데이터 및 오류 처리
  - generateEmptyOrderDisplay 메서드로 빈 주문 정보 표시
  - 데이터 파싱 오류 시 원본 데이터와 함께 오류 메시지 표시
  - 사용자 친화적인 오류 메시지 및 복구 안내 제공
  - _요구사항: 2.5, 4.5_

- [x] 4. OrderFormOrderTree.php 업데이트



  - 기존 단순 텍스트 표시를 OrderDisplayManager 사용으로 변경
  - 주문 상세 정보를 구조화된 HTML 테이블로 표시
  - 가격 정보와 주문 상태 정보를 분리하여 명확하게 표시
  - _요구사항: 2.1, 2.2, 2.3_

- [ ] 4.1 OrderFormOrderTree.php 기본 구조 수정
  - OrderDisplayManager 클래스 include 추가
  - 기존 textarea 방식에서 구조화된 HTML 표시로 변경
  - 주문 정보와 가격 정보를 별도 섹션으로 분리


  - _요구사항: 2.1_

- [ ] 4.2 주문 상세 정보 표시 개선
  - 품목별로 적절한 레이아웃으로 정보 표시
  - 카테고리 번호를 한글명으로 변환하여 표시
  - 누락된 정보에 대해서는 "-" 또는 "정보 없음"으로 표시
  - _요구사항: 2.2, 2.3, 4.5_

- [ ] 4.3 가격 정보 표시 개선
  - money_1~money_5 필드를 명확한 라벨과 함께 표시
  - 천단위 콤마 적용 및 "원" 단위 표시
  - 주문 상태(OrderStyle)를 한글로 변환하여 표시
  - _요구사항: 4.3_

- [ ] 5. 디버깅 도구 시스템 구축
  - OrderDebugger 클래스 생성하여 주문 과정 추적 및 로깅
  - 특정 주문 번호의 전체 데이터 흐름을 추적하는 도구 구현
  - 관리자가 사용할 수 있는 디버그 페이지 생성



  - _요구사항: 3.1, 3.2, 3.3, 3.4, 3.5_

- [ ] 5.1 OrderDebugger 클래스 생성
  - `includes/OrderDebugger.php` 파일 생성
  - 주문 저장 과정 로깅 메서드 구현
  - 주문 조회 과정 로깅 메서드 구현
  - _요구사항: 3.1, 3.2_

- [ ] 5.2 주문 데이터 흐름 추적 도구 구현
  - traceOrderFlow 메서드로 특정 주문의 전체 데이터 추적
  - 주문 테이블, 업로드 파일, 장바구니 히스토리 통합 조회
  - 추적 결과를 JSON 형태로 반환하여 분석 용이하게 구성
  - _요구사항: 3.5_

- [ ] 5.3 관리자용 디버그 페이지 생성
  - `admin/MlangPrintAuto/debug_order_display.php` 파일 생성
  - 특정 주문 번호 입력하여 데이터 흐름 확인 기능
  - 주문 데이터 파싱 테스트 및 결과 표시 기능
  - _요구사항: 3.3, 3.4_

- [ ] 6. 오류 처리 및 로깅 시스템 강화
  - 모든 주요 메서드에 try-catch 블록 추가
  - 오류 발생 시 상세한 로그 기록 및 사용자 친화적 메시지 표시
  - 데이터 손상 시 복구 가능한 정보 제공
  - _요구사항: 1.5, 5.1, 5.2, 5.3, 5.4_

- [ ] 6.1 예외 처리 클래스 생성
  - `includes/OrderException.php` 파일 생성
  - 주문 관련 예외 상황에 대한 전용 Exception 클래스
  - 오류 코드와 사용자 메시지를 구분하여 관리
  - _요구사항: 1.5_

- [ ] 6.2 로깅 시스템 구현
  - 주문 저장, 조회, 표시 과정의 모든 단계에 로깅 추가
  - 로그 파일 로테이션 및 크기 관리 기능
  - 오류 발생 시 자동 알림 시스템 (이메일 또는 관리자 대시보드)
  - _요구사항: 3.1, 3.2, 3.4_

- [ ] 6.3 데이터 복구 도구 구현
  - 손상된 주문 데이터를 가능한 범위에서 복원하는 도구
  - 장바구니 히스토리나 로그를 통한 데이터 재구성 기능
  - 관리자가 수동으로 주문 정보를 수정할 수 있는 인터페이스
  - _요구사항: 5.3, 5.4_

- [ ] 7. 테스트 시스템 구축
  - 단위 테스트: 각 클래스와 메서드의 개별 기능 테스트
  - 통합 테스트: 주문 생성부터 관리자 페이지 표시까지 전체 플로우 테스트
  - 데이터 무결성 테스트: 기존 주문 데이터의 표시 가능성 검증
  - _요구사항: 모든 요구사항 검증_

- [ ] 7.1 단위 테스트 구현
  - `tests/OrderDataFormatterTest.php` 생성
  - `tests/OrderDisplayManagerTest.php` 생성
  - 각 품목별 데이터 포맷팅 기능 테스트
  - _요구사항: 1.1, 1.2, 1.3, 1.4_

- [ ] 7.2 통합 테스트 구현
  - `tests/OrderFlowIntegrationTest.php` 생성
  - 주문 생성부터 관리자 페이지 표시까지 전체 플로우 테스트
  - 다양한 품목과 데이터 조합에 대한 테스트 케이스 작성
  - _요구사항: 2.1, 2.2, 2.3_

- [ ] 7.3 기존 데이터 호환성 테스트
  - `tests/LegacyDataCompatibilityTest.php` 생성
  - 기존 주문 데이터가 새로운 시스템에서 올바르게 표시되는지 검증
  - 데이터 마이그레이션 필요성 및 방법 결정
  - _요구사항: 5.5_

- [ ] 8. 성능 최적화 및 캐싱
  - 카테고리 이름 변환 결과 캐싱으로 데이터베이스 쿼리 최소화
  - 자주 조회되는 주문 정보에 대한 캐싱 메커니즘 구현
  - 대용량 주문 데이터 처리 시 메모리 사용량 최적화
  - _요구사항: 성능 및 확장성_

- [ ] 8.1 카테고리 캐싱 시스템 구현
  - `includes/CategoryCache.php` 파일 생성
  - 메모리 기반 카테고리 이름 캐싱
  - 캐시 무효화 및 갱신 메커니즘
  - _요구사항: 4.2_

- [ ] 8.2 주문 정보 캐싱 구현
  - 포맷된 주문 정보를 임시 저장하여 재사용
  - 캐시 만료 시간 설정 및 자동 갱신
  - 메모리 사용량 모니터링 및 제한
  - _요구사항: 성능 최적화_

- [ ] 9. 문서화 및 배포 준비
  - 새로운 시스템의 사용법 및 유지보수 가이드 작성
  - 기존 시스템에서 새 시스템으로의 마이그레이션 계획 수립
  - 배포 체크리스트 및 롤백 계획 준비
  - _요구사항: 유지보수성 및 확장성_

- [ ] 9.1 사용자 매뉴얼 작성
  - 관리자용 주문 관리 가이드 작성
  - 디버깅 도구 사용법 문서화
  - 문제 해결 FAQ 및 트러블슈팅 가이드
  - _요구사항: 사용성_

- [ ] 9.2 개발자 문서 작성
  - 새로운 클래스들의 API 문서 생성
  - 코드 구조 및 확장 방법 가이드
  - 새로운 품목 추가 시 필요한 작업 절차
  - _요구사항: 확장성_

- [ ] 9.3 배포 계획 수립
  - 단계별 배포 전략 (개발 → 테스트 → 운영)
  - 데이터베이스 백업 및 복원 절차
  - 배포 후 모니터링 및 검증 체크리스트
  - _요구사항: 안정성_

- [ ] 10. 모니터링 및 알림 시스템 구축
  - 주문 처리 실패율 모니터링
  - 관리자 페이지 오류 발생 시 자동 알림
  - 시스템 성능 지표 수집 및 대시보드 구성
  - _요구사항: 운영 안정성_

- [ ] 10.1 모니터링 대시보드 구현
  - `admin/MlangPrintAuto/monitoring_dashboard.php` 생성
  - 주문 처리 통계 및 오류율 표시
  - 시스템 성능 지표 실시간 모니터링
  - _요구사항: 운영 모니터링_

- [ ] 10.2 자동 알림 시스템 구현
  - 오류 발생 시 관리자 이메일 발송
  - 임계치 초과 시 SMS 또는 슬랙 알림
  - 알림 설정 관리 인터페이스
  - _요구사항: 장애 대응_