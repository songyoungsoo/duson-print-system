<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ì¶”ê°€ì˜µì…˜ ì´ë²¤íŠ¸ ì§„ë‹¨</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 15px; }
        .diagnostic-section { margin: 30px 0; padding: 20px; border: 2px solid #ecf0f1; border-radius: 8px; }
        .diagnostic-section h2 { color: #16a085; margin-top: 0; }
        .result-box { padding: 15px; margin: 10px 0; border-radius: 5px; font-family: 'Courier New', monospace; }
        .success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        button { background: #3498db; color: white; border: none; padding: 12px 24px; margin: 5px; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: bold; }
        button:hover { background: #2980b9; }
        .test-iframe { width: 100%; height: 600px; border: 2px solid #3498db; border-radius: 5px; margin: 20px 0; }
        .log-container { background: #263238; color: #aed581; padding: 20px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 13px; max-height: 500px; overflow-y: auto; margin: 20px 0; }
        .log-entry { margin: 5px 0; padding: 5px; border-left: 3px solid #4CAF50; }
        .log-error { border-left-color: #f44336; color: #ff6b6b; }
        .log-warning { border-left-color: #ff9800; color: #ffa726; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #3498db; color: white; font-weight: bold; }
        tr:hover { background: #f5f5f5; }
        .step-number { background: #3498db; color: white; border-radius: 50%; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; }
        .code-block { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 10px 0; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ì¶”ê°€ì˜µì…˜ ì´ë²¤íŠ¸ ë°”ì¸ë”© ì§„ë‹¨ ì‹œìŠ¤í…œ</h1>

        <div class="result-box info">
            <strong>ğŸ“Œ ëª©ì :</strong> ì „ë‹¨ì§€ í˜ì´ì§€ì˜ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ë°”ì¸ë”©ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ ë‹¨ê³„ë³„ë¡œ ì§„ë‹¨í•©ë‹ˆë‹¤.<br>
            <strong>âš¡ íŠ¹ì§•:</strong> iframeì„ í†µí•´ ì‹¤ì œ í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ê³  JavaScript ì‹¤í–‰ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
        </div>

        <!-- ì§„ë‹¨ ì»¨íŠ¸ë¡¤ -->
        <div class="diagnostic-section">
            <h2>ğŸ® ì§„ë‹¨ ì‹¤í–‰</h2>
            <button onclick="runDiagnostic1()">ì§„ë‹¨ 1ï¸âƒ£ - í˜ì´ì§€ ë¡œë“œ ë° ìš”ì†Œ í™•ì¸</button>
            <button onclick="runDiagnostic2()">ì§„ë‹¨ 2ï¸âƒ£ - JavaScript í•¨ìˆ˜ ì¡´ì¬ í™•ì¸</button>
            <button onclick="runDiagnostic3()">ì§„ë‹¨ 3ï¸âƒ£ - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í™•ì¸</button>
            <button onclick="runDiagnostic4()">ì§„ë‹¨ 4ï¸âƒ£ - ìˆ˜ë™ ì²´í¬ë°•ìŠ¤ íŠ¸ë¦¬ê±°</button>
            <button onclick="runDiagnostic5()">ì§„ë‹¨ 5ï¸âƒ£ - ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</button>
            <button onclick="clearLog()" style="background: #e74c3c;">ë¡œê·¸ ì´ˆê¸°í™”</button>
        </div>

        <!-- ì§„ë‹¨ ë¡œê·¸ -->
        <div class="diagnostic-section">
            <h2>ğŸ“ ì§„ë‹¨ ë¡œê·¸</h2>
            <div id="logContainer" class="log-container">
                <div class="log-entry">ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ. ì§„ë‹¨ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
            </div>
        </div>

        <!-- ì§„ë‹¨ ê²°ê³¼ -->
        <div class="diagnostic-section">
            <h2>ğŸ“Š ì§„ë‹¨ ê²°ê³¼</h2>
            <div id="resultsContainer"></div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ iframe -->
        <div class="diagnostic-section">
            <h2>ğŸ–¼ï¸ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ (iframe)</h2>
            <div class="result-box warning">
                <strong>âš ï¸ ì£¼ì˜:</strong> ì•„ë˜ iframeì—ì„œ ì²´í¬ë°•ìŠ¤ë¥¼ ì§ì ‘ í´ë¦­í•´ë³´ê³ , ìœ„ì˜ ì§„ë‹¨ ë²„íŠ¼ë“¤ì„ ëˆŒëŸ¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.
            </div>
            <iframe id="testFrame" src="index.php" class="test-iframe"></iframe>
        </div>
    </div>

    <script>
        const logContainer = document.getElementById('logContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        let logIndex = 0;

        function log(message, type = 'info') {
            logIndex++;
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = 'log-entry' + (type === 'error' ? ' log-error' : type === 'warning' ? ' log-warning' : '');
            entry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function showResult(title, content, type = 'info') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result-box ${type}`;
            resultDiv.innerHTML = `<strong>${title}</strong><br>${content}`;
            resultsContainer.appendChild(resultDiv);
        }

        function clearLog() {
            logContainer.innerHTML = '<div class="log-entry">ë¡œê·¸ ì´ˆê¸°í™”ë¨</div>';
            resultsContainer.innerHTML = '';
            logIndex = 0;
        }

        function getIframeDoc() {
            const iframe = document.getElementById('testFrame');
            return iframe.contentDocument || iframe.contentWindow.document;
        }

        function getIframeWindow() {
            return document.getElementById('testFrame').contentWindow;
        }

        // ì§„ë‹¨ 1: í˜ì´ì§€ ë¡œë“œ ë° ìš”ì†Œ í™•ì¸
        function runDiagnostic1() {
            log('ğŸ” [ì§„ë‹¨ 1] í˜ì´ì§€ ë¡œë“œ ë° ìš”ì†Œ í™•ì¸ ì‹œì‘');
            const doc = getIframeDoc();
            const win = getIframeWindow();

            // 1. HTML ìš”ì†Œ ì¡´ì¬ í™•ì¸
            const section = doc.getElementById('additionalOptionsSection');
            const checkboxes = doc.querySelectorAll('.option-toggle');
            const coatingCheckbox = doc.getElementById('coating_enabled');
            const foldingCheckbox = doc.getElementById('folding_enabled');
            const creasingCheckbox = doc.getElementById('creasing_enabled');

            log(`âœ… additionalOptionsSection: ${!!section ? 'ì¡´ì¬' : 'âŒ ì—†ìŒ'}`);
            log(`âœ… .option-toggle ì²´í¬ë°•ìŠ¤ ê°œìˆ˜: ${checkboxes.length}`);
            log(`âœ… coating_enabled: ${!!coatingCheckbox ? 'ì¡´ì¬' : 'âŒ ì—†ìŒ'}`);
            log(`âœ… folding_enabled: ${!!foldingCheckbox ? 'ì¡´ì¬' : 'âŒ ì—†ìŒ'}`);
            log(`âœ… creasing_enabled: ${!!creasingCheckbox ? 'ì¡´ì¬' : 'âŒ ì—†ìŒ'}`);

            // 2. Hidden í•„ë“œ í™•ì¸
            const hiddenFields = ['coating_price', 'folding_price', 'creasing_price', 'additional_options_total'];
            log(`ğŸ” Hidden í•„ë“œ í™•ì¸:`);
            hiddenFields.forEach(field => {
                const element = doc.getElementById(field);
                log(`  - ${field}: ${!!element ? 'ì¡´ì¬ (value=' + element.value + ')' : 'âŒ ì—†ìŒ'}`);
            });

            // ê²°ê³¼ ìš”ì•½
            if (section && checkboxes.length === 3) {
                showResult('âœ… ì§„ë‹¨ 1 í†µê³¼',
                    `HTML êµ¬ì¡°ê°€ ì •ìƒì…ë‹ˆë‹¤.<br>
                    - ì¶”ê°€ì˜µì…˜ ì„¹ì…˜: ì¡´ì¬<br>
                    - ì²´í¬ë°•ìŠ¤: ${checkboxes.length}ê°œ<br>
                    - Hidden í•„ë“œ: ëª¨ë‘ ì¡´ì¬`, 'success');
            } else {
                showResult('âŒ ì§„ë‹¨ 1 ì‹¤íŒ¨',
                    `HTML êµ¬ì¡°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.<br>
                    - ì¶”ê°€ì˜µì…˜ ì„¹ì…˜: ${!!section}<br>
                    - ì²´í¬ë°•ìŠ¤: ${checkboxes.length}ê°œ (ì˜ˆìƒ: 3ê°œ)`, 'error');
            }
        }

        // ì§„ë‹¨ 2: JavaScript í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
        function runDiagnostic2() {
            log('ğŸ” [ì§„ë‹¨ 2] JavaScript í•¨ìˆ˜ ë° ê°ì²´ í™•ì¸ ì‹œì‘');
            const win = getIframeWindow();

            // 1. ì „ì—­ í•¨ìˆ˜ í™•ì¸
            const functions = [
                'initAdditionalOptions',
                'getAdditionalOptionsTotal',
                'updateAdditionalOptionsQuantity',
                'calculatePrice'
            ];

            log(`ğŸ“¦ ì „ì—­ í•¨ìˆ˜ í™•ì¸:`);
            functions.forEach(func => {
                const exists = typeof win[func] === 'function';
                log(`  - ${func}: ${exists ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}`, exists ? 'info' : 'error');
            });

            // 2. AdditionalOptionsManager í´ë˜ìŠ¤ í™•ì¸
            const hasClass = typeof win.AdditionalOptionsManager === 'function';
            log(`ğŸ“¦ AdditionalOptionsManager í´ë˜ìŠ¤: ${hasClass ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}`, hasClass ? 'info' : 'error');

            // 3. additionalOptionsManager ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
            const hasInstance = typeof win.additionalOptionsManager !== 'undefined';
            log(`ğŸ“¦ additionalOptionsManager ì¸ìŠ¤í„´ìŠ¤: ${hasInstance ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}`, hasInstance ? 'info' : 'warning');

            // ê²°ê³¼ ìš”ì•½
            const allFunctionsExist = functions.every(func => typeof win[func] === 'function');
            if (allFunctionsExist && hasClass) {
                showResult('âœ… ì§„ë‹¨ 2 í†µê³¼',
                    `JavaScript í•¨ìˆ˜ë“¤ì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                    - ì „ì—­ í•¨ìˆ˜: ëª¨ë‘ ì¡´ì¬<br>
                    - AdditionalOptionsManager: ë¡œë“œë¨<br>
                    - ì¸ìŠ¤í„´ìŠ¤: ${hasInstance ? 'ìƒì„±ë¨' : 'ì•„ì§ ìƒì„± ì•ˆë¨ (DOMContentLoaded ëŒ€ê¸° ì¤‘ì¼ ìˆ˜ ìˆìŒ)'}`, 'success');
            } else {
                showResult('âŒ ì§„ë‹¨ 2 ì‹¤íŒ¨',
                    `JavaScript ë¡œë”©ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.<br>
                    - additional-options.jsê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'error');
            }
        }

        // ì§„ë‹¨ 3: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í™•ì¸
        function runDiagnostic3() {
            log('ğŸ” [ì§„ë‹¨ 3] ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”© í™•ì¸ ì‹œì‘');
            const doc = getIframeDoc();
            const win = getIframeWindow();

            // 1. ì²´í¬ë°•ìŠ¤ ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
            const checkboxes = doc.querySelectorAll('.option-toggle');
            log(`ğŸ“‹ ì²´í¬ë°•ìŠ¤ ${checkboxes.length}ê°œ ë°œê²¬`);

            // 2. ê° ì²´í¬ë°•ìŠ¤ì— ì„ì‹œ ì´ë²¤íŠ¸ ì¶”ê°€í•˜ì—¬ ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ í™•ì¸
            let eventListenersAttached = 0;
            checkboxes.forEach((checkbox, index) => {
                log(`  ì²´í¬ë°•ìŠ¤ [${index}] ID: ${checkbox.id}`);

                // ì„ì‹œë¡œ change ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                const testEvent = new Event('change', { bubbles: true });
                const beforeValue = checkbox.checked;

                // ì›ë˜ ìƒíƒœ ê¸°ì–µ
                const originalChecked = checkbox.checked;

                // ì²´í¬ ìƒíƒœ í† ê¸€
                checkbox.checked = !checkbox.checked;
                checkbox.dispatchEvent(testEvent);

                // ì›ìƒë³µêµ¬
                checkbox.checked = originalChecked;

                // Hidden í•„ë“œ ê°’ í™•ì¸
                const hiddenFieldId = checkbox.id.replace('_enabled', '_price');
                const hiddenField = doc.getElementById(hiddenFieldId);
                if (hiddenField) {
                    log(`    â†’ Hidden í•„ë“œ ${hiddenFieldId}: ${hiddenField.value}ì›`);
                }
            });

            // 3. initAdditionalOptions í˜¸ì¶œ ì—¬ë¶€ í™•ì¸
            if (typeof win.additionalOptionsManager !== 'undefined') {
                log(`âœ… additionalOptionsManager ì¸ìŠ¤í„´ìŠ¤ ì¡´ì¬ - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë°”ì¸ë”©ë˜ì—ˆì„ ê°€ëŠ¥ì„± ë†’ìŒ`);
                showResult('âœ… ì§„ë‹¨ 3 í†µê³¼',
                    `ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì •ìƒì ìœ¼ë¡œ ë°”ì¸ë”©ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                    - additionalOptionsManager ì¸ìŠ¤í„´ìŠ¤ ì¡´ì¬<br>
                    - ì²´í¬ë°•ìŠ¤ ${checkboxes.length}ê°œ ê°ì§€ë¨`, 'success');
            } else {
                log(`âš ï¸ additionalOptionsManager ì¸ìŠ¤í„´ìŠ¤ ì—†ìŒ - ì´ˆê¸°í™”ê°€ ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŒ`, 'warning');
                showResult('âš ï¸ ì§„ë‹¨ 3 ê²½ê³ ',
                    `ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>
                    - DOMContentLoadedê°€ ì•„ì§ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ê±°ë‚˜<br>
                    - JavaScript ì˜¤ë¥˜ë¡œ ì´ˆê¸°í™”ê°€ ì‹¤íŒ¨í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`, 'warning');
            }
        }

        // ì§„ë‹¨ 4: ìˆ˜ë™ ì²´í¬ë°•ìŠ¤ íŠ¸ë¦¬ê±°
        function runDiagnostic4() {
            log('ğŸ” [ì§„ë‹¨ 4] ìˆ˜ë™ ì²´í¬ë°•ìŠ¤ íŠ¸ë¦¬ê±° í…ŒìŠ¤íŠ¸');
            const doc = getIframeDoc();
            const win = getIframeWindow();

            const coatingCheckbox = doc.getElementById('coating_enabled');
            if (!coatingCheckbox) {
                log('âŒ ì½”íŒ… ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
                showResult('âŒ ì§„ë‹¨ 4 ì‹¤íŒ¨', 'ì½”íŒ… ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            log(`ğŸ“ ì½”íŒ… ì²´í¬ë°•ìŠ¤ í˜„ì¬ ìƒíƒœ: ${coatingCheckbox.checked ? 'checked' : 'unchecked'}`);

            // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
            coatingCheckbox.checked = true;
            coatingCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
            log(`âœ… ì½”íŒ… ì²´í¬ë°•ìŠ¤ë¥¼ checkedë¡œ ë³€ê²½í•˜ê³  change ì´ë²¤íŠ¸ ë°œìƒ`);

            // 1ì´ˆ í›„ ê²°ê³¼ í™•ì¸
            setTimeout(() => {
                const coatingOptions = doc.getElementById('coating_options');
                const coatingPrice = doc.getElementById('coating_price');
                const additionalTotal = doc.getElementById('additional_options_total');

                log(`ğŸ“Š ê²°ê³¼ í™•ì¸:`);
                log(`  - coating_options display: ${coatingOptions ? coatingOptions.style.display : 'element not found'}`);
                log(`  - coating_price value: ${coatingPrice ? coatingPrice.value : 'element not found'}ì›`);
                log(`  - additional_options_total value: ${additionalTotal ? additionalTotal.value : 'element not found'}ì›`);

                if (coatingOptions && coatingOptions.style.display !== 'none') {
                    showResult('âœ… ì§„ë‹¨ 4 í†µê³¼',
                        `ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.<br>
                        - ì½”íŒ… ì˜µì…˜ ìƒì„¸ê°€ í‘œì‹œë¨<br>
                        - ê°€ê²© ì—…ë°ì´íŠ¸: ${coatingPrice ? coatingPrice.value : '0'}ì›`, 'success');
                } else {
                    showResult('âŒ ì§„ë‹¨ 4 ì‹¤íŒ¨',
                        `ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ê°€ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                        - ì½”íŒ… ì˜µì…˜ ìƒì„¸ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ<br>
                        - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë°”ì¸ë”©ë˜ì§€ ì•Šì•˜ì„ ê°€ëŠ¥ì„±`, 'error');
                }

                // ì›ìƒë³µêµ¬
                coatingCheckbox.checked = false;
                coatingCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
            }, 1000);
        }

        // ì§„ë‹¨ 5: ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
        function runDiagnostic5() {
            log('ğŸ” [ì§„ë‹¨ 5] ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            clearLog();

            setTimeout(() => runDiagnostic1(), 500);
            setTimeout(() => runDiagnostic2(), 1500);
            setTimeout(() => runDiagnostic3(), 2500);
            setTimeout(() => runDiagnostic4(), 3500);
            setTimeout(() => {
                log('âœ… ì „ì²´ ì§„ë‹¨ ì™„ë£Œ!');
                showResult('ğŸ‰ ì „ì²´ ì§„ë‹¨ ì™„ë£Œ',
                    'ëª¨ë“  ì§„ë‹¨ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'info');
            }, 5500);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.addEventListener('load', function() {
            log('âœ… ì§„ë‹¨ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('ğŸ’¡ ì›í•˜ëŠ” ì§„ë‹¨ ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜, "ì§„ë‹¨ 5ï¸âƒ£"ë¥¼ ëˆŒëŸ¬ ì „ì²´ ì§„ë‹¨ì„ ì‹¤í–‰í•˜ì„¸ìš”.');
        });
    </script>
</body>
</html>
