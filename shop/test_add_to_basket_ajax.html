<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ AJAX í…ŒìŠ¤íŠ¸</title>
</head>
<body>
    <h2>ğŸ§ª ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ AJAX í…ŒìŠ¤íŠ¸</h2>
    
    <form id="testForm">
        <table border="1" style="border-collapse: collapse;">
            <tr>
                <td>ì¬ì§ˆ:</td>
                <td>
                    <select name="jong" id="jong">
                        <option value="jil ì•„íŠ¸ìœ ê´‘ì½”íŒ…">jil ì•„íŠ¸ìœ ê´‘ì½”íŒ…</option>
                        <option value="jil ì•„íŠ¸ë¬´ê´‘ì½”íŒ…">jil ì•„íŠ¸ë¬´ê´‘ì½”íŒ…</option>
                        <option value="jka ê°•ì ‘ì•„íŠ¸ìœ ê´‘ì½”íŒ…">jka ê°•ì ‘ì•„íŠ¸ìœ ê´‘ì½”íŒ…</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>ê°€ë¡œ(mm):</td>
                <td><input type="number" name="garo" id="garo" value="100"></td>
            </tr>
            <tr>
                <td>ì„¸ë¡œ(mm):</td>
                <td><input type="number" name="sero" id="sero" value="150"></td>
            </tr>
            <tr>
                <td>ìˆ˜ëŸ‰:</td>
                <td><input type="number" name="mesu" id="mesu" value="1000"></td>
            </tr>
            <tr>
                <td>ìœ í˜•:</td>
                <td><input type="number" name="uhyung" id="uhyung" value="0"></td>
            </tr>
            <tr>
                <td>ë„ë¬´ì†¡:</td>
                <td>
                    <select name="domusong" id="domusong">
                        <option value="00000 ì‚¬ê°">00000 ì‚¬ê°</option>
                        <option value="08000 ì›í˜•">08000 ì›í˜•</option>
                        <option value="12000 íƒ€ì›í˜•">12000 íƒ€ì›í˜•</option>
                    </select>
                </td>
            </tr>
        </table>
        <br>
        <button type="button" onclick="testAddToBasket()">ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€</button>
    </form>
    
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; display: none;">
        <h3>ê²°ê³¼:</h3>
        <div id="result-content"></div>
    </div>
    
    <div id="error" style="margin-top: 20px; padding: 10px; background: #ffebee; border-radius: 5px; color: red; display: none;">
        <h3>ì˜¤ë¥˜:</h3>
        <div id="error-content"></div>
    </div>

    <script>
    function testAddToBasket() {
        const form = document.getElementById('testForm');
        const formData = new FormData(form);
        
        // action íŒŒë¼ë¯¸í„° ì¶”ê°€
        formData.set('action', 'add_to_basket');
        formData.set('no', ''); // ë¹ˆ ê°’ìœ¼ë¡œ ì„¤ì •
        
        console.log('ì „ì†¡ ë°ì´í„°:');
        for (let [key, value] of formData.entries()) {
            console.log(key + ': ' + value);
        }
        
        fetch('add_to_basket.php', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers);
            return response.text(); // JSON ëŒ€ì‹  textë¡œ ë¨¼ì € ë°›ì•„ë³´ê¸°
        })
        .then(text => {
            console.log('Raw response:', text);
            
            // JSON íŒŒì‹± ì‹œë„
            try {
                const data = JSON.parse(text);
                console.log('Parsed JSON:', data);
                
                document.getElementById('error').style.display = 'none';
                
                if (data.success) {
                    document.getElementById('result-content').innerHTML = 
                        '<strong>ì„±ê³µ!</strong><br>' + data.message;
                    document.getElementById('result').style.display = 'block';
                } else {
                    document.getElementById('error-content').innerHTML = data.message;
                    document.getElementById('error').style.display = 'block';
                }
            } catch (e) {
                console.error('JSON parse error:', e);
                document.getElementById('error-content').innerHTML = 
                    'JSON íŒŒì‹± ì˜¤ë¥˜. ì„œë²„ ì‘ë‹µ:<br><pre>' + text + '</pre>';
                document.getElementById('error').style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Fetch error:', error);
            document.getElementById('error-content').innerHTML = 
                'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message;
            document.getElementById('error').style.display = 'block';
        });
    }
    </script>
</body>
</html>