<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>장바구니 추가 AJAX 테스트</title>
</head>
<body>
    <h2>🧪 장바구니 추가 AJAX 테스트</h2>
    
    <form id="testForm">
        <table border="1" style="border-collapse: collapse;">
            <tr>
                <td>재질:</td>
                <td>
                    <select name="jong" id="jong">
                        <option value="jil 아트유광코팅">jil 아트유광코팅</option>
                        <option value="jil 아트무광코팅">jil 아트무광코팅</option>
                        <option value="jka 강접아트유광코팅">jka 강접아트유광코팅</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>가로(mm):</td>
                <td><input type="number" name="garo" id="garo" value="100"></td>
            </tr>
            <tr>
                <td>세로(mm):</td>
                <td><input type="number" name="sero" id="sero" value="150"></td>
            </tr>
            <tr>
                <td>수량:</td>
                <td><input type="number" name="mesu" id="mesu" value="1000"></td>
            </tr>
            <tr>
                <td>유형:</td>
                <td><input type="number" name="uhyung" id="uhyung" value="0"></td>
            </tr>
            <tr>
                <td>도무송:</td>
                <td>
                    <select name="domusong" id="domusong">
                        <option value="00000 사각">00000 사각</option>
                        <option value="08000 원형">08000 원형</option>
                        <option value="12000 타원형">12000 타원형</option>
                    </select>
                </td>
            </tr>
        </table>
        <br>
        <button type="button" onclick="testAddToBasket()">장바구니에 추가</button>
    </form>
    
    <div id="result" style="margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px; display: none;">
        <h3>결과:</h3>
        <div id="result-content"></div>
    </div>
    
    <div id="error" style="margin-top: 20px; padding: 10px; background: #ffebee; border-radius: 5px; color: red; display: none;">
        <h3>오류:</h3>
        <div id="error-content"></div>
    </div>

    <script>
    function testAddToBasket() {
        const form = document.getElementById('testForm');
        const formData = new FormData(form);
        
        // action 파라미터 추가
        formData.set('action', 'add_to_basket');
        formData.set('no', ''); // 빈 값으로 설정
        
        console.log('전송 데이터:');
        for (let [key, value] of formData.entries()) {
            console.log(key + ': ' + value);
        }
        
        fetch('add_to_basket.php', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            console.log('Response status:', response.status);
            console.log('Response headers:', response.headers);
            return response.text(); // JSON 대신 text로 먼저 받아보기
        })
        .then(text => {
            console.log('Raw response:', text);
            
            // JSON 파싱 시도
            try {
                const data = JSON.parse(text);
                console.log('Parsed JSON:', data);
                
                document.getElementById('error').style.display = 'none';
                
                if (data.success) {
                    document.getElementById('result-content').innerHTML = 
                        '<strong>성공!</strong><br>' + data.message;
                    document.getElementById('result').style.display = 'block';
                } else {
                    document.getElementById('error-content').innerHTML = data.message;
                    document.getElementById('error').style.display = 'block';
                }
            } catch (e) {
                console.error('JSON parse error:', e);
                document.getElementById('error-content').innerHTML = 
                    'JSON 파싱 오류. 서버 응답:<br><pre>' + text + '</pre>';
                document.getElementById('error').style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Fetch error:', error);
            document.getElementById('error-content').innerHTML = 
                '네트워크 오류: ' + error.message;
            document.getElementById('error').style.display = 'block';
        });
    }
    </script>
</body>
</html>