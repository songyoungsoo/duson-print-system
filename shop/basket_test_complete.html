<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ì‹œìŠ¤í…œ ì¢…í•© í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4CAF50; }
        .error { background: #ffebee; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196F3; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #FF6B35; color: white; }
        .btn-danger { background: #f44336; color: white; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f0f0f0; }
        input, select { padding: 5px; margin: 2px; }
    </style>
</head>
<body>
    <h1>ğŸ›’ ì¥ë°”êµ¬ë‹ˆ ì‹œìŠ¤í…œ ì¢…í•© í…ŒìŠ¤íŠ¸</h1>
    
    <!-- 1. ìƒí’ˆ ì¶”ê°€ ì„¹ì…˜ -->
    <div class="section info">
        <h2>1. ìƒí’ˆ ì¶”ê°€</h2>
        <form id="productForm">
            <table>
                <tr>
                    <td>ì¬ì§ˆ:</td>
                    <td>
                        <select name="jong">
                            <option value="jil ì•„íŠ¸ìœ ê´‘ì½”íŒ…">jil ì•„íŠ¸ìœ ê´‘ì½”íŒ…</option>
                            <option value="jil ì•„íŠ¸ë¬´ê´‘ì½”íŒ…">jil ì•„íŠ¸ë¬´ê´‘ì½”íŒ…</option>
                            <option value="jka ê°•ì ‘ì•„íŠ¸ìœ ê´‘ì½”íŒ…">jka ê°•ì ‘ì•„íŠ¸ìœ ê´‘ì½”íŒ…</option>
                            <option value="jsp íˆ¬ëª…ìŠ¤í‹°ì»¤">jsp íˆ¬ëª…ìŠ¤í‹°ì»¤</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>ê°€ë¡œ(mm):</td>
                    <td><input type="number" name="garo" value="100" min="1"></td>
                </tr>
                <tr>
                    <td>ì„¸ë¡œ(mm):</td>
                    <td><input type="number" name="sero" value="150" min="1"></td>
                </tr>
                <tr>
                    <td>ìˆ˜ëŸ‰:</td>
                    <td>
                        <select name="mesu">
                            <option value="500">500ë§¤</option>
                            <option value="1000" selected>1000ë§¤</option>
                            <option value="2000">2000ë§¤</option>
                            <option value="5000">5000ë§¤</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>í¸ì§‘:</td>
                    <td>
                        <select name="uhyung">
                            <option value="0">ì¸ì‡„ë§Œ</option>
                            <option value="10000">ë””ìì¸+ì¸ì‡„</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>ë„ë¬´ì†¡:</td>
                    <td>
                        <select name="domusong">
                            <option value="00000 ì‚¬ê°">ê¸°ë³¸ì‚¬ê°í˜•</option>
                            <option value="08000 ì›í˜•">ì›í˜•</option>
                            <option value="08000 íƒ€ì›">íƒ€ì›í˜•</option>
                            <option value="19000 ë³µì¡">ëª¨ì–‘ë„ë¬´ì†¡</option>
                        </select>
                    </td>
                </tr>
            </table>
            <button type="button" class="btn-primary" onclick="calculatePrice()">ê°€ê²© ê³„ì‚°</button>
            <button type="button" class="btn-secondary" onclick="addToBasket()">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</button>
        </form>
        
        <div id="priceResult" style="display:none; margin-top:10px; padding:10px; background:#f9f9f9; border-radius:3px;">
            <strong>ê³„ì‚° ê²°ê³¼:</strong>
            <span id="priceDisplay"></span>
        </div>
    </div>
    
    <!-- 2. ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ì„¹ì…˜ -->
    <div class="section">
        <h2>2. ì¥ë°”êµ¬ë‹ˆ ëª©ë¡</h2>
        <button type="button" class="btn-primary" onclick="loadBasket()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        <button type="button" class="btn-danger" onclick="clearBasket()">ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°</button>
        
        <div id="basketContent">
            <p>ì¥ë°”êµ¬ë‹ˆë¥¼ ë¡œë“œí•˜ë ¤ë©´ "ëª©ë¡ ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
        </div>
    </div>
    
    <!-- 3. ê²°ê³¼ ë©”ì‹œì§€ ì„¹ì…˜ -->
    <div id="messageSection" class="section" style="display:none;">
        <h2>ê²°ê³¼ ë©”ì‹œì§€</h2>
        <div id="messageContent"></div>
    </div>

    <script>
    // ê°€ê²© ê³„ì‚° í•¨ìˆ˜
    function calculatePrice() {
        const form = document.getElementById('productForm');
        const formData = new FormData(form);
        formData.set('action', 'calculate');
        
        fetch('calculate_price.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('priceDisplay').innerHTML = 
                    'ê°€ê²©: ' + data.price + 'ì› | VAT í¬í•¨: ' + data.price_vat + 'ì›';
                document.getElementById('priceResult').style.display = 'block';
                showMessage('ê°€ê²© ê³„ì‚° ì™„ë£Œ!', 'success');
            } else {
                showMessage('ê°€ê²© ê³„ì‚° ì˜¤ë¥˜: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('ê°€ê²© ê³„ì‚° ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message, 'error');
        });
    }
    
    // ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€
    function addToBasket() {
        const form = document.getElementById('productForm');
        const formData = new FormData(form);
        formData.set('action', 'add_to_basket');
        formData.set('no', '');
        
        fetch('add_to_basket_simple.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage('ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                loadBasket(); // ìë™ìœ¼ë¡œ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else {
                showMessage('ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì˜¤ë¥˜: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message, 'error');
        });
    }
    
    // ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ ë¡œë“œ
    function loadBasket() {
        fetch('get_basket_items.php')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayBasket(data.items, data.total, data.total_vat);
                showMessage('ì¥ë°”êµ¬ë‹ˆ ëª©ë¡ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.', 'success');
            } else {
                showMessage('ì¥ë°”êµ¬ë‹ˆ ë¡œë“œ ì˜¤ë¥˜: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('ì¥ë°”êµ¬ë‹ˆ ë¡œë“œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message, 'error');
        });
    }
    
    // ì¥ë°”êµ¬ë‹ˆ í™”ë©´ í‘œì‹œ
    function displayBasket(items, total, totalVat) {
        let html = '';
        
        if (items.length === 0) {
            html = '<p>ğŸ“­ ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>';
        } else {
            html = '<table>';
            html += '<tr><th>NO</th><th>ì¬ì§ˆ</th><th>ê°€ë¡œ</th><th>ì„¸ë¡œ</th><th>ìˆ˜ëŸ‰</th><th>ë„ë¬´ì†¡</th><th>í¸ì§‘ë¹„</th><th>ê°€ê²©</th><th>VATí¬í•¨</th><th>ì‚­ì œ</th></tr>';
            
            items.forEach(item => {
                html += '<tr>';
                html += '<td>' + item.no + '</td>';
                html += '<td>' + item.jong_short + '</td>';
                html += '<td>' + item.garo + '</td>';
                html += '<td>' + item.sero + '</td>';
                html += '<td>' + item.mesu + '</td>';
                html += '<td>' + item.domusong_short + '</td>';
                html += '<td>' + item.uhyung + '</td>';
                html += '<td><strong>' + item.st_price + '</strong></td>';
                html += '<td><strong>' + item.st_price_vat + '</strong></td>';
                html += '<td><button class="btn-danger" onclick="removeItem(' + item.no + ')">ì‚­ì œ</button></td>';
                html += '</tr>';
            });
            
            html += '<tr style="background:#e8f5e8; font-weight:bold;">';
            html += '<td colspan="7">í•©ê³„</td>';
            html += '<td>ï¿¦' + total + '</td>';
            html += '<td>ï¿¦' + totalVat + '</td>';
            html += '<td></td>';
            html += '</tr>';
            html += '</table>';
            
            html += '<div style="margin-top:15px;">';
            html += '<button class="btn-primary" onclick="proceedToOrder()">ì£¼ë¬¸í•˜ê¸°</button>';
            html += '</div>';
        }
        
        document.getElementById('basketContent').innerHTML = html;
    }
    
    // ì•„ì´í…œ ì‚­ì œ
    function removeItem(itemNo) {
        if (confirm('ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            fetch('remove_from_basket.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'no=' + itemNo
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadBasket();
                } else {
                    showMessage('ì‚­ì œ ì˜¤ë¥˜: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('ì‚­ì œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message, 'error');
            });
        }
    }
    
    // ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸°
    function clearBasket() {
        if (confirm('ì¥ë°”êµ¬ë‹ˆë¥¼ ëª¨ë‘ ë¹„ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            fetch('clear_basket.php', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('ì¥ë°”êµ¬ë‹ˆê°€ ë¹„ì›Œì¡ŒìŠµë‹ˆë‹¤.', 'success');
                    loadBasket();
                } else {
                    showMessage('ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸° ì˜¤ë¥˜: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('ì¥ë°”êµ¬ë‹ˆ ë¹„ìš°ê¸° ì¤‘ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ' + error.message, 'error');
            });
        }
    }
    
    // ì£¼ë¬¸í•˜ê¸°
    function proceedToOrder() {
        if (confirm('ì£¼ë¬¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            window.location.href = 'basket.php';
        }
    }
    
    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(message, type) {
        const messageSection = document.getElementById('messageSection');
        const messageContent = document.getElementById('messageContent');
        
        messageSection.className = 'section ' + type;
        messageContent.innerHTML = message;
        messageSection.style.display = 'block';
        
        // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
        setTimeout(() => {
            messageSection.style.display = 'none';
        }, 3000);
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¥ë°”êµ¬ë‹ˆ ìë™ ë¡œë“œ
    document.addEventListener('DOMContentLoaded', function() {
        loadBasket();
    });
    </script>
</body>
</html>