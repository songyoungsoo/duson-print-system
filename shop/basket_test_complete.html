<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>🛒 장바구니 시스템 종합 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #e8f5e8; border-color: #4CAF50; }
        .error { background: #ffebee; border-color: #f44336; }
        .info { background: #e3f2fd; border-color: #2196F3; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #FF6B35; color: white; }
        .btn-danger { background: #f44336; color: white; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background: #f0f0f0; }
        input, select { padding: 5px; margin: 2px; }
    </style>
</head>
<body>
    <h1>🛒 장바구니 시스템 종합 테스트</h1>
    
    <!-- 1. 상품 추가 섹션 -->
    <div class="section info">
        <h2>1. 상품 추가</h2>
        <form id="productForm">
            <table>
                <tr>
                    <td>재질:</td>
                    <td>
                        <select name="jong">
                            <option value="jil 아트유광코팅">jil 아트유광코팅</option>
                            <option value="jil 아트무광코팅">jil 아트무광코팅</option>
                            <option value="jka 강접아트유광코팅">jka 강접아트유광코팅</option>
                            <option value="jsp 투명스티커">jsp 투명스티커</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>가로(mm):</td>
                    <td><input type="number" name="garo" value="100" min="1"></td>
                </tr>
                <tr>
                    <td>세로(mm):</td>
                    <td><input type="number" name="sero" value="150" min="1"></td>
                </tr>
                <tr>
                    <td>수량:</td>
                    <td>
                        <select name="mesu">
                            <option value="500">500매</option>
                            <option value="1000" selected>1000매</option>
                            <option value="2000">2000매</option>
                            <option value="5000">5000매</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>편집:</td>
                    <td>
                        <select name="uhyung">
                            <option value="0">인쇄만</option>
                            <option value="10000">디자인+인쇄</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>도무송:</td>
                    <td>
                        <select name="domusong">
                            <option value="00000 사각">기본사각형</option>
                            <option value="08000 원형">원형</option>
                            <option value="08000 타원">타원형</option>
                            <option value="19000 복잡">모양도무송</option>
                        </select>
                    </td>
                </tr>
            </table>
            <button type="button" class="btn-primary" onclick="calculatePrice()">가격 계산</button>
            <button type="button" class="btn-secondary" onclick="addToBasket()">장바구니 담기</button>
        </form>
        
        <div id="priceResult" style="display:none; margin-top:10px; padding:10px; background:#f9f9f9; border-radius:3px;">
            <strong>계산 결과:</strong>
            <span id="priceDisplay"></span>
        </div>
    </div>
    
    <!-- 2. 장바구니 목록 섹션 -->
    <div class="section">
        <h2>2. 장바구니 목록</h2>
        <button type="button" class="btn-primary" onclick="loadBasket()">목록 새로고침</button>
        <button type="button" class="btn-danger" onclick="clearBasket()">장바구니 비우기</button>
        
        <div id="basketContent">
            <p>장바구니를 로드하려면 "목록 새로고침" 버튼을 클릭하세요.</p>
        </div>
    </div>
    
    <!-- 3. 결과 메시지 섹션 -->
    <div id="messageSection" class="section" style="display:none;">
        <h2>결과 메시지</h2>
        <div id="messageContent"></div>
    </div>

    <script>
    // 가격 계산 함수
    function calculatePrice() {
        const form = document.getElementById('productForm');
        const formData = new FormData(form);
        formData.set('action', 'calculate');
        
        fetch('calculate_price.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('priceDisplay').innerHTML = 
                    '가격: ' + data.price + '원 | VAT 포함: ' + data.price_vat + '원';
                document.getElementById('priceResult').style.display = 'block';
                showMessage('가격 계산 완료!', 'success');
            } else {
                showMessage('가격 계산 오류: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('가격 계산 중 네트워크 오류: ' + error.message, 'error');
        });
    }
    
    // 장바구니에 추가
    function addToBasket() {
        const form = document.getElementById('productForm');
        const formData = new FormData(form);
        formData.set('action', 'add_to_basket');
        formData.set('no', '');
        
        fetch('add_to_basket_simple.php', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showMessage('장바구니에 추가되었습니다!', 'success');
                loadBasket(); // 자동으로 목록 새로고침
            } else {
                showMessage('장바구니 추가 오류: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('장바구니 추가 중 네트워크 오류: ' + error.message, 'error');
        });
    }
    
    // 장바구니 목록 로드
    function loadBasket() {
        fetch('get_basket_items.php')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                displayBasket(data.items, data.total, data.total_vat);
                showMessage('장바구니 목록을 불러왔습니다.', 'success');
            } else {
                showMessage('장바구니 로드 오류: ' + data.message, 'error');
            }
        })
        .catch(error => {
            showMessage('장바구니 로드 중 네트워크 오류: ' + error.message, 'error');
        });
    }
    
    // 장바구니 화면 표시
    function displayBasket(items, total, totalVat) {
        let html = '';
        
        if (items.length === 0) {
            html = '<p>📭 장바구니가 비어있습니다.</p>';
        } else {
            html = '<table>';
            html += '<tr><th>NO</th><th>재질</th><th>가로</th><th>세로</th><th>수량</th><th>도무송</th><th>편집비</th><th>가격</th><th>VAT포함</th><th>삭제</th></tr>';
            
            items.forEach(item => {
                html += '<tr>';
                html += '<td>' + item.no + '</td>';
                html += '<td>' + item.jong_short + '</td>';
                html += '<td>' + item.garo + '</td>';
                html += '<td>' + item.sero + '</td>';
                html += '<td>' + item.mesu + '</td>';
                html += '<td>' + item.domusong_short + '</td>';
                html += '<td>' + item.uhyung + '</td>';
                html += '<td><strong>' + item.st_price + '</strong></td>';
                html += '<td><strong>' + item.st_price_vat + '</strong></td>';
                html += '<td><button class="btn-danger" onclick="removeItem(' + item.no + ')">삭제</button></td>';
                html += '</tr>';
            });
            
            html += '<tr style="background:#e8f5e8; font-weight:bold;">';
            html += '<td colspan="7">합계</td>';
            html += '<td>￦' + total + '</td>';
            html += '<td>￦' + totalVat + '</td>';
            html += '<td></td>';
            html += '</tr>';
            html += '</table>';
            
            html += '<div style="margin-top:15px;">';
            html += '<button class="btn-primary" onclick="proceedToOrder()">주문하기</button>';
            html += '</div>';
        }
        
        document.getElementById('basketContent').innerHTML = html;
    }
    
    // 아이템 삭제
    function removeItem(itemNo) {
        if (confirm('이 상품을 삭제하시겠습니까?')) {
            fetch('remove_from_basket.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'no=' + itemNo
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('상품이 삭제되었습니다.', 'success');
                    loadBasket();
                } else {
                    showMessage('삭제 오류: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('삭제 중 네트워크 오류: ' + error.message, 'error');
            });
        }
    }
    
    // 장바구니 비우기
    function clearBasket() {
        if (confirm('장바구니를 모두 비우시겠습니까?')) {
            fetch('clear_basket.php', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showMessage('장바구니가 비워졌습니다.', 'success');
                    loadBasket();
                } else {
                    showMessage('장바구니 비우기 오류: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showMessage('장바구니 비우기 중 네트워크 오류: ' + error.message, 'error');
            });
        }
    }
    
    // 주문하기
    function proceedToOrder() {
        if (confirm('주문 페이지로 이동하시겠습니까?')) {
            window.location.href = 'basket.php';
        }
    }
    
    // 메시지 표시
    function showMessage(message, type) {
        const messageSection = document.getElementById('messageSection');
        const messageContent = document.getElementById('messageContent');
        
        messageSection.className = 'section ' + type;
        messageContent.innerHTML = message;
        messageSection.style.display = 'block';
        
        // 3초 후 자동 숨김
        setTimeout(() => {
            messageSection.style.display = 'none';
        }, 3000);
    }
    
    // 페이지 로드 시 장바구니 자동 로드
    document.addEventListener('DOMContentLoaded', function() {
        loadBasket();
    });
    </script>
</body>
</html>