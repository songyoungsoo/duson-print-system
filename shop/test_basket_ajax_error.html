<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>장바구니 AJAX 오류 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #e8f5e8; border: 1px solid #4CAF50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        .info { background: #e3f2fd; border: 1px solid #2196F3; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; background: #4CAF50; color: white; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🧪 장바구니 AJAX 오류 테스트</h1>
    
    <div class="info">
        <h3>테스트 데이터:</h3>
        <ul>
            <li>재질: jil 아트유광코팅</li>
            <li>가로: 100mm</li>
            <li>세로: 150mm</li>
            <li>수량: 1000매</li>
            <li>편집: 인쇄만 (0원)</li>
            <li>도무송: 08000 원형</li>
        </ul>
    </div>
    
    <button onclick="testAddToBasket()">장바구니 추가 테스트</button>
    <button onclick="clearResults()">결과 지우기</button>
    
    <div id="results"></div>

    <script>
    function testAddToBasket() {
        addResult('🚀 장바구니 추가 테스트 시작...', 'info');
        
        const formData = new FormData();
        formData.append('action', 'add_to_basket');
        formData.append('jong', 'jil 아트유광코팅');
        formData.append('garo', '100');
        formData.append('sero', '150');
        formData.append('mesu', '1000');
        formData.append('uhyung', '0');
        formData.append('domusong', '08000 원형');
        formData.append('no', '');
        
        // 전송 데이터 로그
        let dataLog = '📤 전송 데이터:\n';
        for (let [key, value] of formData.entries()) {
            dataLog += key + ': ' + value + '\n';
        }
        addResult(dataLog, 'info');
        
        fetch('add_to_basket_safe.php', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            addResult('📡 서버 응답 상태: ' + response.status + ' ' + response.statusText, 'info');
            
            // 응답 헤더 확인
            let headers = '';
            for (let [key, value] of response.headers.entries()) {
                headers += key + ': ' + value + '\n';
            }
            addResult('📋 응답 헤더:\n' + headers, 'info');
            
            return response.text(); // JSON 대신 text로 먼저 받기
        })
        .then(text => {
            addResult('📄 원본 응답:\n' + text, 'info');
            
            try {
                const data = JSON.parse(text);
                addResult('✅ JSON 파싱 성공', 'success');
                
                if (data.success) {
                    addResult('🎉 장바구니 추가 성공!\n메시지: ' + data.message + '\n가격: ' + data.price + '원\nVAT 포함: ' + data.price_vat + '원', 'success');
                } else {
                    addResult('❌ 장바구니 추가 실패\n오류: ' + data.message, 'error');
                }
            } catch (e) {
                addResult('❌ JSON 파싱 실패\n오류: ' + e.message + '\n원본 응답이 JSON 형식이 아닙니다.', 'error');
            }
        })
        .catch(error => {
            addResult('❌ 네트워크 오류\n' + error.message, 'error');
        });
    }
    
    function addResult(message, type) {
        const results = document.getElementById('results');
        const div = document.createElement('div');
        div.className = 'result ' + type;
        div.innerHTML = '<pre>' + message + '</pre>';
        results.appendChild(div);
        
        // 자동 스크롤
        div.scrollIntoView({ behavior: 'smooth' });
    }
    
    function clearResults() {
        document.getElementById('results').innerHTML = '';
    }
    </script>
</body>
</html>