<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ì¥ë°”êµ¬ë‹ˆ AJAX ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #e8f5e8; border: 1px solid #4CAF50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        .info { background: #e3f2fd; border: 1px solid #2196F3; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; background: #4CAF50; color: white; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ì¥ë°”êµ¬ë‹ˆ AJAX ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="info">
        <h3>í…ŒìŠ¤íŠ¸ ë°ì´í„°:</h3>
        <ul>
            <li>ì¬ì§ˆ: jil ì•„íŠ¸ìœ ê´‘ì½”íŒ…</li>
            <li>ê°€ë¡œ: 100mm</li>
            <li>ì„¸ë¡œ: 150mm</li>
            <li>ìˆ˜ëŸ‰: 1000ë§¤</li>
            <li>í¸ì§‘: ì¸ì‡„ë§Œ (0ì›)</li>
            <li>ë„ë¬´ì†¡: 08000 ì›í˜•</li>
        </ul>
    </div>
    
    <button onclick="testAddToBasket()">ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ í…ŒìŠ¤íŠ¸</button>
    <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>
    
    <div id="results"></div>

    <script>
    function testAddToBasket() {
        addResult('ğŸš€ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
        
        const formData = new FormData();
        formData.append('action', 'add_to_basket');
        formData.append('jong', 'jil ì•„íŠ¸ìœ ê´‘ì½”íŒ…');
        formData.append('garo', '100');
        formData.append('sero', '150');
        formData.append('mesu', '1000');
        formData.append('uhyung', '0');
        formData.append('domusong', '08000 ì›í˜•');
        formData.append('no', '');
        
        // ì „ì†¡ ë°ì´í„° ë¡œê·¸
        let dataLog = 'ğŸ“¤ ì „ì†¡ ë°ì´í„°:\n';
        for (let [key, value] of formData.entries()) {
            dataLog += key + ': ' + value + '\n';
        }
        addResult(dataLog, 'info');
        
        fetch('add_to_basket_safe.php', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            addResult('ğŸ“¡ ì„œë²„ ì‘ë‹µ ìƒíƒœ: ' + response.status + ' ' + response.statusText, 'info');
            
            // ì‘ë‹µ í—¤ë” í™•ì¸
            let headers = '';
            for (let [key, value] of response.headers.entries()) {
                headers += key + ': ' + value + '\n';
            }
            addResult('ğŸ“‹ ì‘ë‹µ í—¤ë”:\n' + headers, 'info');
            
            return response.text(); // JSON ëŒ€ì‹  textë¡œ ë¨¼ì € ë°›ê¸°
        })
        .then(text => {
            addResult('ğŸ“„ ì›ë³¸ ì‘ë‹µ:\n' + text, 'info');
            
            try {
                const data = JSON.parse(text);
                addResult('âœ… JSON íŒŒì‹± ì„±ê³µ', 'success');
                
                if (data.success) {
                    addResult('ğŸ‰ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì„±ê³µ!\në©”ì‹œì§€: ' + data.message + '\nê°€ê²©: ' + data.price + 'ì›\nVAT í¬í•¨: ' + data.price_vat + 'ì›', 'success');
                } else {
                    addResult('âŒ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ ì‹¤íŒ¨\nì˜¤ë¥˜: ' + data.message, 'error');
                }
            } catch (e) {
                addResult('âŒ JSON íŒŒì‹± ì‹¤íŒ¨\nì˜¤ë¥˜: ' + e.message + '\nì›ë³¸ ì‘ë‹µì´ JSON í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.', 'error');
            }
        })
        .catch(error => {
            addResult('âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜\n' + error.message, 'error');
        });
    }
    
    function addResult(message, type) {
        const results = document.getElementById('results');
        const div = document.createElement('div');
        div.className = 'result ' + type;
        div.innerHTML = '<pre>' + message + '</pre>';
        results.appendChild(div);
        
        // ìë™ ìŠ¤í¬ë¡¤
        div.scrollIntoView({ behavior: 'smooth' });
    }
    
    function clearResults() {
        document.getElementById('results').innerHTML = '';
    }
    </script>
</body>
</html>