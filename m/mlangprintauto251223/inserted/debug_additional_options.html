<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>추가옵션 디버깅 테스트</title>
</head>
<body>
    <h1>추가옵션 자동 재계산 디버깅</h1>

    <h2>테스트 시나리오</h2>
    <ol>
        <li>페이지 로드 → <a href="http://localhost/mlangprintauto/inserted/index.php" target="_blank">전단지 페이지 열기</a></li>
        <li>F12 개발자 도구 열기</li>
        <li>콘솔 탭 선택</li>
        <li>아래 명령어를 순서대로 실행</li>
    </ol>

    <h2>1단계: 초기 상태 확인</h2>
    <pre style="background: #f5f5f5; padding: 10px;">
// window.autoCalculatePrice 함수가 존재하는지 확인
console.log('autoCalculatePrice 존재:', typeof window.autoCalculatePrice);

// window.currentPriceData 존재 확인
console.log('currentPriceData 존재:', typeof window.currentPriceData);
console.log('currentPriceData 값:', window.currentPriceData);
    </pre>

    <h2>2단계: 기본 옵션 선택 후 가격 계산 확인</h2>
    <p>모든 기본 옵션을 선택하고 가격이 계산되면 다시 콘솔에서 확인:</p>
    <pre style="background: #f5f5f5; padding: 10px;">
// 가격 계산 후 currentPriceData 확인
console.log('currentPriceData:', window.currentPriceData);
    </pre>

    <h2>3단계: 추가옵션 총액 확인</h2>
    <pre style="background: #f5f5f5; padding: 10px;">
// 추가옵션 총액 span 확인
const totalSpan = document.getElementById('additional-options-total');
console.log('추가옵션 총액 span:', totalSpan);
console.log('추가옵션 총액 값:', totalSpan ? totalSpan.textContent : 'NOT FOUND');
    </pre>

    <h2>4단계: 코팅 옵션 선택 후 수동 재계산 테스트</h2>
    <p>코팅 체크박스를 클릭하고 "단면유광"을 선택한 후:</p>
    <pre style="background: #f5f5f5; padding: 10px;">
// 추가옵션 총액 확인
const totalSpan = document.getElementById('additional-options-total');
console.log('추가옵션 총액:', totalSpan.textContent);

// 수동으로 autoCalculatePrice 호출
if (window.autoCalculatePrice) {
    console.log('수동 재계산 시작...');
    window.autoCalculatePrice();
} else {
    console.error('autoCalculatePrice 함수가 없습니다!');
}
    </pre>

    <h2>5단계: AJAX 요청 모니터링</h2>
    <p>Network 탭으로 이동하여 <code>calculate_price_ajax.php</code> 요청 확인:</p>
    <ul>
        <li>Request URL에 <code>additional_options_total</code> 파라미터가 포함되어 있는지 확인</li>
        <li>Response에서 가격이 올바르게 계산되었는지 확인</li>
    </ul>

    <h2>6단계: 예상 결과</h2>
    <pre style="background: #e8f5e9; padding: 10px;">
✅ 성공 시 콘솔 출력:
📊 추가옵션 선택 → 가격 재계산
🔧 추가 옵션 총액: 80000
💰 자동 가격 계산 시작 (모든 필수 필드 완성)
💰 가격 계산 응답: {success: true, data: {...}}
    </pre>

    <pre style="background: #ffebee; padding: 10px;">
❌ 실패 시 가능한 오류:
1. "autoCalculatePrice 함수가 없습니다!" → leaflet-compact.js 로딩 실패
2. "currentPriceData: null" → 기본 가격이 아직 계산되지 않음
3. AJAX 요청이 전송되지 않음 → 이벤트 리스너 문제
4. additional_options_total=0 → 추가옵션 총액 업데이트 실패
    </pre>

    <h2>7단계: 강제 재계산 테스트 (비상용)</h2>
    <pre style="background: #fff3e0; padding: 10px;">
// leaflet-compact.js의 calculatePrice 함수 직접 호출
// (window.autoCalculatePrice가 작동하지 않을 때)
if (typeof calculatePrice !== 'undefined') {
    console.log('calculatePrice 직접 호출 시도...');
    calculatePrice(true);
} else {
    console.error('calculatePrice 함수도 없습니다!');
}
    </pre>

    <h2>문제 해결 체크리스트</h2>
    <table border="1" cellpadding="10" style="border-collapse: collapse;">
        <tr>
            <th>확인 항목</th>
            <th>확인 방법</th>
            <th>예상 결과</th>
        </tr>
        <tr>
            <td>leaflet-compact.js 로딩</td>
            <td>콘솔: <code>typeof window.autoCalculatePrice</code></td>
            <td>"function"</td>
        </tr>
        <tr>
            <td>기본 가격 계산</td>
            <td>콘솔: <code>window.currentPriceData</code></td>
            <td>객체 (null 아님)</td>
        </tr>
        <tr>
            <td>추가옵션 총액 업데이트</td>
            <td>콘솔: <code>document.getElementById('additional-options-total').textContent</code></td>
            <td>"80,000" (숫자 형식)</td>
        </tr>
        <tr>
            <td>이벤트 리스너 등록</td>
            <td>옵션 선택 후 콘솔 로그 확인</td>
            <td>"📊 추가옵션 선택 → 가격 재계산"</td>
        </tr>
        <tr>
            <td>AJAX 요청 전송</td>
            <td>Network 탭: calculate_price_ajax.php</td>
            <td>additional_options_total=80000</td>
        </tr>
    </table>

    <hr>
    <p><strong>디버깅 도구:</strong> Chrome DevTools / Firefox Developer Tools</p>
    <p><strong>작성일:</strong> 2025-01-09</p>
</body>
</html>
