<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MlangPrintAuto ì—…ë¡œë“œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .product h3 { margin-top: 0; color: #333; }
        .status { padding: 10px; margin: 10px 0; border-radius: 3px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .test-btn { background: #007bff; color: white; border: none; border-radius: 3px; }
        .test-btn:hover { background: #0056b3; }
        .open-btn { background: #28a745; color: white; border: none; border-radius: 3px; }
        .results { margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 5px; }
        .summary { font-size: 1.2em; margin-bottom: 15px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª MlangPrintAuto ì—…ë¡œë“œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸</h1>
    <p>ê° í’ˆëª©ì˜ "í˜ì´ì§€ ì—´ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ì œ í˜ì´ì§€ì—ì„œ íŒŒì¼ ì—…ë¡œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</p>

    <div class="results">
        <div class="summary">
            <strong>í…ŒìŠ¤íŠ¸ ëŒ€ìƒ:</strong> 9ê°œ í’ˆëª© (leaflet ì œì™¸)
        </div>

        <div id="products"></div>
    </div>

    <div class="results" style="margin-top: 30px;">
        <h2>ğŸ“ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <ol>
            <li>ê° í’ˆëª© í˜ì´ì§€ë¥¼ ì—´ê¸°</li>
            <li>"íŒŒì¼ ì—…ë¡œë“œ ë° ì£¼ë¬¸í•˜ê¸°" ë²„íŠ¼ í´ë¦­</li>
            <li>ëª¨ë‹¬ì—ì„œ íŒŒì¼ ì„ íƒ (ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­)</li>
            <li>ì—…ë¡œë“œëœ íŒŒì¼ì´ ëª©ë¡ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸</li>
            <li>í•„ìš”í•œ ì˜µì…˜ ì„ íƒ (ìˆ˜ëŸ‰, ì‚¬ì´ì¦ˆ ë“±)</li>
            <li>"ì¥ë°”êµ¬ë‹ˆì— ì €ì¥" ë²„íŠ¼ í´ë¦­</li>
            <li>ì„±ê³µ ë©”ì‹œì§€ í™•ì¸ ë˜ëŠ” ì˜¤ë¥˜ í™•ì¸</li>
            <li>ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì—…ë¡œë“œëœ íŒŒì¼ í™•ì¸</li>
        </ol>
    </div>

    <div class="results" style="margin-top: 30px;">
        <h2>ğŸ” í™•ì¸í•  ë‚´ìš©</h2>
        <ul>
            <li><strong>í´ë” ìƒì„±:</strong> <code>/www/ImgFolder/_MlangPrintAuto_{í’ˆëª©}_index.php/2025/MMDD/IP/timestamp/</code></li>
            <li><strong>íŒŒì¼ ì €ì¥:</strong> í´ë” ì•ˆì— ì‹¤ì œ íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€</li>
            <li><strong>DB ê¸°ë¡:</strong> <code>shop_temp</code> í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥</li>
            <li><strong>ê´€ë¦¬ì í™•ì¸:</strong> ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•œì§€</li>
        </ul>
    </div>

    <script>
        const products = [
            { id: 'inserted', name: 'ì „ë‹¨ì§€', hasUpload: true },
            { id: 'sticker_new', name: 'ìŠ¤í‹°ì»¤', hasUpload: true },
            { id: 'envelope', name: 'ë´‰íˆ¬', hasUpload: true },
            { id: 'littleprint', name: 'ì†ŒëŸ‰ì¸ì‡„ë¬¼', hasUpload: true },
            { id: 'cadarok', name: 'ì¹´ë‹¤ë¡', hasUpload: true },
            { id: 'merchandisebond', name: 'ìƒí’ˆê¶Œ', hasUpload: false },
            { id: 'namecard', name: 'ëª…í•¨', hasUpload: true },
            { id: 'msticker', name: 'ìì„ìŠ¤í‹°ì»¤', hasUpload: true },
            { id: 'ncrflambeau', name: 'ì–‘ì‹ì§€', hasUpload: true }
        ];

        const container = document.getElementById('products');

        products.forEach((product, index) => {
            const div = document.createElement('div');
            div.className = 'product';

            if (!product.hasUpload) {
                div.innerHTML = `
                    <h3>${index + 1}. ${product.name} (${product.id})</h3>
                    <div class="status info">
                        â­ï¸ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì—†ìŒ - ìŠ¤í‚µ
                    </div>
                `;
            } else {
                const url = `/mlangprintauto/${product.id}/index.php`;
                div.innerHTML = `
                    <h3>${index + 1}. ${product.name} (${product.id})</h3>
                    <button class="open-btn" onclick="window.open('${url}', '_blank')">
                        ğŸ”— í˜ì´ì§€ ì—´ê¸°
                    </button>
                    <button class="test-btn" onclick="checkFormDataPattern('${product.id}')">
                        ğŸ” ì½”ë“œ í™•ì¸
                    </button>
                    <div id="status-${product.id}" class="status" style="display:none;"></div>
                `;
            }

            container.appendChild(div);
        });

        async function checkFormDataPattern(productId) {
            const statusDiv = document.getElementById(`status-${productId}`);
            statusDiv.style.display = 'block';
            statusDiv.className = 'status info';
            statusDiv.innerHTML = 'ğŸ” ì½”ë“œ íŒ¨í„´ í™•ì¸ ì¤‘...';

            try {
                const response = await fetch(`/${productId}/index.php`);
                const html = await response.text();

                // FormData íŒ¨í„´ ê²€ì‚¬
                const hasCorrectPattern = html.includes('uploaded_files[]');
                const hasWrongPattern = /uploaded_files\[\d+\]/.test(html) ||
                                       /uploaded_files\[\$\{index\}\]/.test(html);

                if (hasCorrectPattern && !hasWrongPattern) {
                    statusDiv.className = 'status success';
                    statusDiv.innerHTML = 'âœ… ì½”ë“œ íŒ¨í„´ ì˜¬ë°”ë¦„: uploaded_files[] ì‚¬ìš©';
                } else if (hasWrongPattern) {
                    statusDiv.className = 'status error';
                    statusDiv.innerHTML = 'âŒ ì˜ëª»ëœ íŒ¨í„´ ë°œê²¬: ì¸ë±ìŠ¤ ì‚¬ìš© (ìˆ˜ì • í•„ìš”)';
                } else {
                    statusDiv.className = 'status info';
                    statusDiv.innerHTML = 'âš ï¸ uploaded_files íŒ¨í„´ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ';
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
            }
        }

        // ê´€ë¦¬ì í˜ì´ì§€ ì—´ê¸° ë§í¬
        const adminDiv = document.createElement('div');
        adminDiv.className = 'results';
        adminDiv.style.marginTop = '30px';
        adminDiv.innerHTML = `
            <h2>ğŸ”§ ê´€ë¦¬ì í˜ì´ì§€</h2>
            <button class="open-btn" onclick="window.open('/admin/mlangprintauto/admin.php', '_blank')">
                ğŸ”— ê´€ë¦¬ì í˜ì´ì§€ ì—´ê¸°
            </button>
            <p>ì—…ë¡œë“œëœ íŒŒì¼ì„ í™•ì¸í•˜ê³  ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì„¸ìš”.</p>
        `;
        document.body.appendChild(adminDiv);
    </script>
</body>
</html>
