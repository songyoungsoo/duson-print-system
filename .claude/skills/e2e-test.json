{
  "name": "e2e-test",
  "description": "End-to-end browser testing with Playwright for complete user workflows",
  "version": "1.0.0",
  "invocation": {
    "type": "slash-command",
    "command": "e2e"
  },
  "prompt": "Run end-to-end browser tests using Playwright MCP.\n\nSTEPS:\n1. Ask user what to test:\n   - Product page workflow (select options → calculate → add to cart)\n   - Order submission flow (cart → checkout → complete)\n   - Admin panel functionality\n   - Gallery interaction\n   - File upload system\n\n2. Verify local server:\n   curl -I http://localhost/mlangprintauto/inserted/\n   (Ensure Apache + MySQL running)\n\n3. Use Playwright MCP to:\n   - Navigate to pages\n   - Interact with elements (select, input, click)\n   - Wait for AJAX responses\n   - Verify DOM state\n   - Check console errors\n   - Take screenshots\n\n## TEST SCENARIOS\n\n### Product Page Workflow\n```javascript\n// 1. Navigate\nawait page.goto('http://localhost/mlangprintauto/inserted/');\n\n// 2. Select options\nawait page.selectOption('select[name=\"paper_type\"]', '랑데뷰150g');\nawait page.selectOption('select[name=\"size\"]', 'A4');\nawait page.fill('input[name=\"quantity\"]', '100');\n\n// 3. Wait for AJAX price calculation\nawait page.waitForResponse(response => \n  response.url().includes('calculate_price_ajax.php')\n);\n\n// 4. Verify price displayed\nconst price = await page.locator('.price-amount').textContent();\nassert(price !== '0');\n\n// 5. Verify window.currentPriceData\nconst priceData = await page.evaluate(() => window.currentPriceData);\nassert(priceData.total_price > 0);\n\n// 6. Click add to cart\nawait page.click('button:has-text(\"장바구니\")');\n\n// 7. Verify success\nawait page.waitForSelector('.success-message');\n```\n\n### Order Submission Flow\n```javascript\n// 1. Add to cart first\n// (use product workflow above)\n\n// 2. Go to cart\nawait page.goto('http://localhost/cart/');\n\n// 3. Verify items\nconst items = await page.locator('.cart-item').count();\nassert(items > 0);\n\n// 4. Fill checkout form\nawait page.fill('input[name=\"name\"]', '테스트');\nawait page.fill('input[name=\"email\"]', 'test@example.com');\nawait page.fill('input[name=\"phone\"]', '010-1234-5678');\n\n// 5. Submit order\nawait page.click('button[type=\"submit\"]');\n\n// 6. Verify order complete\nawait page.waitForURL('**/OrderComplete_*.php');\nconst orderNo = await page.locator('.order-number').textContent();\nassert(orderNo);\n\n// 7. Verify database\n// Run SQL: SELECT * FROM mlangorder_printauto WHERE OrderNo = '{orderNo}';\n```\n\n### File Upload Test\n```javascript\n// 1. Navigate to product\nawait page.goto('http://localhost/mlangprintauto/inserted/');\n\n// 2. Prepare test file\nconst testFile = '/tmp/test.jpg';\n\n// 3. Upload file\nconst fileInput = page.locator('input[type=\"file\"]');\nawait fileInput.setInputFiles(testFile);\n\n// 4. Wait for upload complete\nawait page.waitForSelector('.upload-success');\n\n// 5. Verify preview\nconst preview = await page.locator('.file-preview img').count();\nassert(preview > 0);\n\n// 6. Verify in database\n// Check shop_temp.uploaded_files JSON field\n```\n\n### Gallery Modal Test\n```javascript\n// 1. Navigate\nawait page.goto('http://localhost/mlangprintauto/inserted/');\n\n// 2. Click thumbnail\nawait page.click('.gallery-thumbnail:first-child');\n\n// 3. Wait for modal\nawait page.waitForSelector('.modal-gallery', { state: 'visible' });\n\n// 4. Verify image loaded\nconst img = page.locator('.modal-gallery img');\nawait expect(img).toBeVisible();\n\n// 5. Test pagination\nawait page.click('.gallery-next');\nawait page.waitForLoadState('networkidle');\n\n// 6. Click \"샘플 더보기\"\nawait page.click('button:has-text(\"샘플 더보기\")');\nawait page.waitForURL('**/proof_gallery.php*');\n```\n\n### Admin Panel Test\n```javascript\n// 1. Navigate to admin\nawait page.goto('http://localhost/admin/mlangprintauto/');\n\n// 2. Login\nawait page.fill('input[name=\"username\"]', 'admin');\nawait page.fill('input[name=\"password\"]', 'password');\nawait page.click('button[type=\"submit\"]');\n\n// 3. Wait for dashboard\nawait page.waitForURL('**/admin/**');\n\n// 4. Verify order list\nconst orders = await page.locator('.order-row').count();\nassert(orders >= 0);\n\n// 5. Test filtering\nawait page.selectOption('select[name=\"status\"]', 'pending');\nawait page.click('button:has-text(\"검색\")');\nawait page.waitForLoadState('networkidle');\n```\n\n## ERROR DETECTION\n\n```javascript\n// Monitor console errors\nconst errors = [];\npage.on('console', msg => {\n  if (msg.type() === 'error') {\n    errors.push(msg.text());\n  }\n});\n\n// Monitor network failures\npage.on('response', response => {\n  if (response.status() >= 400) {\n    console.log(`Failed: ${response.url()} - ${response.status()}`);\n  }\n});\n\n// Take screenshot on failure\ntry {\n  await runTest();\n} catch (error) {\n  await page.screenshot({ path: 'error-screenshot.png' });\n  throw error;\n}\n```\n\n## REPORT FORMAT\n\n```markdown\n## E2E Test Results\n\n### ✅ Test: Product Page Workflow\n- Steps completed: 7/7\n- Response time: 1.2s\n- Console errors: 0\n- Screenshot: /tmp/product-test.png\n\n### ❌ Test: Order Submission\n- Failed step: Form validation\n- Error: \"Email field required\"\n- Screenshot: /tmp/order-error.png\n- Console errors:\n  - TypeError: Cannot read property 'value' of null\n  - at calculatePrice (calculator.js:45)\n\n### Database Verification\n```sql\nSELECT * FROM shop_temp WHERE session_id = 'test_session';\n-- Result: 1 row, st_price = 15000, st_price_vat = 16500\n```\n```\n\n## TEST ENVIRONMENTS\n\n- **Local**: http://localhost/\n- **Staging**: http://dsp1830.shop/\n\n## PREREQUISITES\n\n- Apache + MySQL running\n- Playwright MCP enabled\n- Test data available\n- Session handling enabled\n\n## USEFUL SELECTORS\n\n```javascript\n// Price display\n'.price-amount'\n'#total_price'\n'.vat-price'\n\n// Cart button\n'button[onclick*=\"addToBasket\"]'\n'button:has-text(\"장바구니\")'\n\n// Form fields\n'input[name=\"name\"]'\n'input[name=\"email\"]'\n'select[name=\"paper_type\"]'\n\n// Gallery\n'.gallery-thumbnail'\n'.modal-gallery'\n'button:has-text(\"샘플 더보기\")'\n\n// Admin\n'.order-row'\n'select[name=\"status\"]'\n'.logen-tracking'\n```"
}
