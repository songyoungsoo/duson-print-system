# 계속

**통일된 이미지 갤러리 시스템 완성 지침**  
*작성일: 2025년 12월 10일*

## 🎯 현재 진행 상황

### ✅ 완료된 품목 (API 방식 + 통일 팝업)
1. **전단지** (`MlangPrintAuto/inserted/index.php`) - 원본 성공 사례
2. **명함** (`MlangPrintAuto/NameCard/index.php`) 
3. **스티커** (`MlangPrintAuto/sticker_new/index.php`) - 랜덤 정렬 적용
4. **포스터** (`MlangPrintAuto/LittlePrint/index.php`)
5. **봉투** (`MlangPrintAuto/envelope/index.php`)
6. **카탈로그** (`MlangPrintAuto/cadarok/index.php`)
7. **상품권** (`MlangPrintAuto/MerchandiseBond/index.php`)

### 🔄 진행 중인 품목
8. **자석스티커** (`MlangPrintAuto/msticker/index.php`) - CSS/JS 추가됨, 갤러리 섹션 교체 필요
9. **양식지** (`MlangPrintAuto/NcrFlambeau/index.php`) - 미작업

## 🏗️ 통일된 시스템 구조

### 1. 필수 파일 포함
각 품목 페이지 `<head>` 섹션에 추가:
```php
<!-- 통일된 갤러리 팝업 CSS -->
<link rel="stylesheet" href="../../css/unified-gallery-popup.css">

<!-- 고급 JavaScript 라이브러리 -->
<script src="../../includes/js/GalleryLightbox.js"></script>
<script src="../../js/[품목명].js" defer></script>

<!-- 통일된 갤러리 팝업 JavaScript -->
<script src="../../js/unified-gallery-popup.js"></script>
```

### 2. 갤러리 섹션 HTML 구조
```html
<!-- 좌측: 고급 이미지 갤러리 (API 방식, 전단지와 동일) -->
<div class="gallery-section">
    <div class="gallery-title">[이모지] [품목명] 샘플 갤러리</div>
    
    <!-- 고급 갤러리 시스템 (전단지와 동일한 API 방식) -->
    <div id="[품목영문명]Gallery">
        <div class="loading">[이모지] 갤러리 로딩 중...</div>
    </div>
    
    <!-- 더보기 버튼 -->
    <div class="gallery-more-button" style="text-align: center; margin-top: 20px;">
        <button type="button" class="btn-more-gallery" onclick="open[품목영문명]GalleryModal()">
            📂 더 많은 샘플 보기 (전체 갤러리)
        </button>
    </div>
</div>
```

### 3. JavaScript 초기화 코드
각 품목 페이지 하단 `<script>` 섹션에 추가:

```javascript
// 통일된 갤러리 팝업 초기화
let unified[품목영문명]Gallery;

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    // 통일된 갤러리 팝업 초기화
    unified[품목영문명]Gallery = new UnifiedGalleryPopup({
        category: '[API카테고리명]',
        apiUrl: '/api/get_real_orders_portfolio.php',
        title: '[품목한글명] 전체 갤러리',
        icon: '[이모지]',
        perPage: 18
    });
    
    // 메인 갤러리 API 방식으로 로딩 (전단지와 동일한 방법)
    load[품목영문명]ImagesAPI();
});

// 🎯 성공했던 API 방식으로 [품목명] 갤러리 로드 (전단지와 동일)
async function load[품목영문명]ImagesAPI() {
    const galleryContainer = document.getElementById('[품목영문명]Gallery');
    if (!galleryContainer) return;
    
    console.log('[이모지] [품목명] 갤러리 API 로딩 중...');
    galleryContainer.innerHTML = '<div class="loading">[이모지] 갤러리 로딩 중...</div>';
    
    try {
        const response = await fetch('/api/get_real_orders_portfolio.php?category=[API카테고리명]&per_page=4');
        const data = await response.json();
        
        console.log('[이모지] [품목명] API 응답:', data);
        
        if (data.success && data.data && data.data.length > 0) {
            console.log(`✅ [품목명] 이미지 ${data.data.length}개 로드 성공`);
            render[품목영문명]GalleryAPI(data.data, galleryContainer);
        } else {
            console.log('⚠️ [품목명] 이미지 데이터 없음');
            galleryContainer.innerHTML = '<div class="error">표시할 이미지가 없습니다.</div>';
        }
    } catch (error) {
        console.error('❌ [품목명] 갤러리 로딩 오류:', error);
        galleryContainer.innerHTML = '<div class="error">갤러리를 불러오는 중 오류가 발생했습니다.</div>';
    }
}

// API 갤러리 렌더링 (전단지 방식과 동일)
function render[품목영문명]GalleryAPI(images, container) {
    console.log('🎨 [품목명] 갤러리 렌더링:', images.length + '개 이미지');
    
    // lightboxViewer div 생성 ([품목명]용)
    const viewerHtml = `
        <div class="lightbox-viewer" id="[품목영문명소문자]LightboxViewer">
            <img id="[품목영문명소문자]MainImage" src="${images[0].path}" alt="${images[0].title}" 
                 style="width: 100%; height: 100%; object-fit: cover; cursor: zoom-in;"
                 onclick="openFullScreenImage('${images[0].path}', '${images[0].title}')">
        </div>
        <div class="thumbnail-strip">
            ${images.map((img, index) => 
                `<img src="${img.path}" alt="${img.title}" class="${index === 0 ? 'active' : ''}"
                     onclick="change[품목영문명]MainImage('${img.path}', '${img.title}', this)">` 
            ).join('')}
        </div>
    `;
    
    container.innerHTML = viewerHtml;
    
    // [품목명] 마우스 호버 효과 적용 (전단지와 동일)
    initialize[품목영문명]ZoomEffect();
}

// [품목명] 메인 이미지 변경 함수
function change[품목영문명]MainImage(imagePath, title, thumbnail) {
    const mainImage = document.getElementById('[품목영문명소문자]MainImage');
    if (mainImage) {
        mainImage.src = imagePath;
        mainImage.alt = title;
        mainImage.onclick = () => openFullScreenImage(imagePath, title);
    }
    
    // 썸네일 활성 상태 업데이트
    const thumbnails = document.querySelectorAll('.thumbnail-strip img');
    thumbnails.forEach(thumb => thumb.classList.remove('active'));
    thumbnail.classList.add('active');
    
    // 줌 효과 재초기화
    initialize[품목영문명]ZoomEffect();
}

// [품목명] 이미지 줌 효과 초기화 (전단지 방식과 동일)
function initialize[품목영문명]ZoomEffect() {
    const viewer = document.getElementById('[품목영문명소문자]LightboxViewer');
    const mainImage = document.getElementById('[품목영문명소문자]MainImage');
    
    if (!viewer || !mainImage) return;
    
    // 기존 이벤트 리스너 제거 후 재등록
    const newViewer = viewer.cloneNode(true);
    viewer.parentNode.replaceChild(newViewer, viewer);
    
    const newMainImage = document.getElementById('[품목영문명소문자]MainImage');
    if (!newMainImage) return;
    
    let isZoomed = false;
    
    newViewer.addEventListener('mousemove', function(e) {
        if (isZoomed) return;
        
        const rect = newViewer.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        
        newMainImage.style.transform = `scale(1.5)`;
        newMainImage.style.transformOrigin = `${x}% ${y}%`;
        newMainImage.style.transition = 'transform 0.3s ease';
    });
    
    newViewer.addEventListener('mouseleave', function() {
        if (isZoomed) return;
        newMainImage.style.transform = 'scale(1)';
        newMainImage.style.transformOrigin = 'center center';
    });
    
    newViewer.addEventListener('click', function(e) {
        if (e.target === newMainImage) {
            const imagePath = newMainImage.src;
            const title = newMainImage.alt;
            openFullScreenImage(imagePath, title);
        }
    });
}

// 통일된 갤러리 팝업 열기
function open[품목영문명]GalleryModal() {
    if (unified[품목영문명]Gallery) {
        unified[품목영문명]Gallery.show();
    }
}

// 전체화면 이미지 열기
function openFullScreenImage(imagePath, title) {
    if (window.lightboxViewer && window.lightboxViewer.showLightbox) {
        window.lightboxViewer.showLightbox(imagePath, title);
    } else {
        window.open(imagePath, '_blank');
    }
}
```

## 🔧 품목별 적용 정보

### 자석스티커 (진행 중)
- **파일 경로**: `C:\xampp\htdocs\MlangPrintAuto\msticker\index.php`
- **API 카테고리**: `msticker`
- **품목영문명**: `Msticker`
- **품목영문명소문자**: `msticker`
- **이모지**: `🧲`
- **갤러리 ID**: `mstickerGallery`
- **함수명 패턴**: `loadMstickerImagesAPI()`, `renderMstickerGalleryAPI()` 등

### 양식지 (미작업)
- **파일 경로**: `C:\xampp\htdocs\MlangPrintAuto\NcrFlambeau\index.php`
- **API 카테고리**: `ncrflambeau`
- **품목영문명**: `NcrFlambeau`
- **품목영문명소문자**: `ncrflambeau`
- **이모지**: `📋`
- **갤러리 ID**: `ncrflambeauGallery`

## 📋 체크리스트

남은 품목에 적용할 때 다음 순서로 진행:

### 1단계: CSS/JS 파일 추가
- [ ] `unified-gallery-popup.css` 추가
- [ ] `GalleryLightbox.js` 추가
- [ ] `unified-gallery-popup.js` 추가

### 2단계: 갤러리 HTML 구조 교체
- [ ] 기존 갤러리 섹션을 새 구조로 교체
- [ ] 품목별 고유 ID와 함수명 적용

### 3단계: JavaScript 코드 추가
- [ ] DOMContentLoaded 이벤트 리스너 추가
- [ ] UnifiedGalleryPopup 초기화 코드
- [ ] API 로딩 함수들 (5개 함수)
- [ ] 줌 효과 및 팝업 연동 함수들

### 4단계: 테스트
- [ ] 메인 갤러리 이미지 로딩 확인
- [ ] 썸네일 클릭 동작 확인
- [ ] 마우스 호버 줌 효과 확인
- [ ] "더 많은 샘플 보기" 팝업 확인

## 🎯 핵심 원칙

1. **전단지와 100% 동일한 방식**: 모든 품목은 전단지(`inserted/index.php`)와 동일한 API 방식 사용
2. **통일된 팝업 시스템**: 1200px × 800px, 6×3 그리드, 18개 카드, 페이지네이션
3. **API 엔드포인트**: `/api/get_real_orders_portfolio.php?category=[카테고리명]&per_page=4`
4. **실제 고객 주문 데이터**: 2년 이내 실제 주문에서 이미지가 있는 데이터만 표시
5. **일관된 사용자 경험**: 모든 품목에서 동일한 갤러리 조작법

## 🚀 다음 작업할 클로드에게

"계속"이라는 명령으로 이 지침을 참조하여:
1. **자석스티커** 갤러리 섹션을 위 구조로 교체하고 JavaScript 코드 추가
2. **양식지**에 전체 시스템 적용
3. 모든 품목에서 동일한 갤러리 경험 제공 완성

**중요**: 기존 성공 사례인 전단지(`inserted/index.php`)를 참조 기준으로 사용하고, 각 품목의 고유 특성(API 카테고리명, 함수명 등)만 변경하여 적용하세요.

*마지막 업데이트: 2025년 12월 10일 오후 5시*