# 통합 장바구니 개발 진행상황

## 📅 개발 일자: 2025.08.02

## 🎯 목표
- 기존 분리된 상품별 장바구니를 하나의 통합 장바구니로 통합
- 스티커, 카다록, 전단지, 명함, 봉투 등 모든 상품을 하나의 테이블에서 관리

## 📊 현재 시스템 분석 완료

### 기존 구조
```
프로젝트/
├── shop/ (일반 스티커 장바구니)
├── MlangPrintAuto/
│   ├── sticker/ (자석스티커 - 별개 상품)
│   ├── cadarok/ (카다록)
│   ├── NameCard/ (명함)
│   └── 기타 상품들/
└── MlangOrder_PrintAuto/ (주문 처리)
```

### 목표 구조 (합의됨)
```
프로젝트/
├── MlangPrintAuto/
│   ├── cart.php (통합 장바구니 관리)
│   ├── shop_temp_helper.php (장바구니 헬퍼 함수들)
│   ├── shop/ (일반 스티커)
│   ├── cadarok/ (카다록)
│   ├── sticker/ (자석스티커)
│   ├── NameCard/ (명함)
│   ├── NameCard/ (명함)
│   ├── NameCard/ (명함)│
│   ├── NameCard/ (명함)
│   ├── NameCard/ (명함)
│   └── 기타 상품들/
└── MlangOrder_PrintAuto/
```
  - ✅ `addMstickerToCart()` - 자석스티커 추가
  - ✅ `addMerchandisebondToCart()` - 쿠폰 추가
  - ✅ `addNcrflambeauToCart()` - 양식지 추가
  - ✅ `addLittleprintToCart()` - 포스터 추가



## 🗄️ 데이터베이스 구조 설계 완료

### 기존 테이블들
- `mlangprintauto_transactioncate` - 모든 상품 카테고리 관리 (번호 → 한글명 매핑)
- `mlangprintauto_inserted` (칼라인쇄/전단지)
- `mlangprintauto_cadarok` (카다록/리플렛)  
- `mlangprintauto_envelope` (봉투)
- `MlangPrintAuto_NameCard` (명함)
- 기타 상품별 테이블들

### 통합 장바구니 테이블 설계 (shop_temp)
```sql
CREATE TABLE `shop_temp` (
  `no` int(11) NOT NULL AUTO_INCREMENT,
  `session_id` varchar(100) NOT NULL,
  `order_id` varchar(50) DEFAULT NULL,
  `parent` varchar(50) DEFAULT NULL,
  
  -- 상품 기본 정보
  `product_type` varchar(50) NOT NULL DEFAULT 'sticker',
  
  -- 스티커 전용 필드들 (기존 호환성 유지)
  `jong` varchar(200) DEFAULT NULL COMMENT '스티커만 사용',
  `garo` varchar(50) DEFAULT NULL,
  `sero` varchar(50) DEFAULT NULL,
  `mesu` varchar(50) DEFAULT NULL,
  `domusong` varchar(200) DEFAULT NULL,
  `uhyung` int(1) DEFAULT 0,
  
  -- 공통 카테고리 매핑 정보
  `MY_type` varchar(50) DEFAULT NULL,
  `MY_Fsd` varchar(50) DEFAULT NULL,
  `PN_type` varchar(50) DEFAULT NULL,
  `MY_amount` varchar(50) DEFAULT NULL,
  `POtype` varchar(10) DEFAULT NULL,
  `ordertype` varchar(50) DEFAULT NULL,
  
  -- 가격 정보
  `st_price` decimal(10,2) DEFAULT 0.00,
  `st_price_vat` decimal(10,2) DEFAULT 0.00,
  
  -- 추가 정보
  `MY_comment` text DEFAULT NULL,
  `img` varchar(200) DEFAULT NULL,
  `regdate` int(11) DEFAULT NULL,
  
  PRIMARY KEY (`no`),
  KEY `idx_session` (`session_id`),
  KEY `idx_product_type` (`product_type`)
);
```

## 📁 생성된 파일들

### 1. 테이블 생성 관련
- ✅ `MlangPrintAuto/shop/create_shop_temp_table.sql` - 테이블 생성 SQL
- ✅ `shop/install_table.php` - 테이블 설치 스크립트

### 2. 헬퍼 함수들
- ✅ `MlangPrintAuto/shop_temp_helper.php` - 장바구니 조작 함수들
  - `addStickerToCart()` - 스티커 추가
  - `addCadarokToCart()` - 카다록 추가  
  - `addLeafletToCart()` - 전단지 추가
  - `addNamecardToCart()` - 명함 추가
  - `addEnvelopeToCart()` - 봉투 추가
  - ✅ `addMstickerToCart()` - 자석스티커 추가
  - ✅ `addMerchandisebondToCart()` - 쿠폰 추가
  - ✅ `addNcrflambeauToCart()` - 양식지 추가
  - ✅ `addLittleprintToCart()` - 포스터 추가
  - `getCartItems()` - 장바구니 조회
  - `removeCartItem()` - 아이템 삭제
  - `clearCart()` - 장바구니 비우기
  - `getCategoryName()` - 번호→한글명 변환
  - `formatCartItemForDisplay()` - 표시용 데이터 변환

### 3. 통합 장바구니 페이지
- ✅ `MlangPrintAuto/cart.php` - 통합 장바구니 관리 페이지 (루트 레벨)
- ✅ `MlangPrintAuto/shop/cart.php` - 장바구니 페이지 (shop 레벨)
- ✅ `MlangPrintAuto/shop/add_to_basket.php` - 장바구니 추가 API
- ✅ `MlangPrintAuto/shop/get_basket_items.php` - 장바구니 조회 API
- ✅ `MlangPrintAuto/shop/remove_from_basket.php` - 아이템 삭제 API
- ✅ `MlangPrintAuto/shop/clear_basket.php` - 장바구니 비우기 API

### 4. 사용 예시 및 템플릿
- ✅ `shop/usage_example.php` - 사용법 예시
- ✅ `MlangPrintAuto/shop/view_modern_new.php` - 공통 인클루드 사용 예시

## 🔧 경로 설정 확인 완료

### 데이터베이스 연결
- **루트/db.php** ← 메인 DB 연결 파일 확인됨
- **MlangPrintAuto/shop/** 에서는 `../../db.php` 사용
- **lib/func.php** 는 `../../lib/func.php` 사용

## 📋 완료된 작업 (2025.08.02)

### 1. shop 폴더 이동 및 경로 수정 ✅
- ✅ 기존 `shop/` 폴더를 `MlangPrintAuto/shop/`로 이동
- ✅ 모든 include 경로를 `../../db.php`로 수정
- ✅ 추가 상품 헬퍼 함수 생성 (자석스티커, 쿠폰, 양식지, 포스터)
- ✅ 공통 인클루드 파일 시스템 구축

### 2. 공통 인클루드 시스템 구축 ✅
- ✅ `includes/header.php` - 공통 헤더 (로고, 연락처, 로그인 상태)
- ✅ `includes/nav.php` - 네비게이션 메뉴 (모든 상품 링크)
- ✅ `includes/footer.php` - 공통 푸터 (회사 정보, 운영 안내)
- ✅ `includes/auth.php` - 로그인/회원가입 처리 로직
- ✅ `includes/login_modal.php` - 로그인 모달 UI + JavaScript

### 3. 주문 시스템 분석 완료 ✅
- ✅ 기존 `MlangOrder_PrintAuto` 테이블 구조 분석
- ✅ 각 품목별 개별 주문 방식이 최적임을 확인
- ✅ 주문자별 조회 방식으로 충분함을 확인

## 📋 다음 단계 (미완료)

### 1. 테이블 설치 및 테스트
- [ ] `MlangPrintAuto/shop/install_table.php` 실행하여 테이블 생성
- [ ] 통합 장바구니 기본 기능 테스트

### 2. 각 상품 페이지 연동
- ✅ 카다록 페이지에서 통합 장바구니 사용하도록 수정 완료
  - `MlangPrintAuto/cadarok/index_new.php` - 공통 인클루드 적용
  - `MlangPrintAuto/cadarok/price_cal_new.php` - 통합 장바구니 호환 가격 계산
  - `MlangPrintAuto/cadarok/get_sizes_new.php` - 규격 옵션 조회 API
  - `MlangPrintAuto/cadarok/get_paper_types_new.php` - 용지 옵션 조회 API
- [ ] 명함 페이지에서 통합 장바구니 사용하도록 수정
- [ ] 전단지 페이지에서 통합 장바구니 사용하도록 수정
- [ ] 기타 상품들 연동

### 3. 주문 처리 연동
- [ ] 장바구니에서 주문 시 각 품목을 개별 주문으로 처리
- [ ] 주문 완료 후 장바구니 비우기
- [ ] 주문 확인 이메일 발송

### 4. 가격 계산 API 연동
- [ ] 각 상품별 실시간 가격 계산 API 연결
- [ ] 장바구니 총액 계산 정확성 확인

## 💡 중요 결정사항들

1. **jong 필드는 스티커 전용**으로 사용 (다른 상품은 사용 안함)
2. **카테고리 번호들은 transactioncate 테이블에서 한글명으로 변환**
3. **장바구니 관리는 MlangPrintAuto 레벨에서** (모든 상품에서 접근 용이)
4. **기존 스티커 코드 호환성 유지** (점진적 통합)
5. **각 품목별 개별 주문 방식 유지** (복잡한 마스터-디테일 구조 불필요)
6. **공통 인클루드 시스템으로 코드 중복 최소화**
7. **루트 db.php 사용** (경로: `../../db.php`)

## 🚨 주의사항

- 기존 shop_temp 테이블에 데이터가 있다면 백업 필요
- 경로 변경 시 모든 링크와 include 문 확인 필요
- 세션 관리 일관성 유지 필요

## 📊 현재 진행률: 약 70% 완료

### ✅ 완료된 핵심 기능:
- 통합 장바구니 테이블 설계
- 모든 상품 유형 헬퍼 함수
- 공통 인클루드 시스템
- 장바구니 CRUD API
- 주문 시스템 분석

### 🔄 남은 작업:
- 테이블 설치 및 테스트
- 각 상품 페이지 연동
- 주문 처리 연동
- 최종 테스트

---
**다음 작업 시작점**: `MlangPrintAuto/shop/install_table.php` 실행하여 테이블 생성부터 시작

**테스트 순서:**
1. 테이블 설치: `http://yoursite.com/MlangPrintAuto/shop/install_table.php`
2. 장바구니 확인: `http://yoursite.com/MlangPrintAuto/shop/cart.php`
3. 공통 인클루드 예시: `http://yoursite.com/MlangPrintAuto/shop/view_modern_new.php`