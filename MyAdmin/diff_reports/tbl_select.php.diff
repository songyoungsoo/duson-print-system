--- tbl_select.php (original)
+++ tbl_select.php (modified)
@@ -47,26 +47,26 @@
         PMA_mysqlDie('', $local_query, '', $err_url);
     }
     else {
-        $fields_cnt        = mysql_num_rows($result);
+        $fields_cnt        = mysqli_num_rows($result);
         while ($row = PMA_mysql_fetch_array($result)) {
             $fields_list[] = $row['Field'];
             $type          = $row['Type'];
             // reformat mysql query output - staybyte - 9. June 2001
             $shorttype     = substr($type, 0, 3);
             if ($shorttype == 'set' || $shorttype == 'enu') {
-                $type      = eregi_replace(',', ', ', $type);
+                $type      = preg_replace(',', ', ', $type);
                 // Removes automatic MySQL escape format
                 $type      = str_replace('\'\'', '\\\'', $type);
             }
-            $type          = eregi_replace('BINARY', '', $type);
-            $type          = eregi_replace('ZEROFILL', '', $type);
-            $type          = eregi_replace('UNSIGNED', '', $type);
+            $type          = preg_replace('BINARY', '', $type);
+            $type          = preg_replace('ZEROFILL', '', $type);
+            $type          = preg_replace('UNSIGNED', '', $type);
             if (empty($type)) {
                 $type      = '&nbsp;';
             }
             $fields_type[] = $type;
         } // end while
-        mysql_free_result($result);
+        mysqli_free_result($result);
 
         // <markus@noga.de>
         // retrieve keys into foreign fields, if any
@@ -74,17 +74,17 @@
         $foreigners  = ($cfgRelation['relwork'] ? PMA_getForeigners($db, $table) : FALSE);
         ?>
 <form method="post" action="tbl_select.php">
-    <input type="hidden" name="server" value="<?php echo $server; ?>" />
-    <input type="hidden" name="lang" value="<?php echo $lang; ?>" />
-    <input type="hidden" name="convcharset" value="<?php echo $convcharset; ?>" />
-    <input type="hidden" name="db" value="<?php echo htmlspecialchars($db); ?>" />
-    <input type="hidden" name="table" value="<?php echo htmlspecialchars($table); ?>" />
-    <input type="hidden" name="goto" value="<?php echo $goto; ?>" />
+    <input type="hidden" name="server" value="<?php echo  $server ?>" />
+    <input type="hidden" name="lang" value="<?php echo  $lang ?>" />
+    <input type="hidden" name="convcharset" value="<?php echo  $convcharset ?>" />
+    <input type="hidden" name="db" value="<?php echo  htmlspecialchars($db) ?>" />
+    <input type="hidden" name="table" value="<?php echo  htmlspecialchars($table) ?>" />
+    <input type="hidden" name="goto" value="<?php echo  $goto ?>" />
     <input type="hidden" name="back" value="tbl_select.php" />
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-    <?php echo $strSelectFields; ?>&nbsp;:<br />
+    <?php echo  $strSelectFields ?>&nbsp;:<br />
     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
-    <select name="param[]" size="<?php echo ($fields_cnt < 10) ? $fields_cnt : 10; ?>" multiple="multiple">
+    <select name="param[]" size="<?php echo  ($fields_cnt < 10) ? $fields_cnt : 10 ?>" multiple="multiple">
         <?php
         echo "\n";
         // Displays the list of the fields
@@ -96,22 +96,22 @@
     <ul>
         <li>
             <div style="margin-bottom: 10px">
-            <?php echo $strLimitNumRows . "\n"; ?>
-            <input type="text" size="4" name="session_max_rows" value="<?php echo $cfg['MaxRows']; ?>" class="textfield" />
+            <?php echo  $strLimitNumRows . "\n" ?>
+            <input type="text" size="4" name="session_max_rows" value="<?php echo  $cfg['MaxRows'] ?>" class="textfield" />
             </div>
         </li>
         <li>
-            <?php echo $strAddSearchConditions; ?><br />
+            <?php echo  $strAddSearchConditions ?><br />
             <input type="text" name="where" class="textfield" />&nbsp;
-            <?php echo PMA_showMySQLDocu('Reference', 'Functions') . "\n"; ?>
+            <?php echo  PMA_showMySQLDocu('Reference', 'Functions') . "\n" ?>
             <br /><br />
-            <?php echo '<i>' . $strOr . '</i> ' . $strDoAQuery; ?><br />
-            <table border="<?php echo $cfg['Border']; ?>">
+            <?php echo  '<i>' . $strOr . '</i> ' . $strDoAQuery ?><br />
+            <table border="<?php echo  $cfg['Border'] ?>">
             <tr>
-                <th><?php echo $strField; ?></th>
-                <th><?php echo $strType; ?></th>
-                <th><?php echo $strFunction; ?></th>
-                <th><?php echo $strValue; ?></th>
+                <th><?php echo  $strField ?></th>
+                <th><?php echo  $strType ?></th>
+                <th><?php echo  $strFunction ?></th>
+                <th><?php echo  $strValue ?></th>
             </tr>
         <?php
         for ($i = 0; $i < $fields_cnt; $i++) {
@@ -119,14 +119,14 @@
             $bgcolor   = ($i % 2) ? $cfg['BgcolorOne'] : $cfg['BgcolorTwo'];
             ?>
             <tr>
-                <td bgcolor="<?php echo $bgcolor; ?>"><?php echo htmlspecialchars($fields_list[$i]); ?></td>
-                <td bgcolor="<?php echo $bgcolor; ?>"><?php echo $fields_type[$i]; ?></td>
-                <td bgcolor="<?php echo $bgcolor; ?>">
+                <td bgcolor="<?php echo  $bgcolor ?>"><?php echo  htmlspecialchars($fields_list[$i]) ?></td>
+                <td bgcolor="<?php echo  $bgcolor ?>"><?php echo  $fields_type[$i] ?></td>
+                <td bgcolor="<?php echo  $bgcolor ?>">
                     <select name="func[]">
             <?php
             reset($numfunctions);
             reset($textfunctions);
-            if (eregi('char|blob|text|set|enum', $fields_type[$i])) {
+            if (preg_match('char|blob|text|set|enum', $fields_type[$i])) {
                 while (list($k, $fc) = each($textfunctions)) {
                     echo "\n" . '                        '
                          . '<option value="' . htmlspecialchars($fc) . '">' . htmlspecialchars($fc) . '</option>';
@@ -141,7 +141,7 @@
             ?>
                     </select>
                 </td>
-                <td bgcolor="<?php echo $bgcolor; ?>">
+                <td bgcolor="<?php echo  $bgcolor ?>">
             <?php
             // <markus@noga.de>
             $field = $fields_list[$i];
@@ -163,8 +163,8 @@
                 echo '                    <input type="text" name="fields[]" size="40" class="textfield" />' . "\n";
             }
             ?>
-                    <input type="hidden" name="names[]" value="<?php echo urlencode($fields_list[$i]); ?>" />
-                    <input type="hidden" name="types[]" value="<?php echo $fields_type[$i]; ?>" />
+                    <input type="hidden" name="names[]" value="<?php echo  urlencode($fields_list[$i]) ?>" />
+                    <input type="hidden" name="types[]" value="<?php echo  $fields_type[$i] ?>" />
                 </td>
             </tr>
             <?php
@@ -174,7 +174,7 @@
             </table><br />
         </li>
         <li>
-            <?php echo $strDisplayOrder; ?><br />
+            <?php echo  $strDisplayOrder ?><br />
             <select name="orderField" style="vertical-align: middle">
                 <option value="--nil--"></option>
         <?php
@@ -186,14 +186,14 @@
         ?>
             </select>
             <input type="radio" name="order" value="ASC" checked="checked" />
-            <?php echo $strAscending; ?>&nbsp;
+            <?php echo  $strAscending ?>&nbsp;
             <input type="radio" name="order" value="DESC" />
-            <?php echo $strDescending; ?><br /><br />
+            <?php echo  $strDescending ?><br /><br />
         </li>
     </ul>
 
     &nbsp;&nbsp;&nbsp;&nbsp;
-    <input type="submit" name="submit" value="<?php echo $strGo; ?>" />
+    <input type="submit" name="submit" value="<?php echo  $strGo ?>" />
 </form>
         <?php
     } // end if
@@ -225,7 +225,7 @@
         $sql_query .= ' WHERE 1';
         for ($i = 0; $i < count($fields); $i++) {
             if (!empty($fields) && $fields[$i] != '') {
-                if (eregi('char|blob|text|set|enum|date|time|year', $types[$i])) {
+                if (preg_match('char|blob|text|set|enum|date|time|year', $types[$i])) {
                     $quot     = '\'';
                 } else {
                     $quot     = '';