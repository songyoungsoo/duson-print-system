# 이미지 가져오고 호버링 잘되게 하는 법

*작성일: 2025년 12월 10일 오후 4시*
*업데이트: 2025년 12월 10일 오후 4시 30분*

## 📋 개요

이 문서는 **두손기획인쇄 시스템**에서 성공적으로 구현된 **이미지 가져오기 + 포스터 방식 호버링 시스템**을 컴포넌트화하기 위한 완전한 가이드입니다.

**핵심 성과**: 전단지와 명함 갤러리에서 **API 기반 이미지 로드**와 **완벽한 호버 리셋 기능**을 성공적으로 구현했습니다.

## 🎯 시스템 특징

### ✅ **성공한 이미지 가져오기 방식**
- **실제 완성 주문**에서 이미지를 가져옴 (`MlangOrder_PrintAuto` 테이블)
- **API 엔드포인트**: `/api/get_real_orders_portfolio.php`
- **카테고리별** 이미지 로드 (`category=inserted` for 전단지)
- **현실감 있는** 실제 고객 작업물 표시

### ✅ **포스터 방식 호버링 시스템**
- **마우스 벗어나면 완벽 초기화** (사용자 요구사항 충족)
- **DOM 클로닝 방식**으로 이벤트 리스너 완전 초기화
- **background-image 기반** 확대/축소
- **부드러운 애니메이션**

## 🏗️ 시스템 아키텍처

### 1. **이미지 가져오기 시스템**

#### **API 엔드포인트**
```javascript
// 성공적으로 작동했던 API 호출
const response = await fetch('/api/get_real_orders_portfolio.php?category=inserted&per_page=4', {
    method: 'GET',
    headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
    }
});
```

#### **데이터베이스 쿼리 로직**
```php
// 전단지 카테고리 필터링
if ($category === 'inserted') {
    $whereClause .= " AND Type = '전단지'";
}

// 이미지가 있는 주문만 선택
$whereClause = "WHERE OrderStyle > '0' 
                AND ThingCate IS NOT NULL 
                AND ThingCate != '' 
                AND LENGTH(ThingCate) > 3
                AND date >= DATE_SUB(NOW(), INTERVAL 2 YEAR)";
```

#### **응답 데이터 구조**
```json
{
  "success": true,
  "data": [
    {
      "path": "/MlangOrder_PrintAuto/upload/83012/20250507160033_681b0511752c5.jpg",
      "title": "왕******님의 전단지 작품",
      "type": "전단지",
      "order_no": 83012
    }
  ],
  "pagination": {...},
  "count": 4
}
```

### 2. **갤러리 렌더링 시스템**

#### **포스터 방식 구조**
```javascript
function renderGallery(images) {
    console.log('🎨 포스터 방식 갤러리 렌더링 시작, 이미지 수:', images.length);
    
    const zoomBox = document.getElementById('posterZoomBox');
    const thumbsContainer = document.getElementById('proofThumbs');
    
    // 포스터 방식: 첫 번째 이미지를 backgroundImage로 설정
    const firstImage = validImages[0];
    zoomBox.style.backgroundImage = `url("${firstImage.path}")`;
    zoomBox.style.backgroundSize = 'contain';
    zoomBox.style.backgroundPosition = '50% 50%';
    
    // 썸네일 생성
    thumbsContainer.innerHTML = validImages.map((img, index) => {
        const title = img.title || `전단지 샘플 ${index + 1}`;
        const isActive = index === 0;
        
        return `
            <div class="thumb ${isActive ? 'active' : ''}" 
                 data-img="${img.path}" 
                 data-index="${index}"
                 onclick="selectThumb(this)">
                <img src="${img.path}" alt="${title}" loading="lazy">
            </div>
        `;
    }).join('');
    
    // 포스터 방식 호버링 시스템 초기화
    initializePosterHover();
}
```

### 3. **포스터 방식 호버링 시스템**

#### **핵심 초기화 함수**
```javascript
function initializePosterHover() {
    console.log('🎯 포스터 방식 호버링 시스템 초기화');
    
    const viewport = document.getElementById('proofLargeViewport');
    
    // 🔥 핵심: DOM 클로닝으로 완전 초기화
    const newViewport = viewport.cloneNode(true);
    viewport.parentNode.replaceChild(newViewport, viewport);
    
    // 새로운 요소 참조
    const refreshedViewport = document.getElementById('proofLargeViewport');
    const zoomBox = document.getElementById('posterZoomBox');
    
    // 전역 변수 초기화
    window.leafletCurrentX = window.leafletTargetX = 50;
    window.leafletCurrentY = window.leafletTargetY = 50;
    window.leafletCurrentSize = window.leafletTargetSize = 100;
    
    // 호버링 이벤트 설정
    setupLeafletHoverEvents(zoomBox);
    
    // 애니메이션 루프 시작
    startLeafletAnimation(zoomBox);
    
    console.log('✅ 전단지 포스터 방식 호버링 설정 완료');
}
```

#### **호버 이벤트 핸들러**
```javascript
function setupLeafletHoverEvents(zoomBox) {
    console.log('🎯 전단지 포스터 방식 호버링 초기화');
    
    // 마우스 움직임 추적
    zoomBox.addEventListener('mousemove', function(e) {
        const rect = zoomBox.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        
        leafletTargetX = x;
        leafletTargetY = y;
        leafletTargetSize = 135; // 1.35배 확대
    });
    
    // 🔥 핵심: 마우스 벗어날 때 완벽 초기화
    zoomBox.addEventListener('mouseleave', function() {
        leafletTargetX = 50;
        leafletTargetY = 50;
        leafletTargetSize = 100;
        console.log('👋 전단지 포스터 방식 호버 초기화');
    });
}
```

#### **부드러운 애니메이션 루프**
```javascript
function startLeafletAnimation(zoomBox) {
    function animate() {
        // 부드러운 보간
        leafletCurrentX += (leafletTargetX - leafletCurrentX) * 0.1;
        leafletCurrentY += (leafletTargetY - leafletCurrentY) * 0.1;
        leafletCurrentSize += (leafletTargetSize - leafletCurrentSize) * 0.1;
        
        // 스타일 적용
        zoomBox.style.backgroundSize = `${leafletCurrentSize}%`;
        zoomBox.style.backgroundPosition = `${leafletCurrentX}% ${leafletCurrentY}%`;
        
        requestAnimationFrame(animate);
    }
    animate();
}
```

### 4. **썸네일 선택 시스템**

```javascript
function selectThumb(thumbElement) {
    console.log('👆 포스터 방식 썸네일 선택:', thumbElement.getAttribute('data-index'));
    
    // 모든 썸네일에서 active 클래스 제거
    document.querySelectorAll('.proof-thumbs .thumb').forEach(function(item) {
        item.classList.remove('active');
        item.setAttribute('aria-selected', 'false');
    });
    
    // 선택한 썸네일에 active 클래스 추가
    thumbElement.classList.add('active');
    thumbElement.setAttribute('aria-selected', 'true');
    
    // 포스터 방식: backgroundImage로 교체
    const imageUrl = thumbElement.getAttribute('data-img');
    const zoomBox = document.getElementById('posterZoomBox');
    
    if (zoomBox && imageUrl) {
        zoomBox.style.backgroundImage = `url("${imageUrl}")`;
        zoomBox.style.backgroundSize = 'contain';
        zoomBox.style.backgroundPosition = '50% 50%';
        
        // 포스터 방식 변수 초기화
        if (window.currentX !== undefined) {
            window.currentX = window.targetX = 50;
            window.currentY = window.targetY = 50;
            window.currentSize = window.targetSize = 100;
        }
        
        console.log('🖼️ 포스터 방식 이미지 교체 완료:', imageUrl);
    }
}
```

## 🎨 CSS 스타일링 시스템

### **메인 뷰어 스타일**
```css
.main-viewer {
    width: 100%;
    height: 300px;
    background-color: #fff;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    margin-bottom: 15px;
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid #e9ecef;
}

.main-viewer:hover {
    border-color: #4caf50;
    box-shadow: 0 8px 30px rgba(76, 175, 80, 0.15);
    transform: translateY(-2px);
}
```

### **썸네일 스타일**
```css
.proof-thumbs .thumb {
    width: 80px;
    height: 60px;
    border: 2px solid transparent;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #f8f9fa;
}

.proof-thumbs .thumb.active {
    border-color: #4caf50;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    transform: scale(1.05);
}

.proof-thumbs .thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
```

## 📦 컴포넌트화 가이드

### **1단계: HTML 구조**
```html
<div class="gallery-container" id="galleryContainer">
    <!-- 메인 뷰어 -->
    <div id="proofLargeViewport" class="main-viewer">
        <div id="posterZoomBox" class="zoom-box"></div>
    </div>
    
    <!-- 썸네일 컨테이너 -->
    <ul id="proofThumbs" class="proof-thumbs" role="list" aria-label="이미지 썸네일 목록">
        <!-- 동적으로 생성됨 -->
    </ul>
    
    <!-- 더보기 버튼 -->
    <button id="moreLeafletBtn" class="more-samples-btn">
        <span>📂</span> 전단지 샘플 더보기
    </button>
</div>
```

### **2단계: JavaScript 컴포넌트**
```javascript
class ImageGalleryComponent {
    constructor(containerId, category) {
        this.container = document.getElementById(containerId);
        this.category = category;
        this.apiEndpoint = '/api/get_real_orders_portfolio.php';
        this.images = [];
        this.currentIndex = 0;
        
        this.init();
    }
    
    async init() {
        await this.loadImages();
        this.render();
        this.setupHover();
    }
    
    async loadImages() {
        // API 호출 로직 (위의 코드 참조)
    }
    
    render() {
        // 갤러리 렌더링 로직 (위의 코드 참조)
    }
    
    setupHover() {
        // 호버링 시스템 초기화 (위의 코드 참조)
    }
}

// 사용법
const leafletGallery = new ImageGalleryComponent('galleryContainer', 'inserted');
```

### **3단계: 카테고리별 설정**
```javascript
const categoryConfig = {
    'inserted': {
        title: '전단지 샘플 갤러리',
        brandColor: '#4caf50',
        apiCategory: 'inserted'
    },
    'namecard': {
        title: '명함 샘플 갤러리', 
        brandColor: '#2196f3',
        apiCategory: 'namecard'
    },
    'sticker': {
        title: '스티커 샘플 갤러리',
        brandColor: '#ff9800',
        apiCategory: 'sticker'
    }
};
```

## 🔧 구현 체크리스트

### ✅ **완료된 항목**
- [x] API 기반 실제 이미지 로드
- [x] 포스터 방식 호버링 구현
- [x] 마우스 벗어나면 완벽 초기화
- [x] DOM 클로닝으로 이벤트 리스너 초기화
- [x] 부드러운 애니메이션 시스템
- [x] 썸네일 선택 기능
- [x] 모바일 반응형 지원
- [x] 접근성 (ARIA) 지원

### 🔄 **추가 개선 가능 항목**
- [ ] 이미지 lazy loading 최적화
- [ ] 캐싱 시스템 구현
- [ ] 에러 처리 강화
- [ ] 성능 모니터링
- [ ] 다국어 지원

## 🎯 핵심 성공 포인트

### **1. 단순함이 핵심**
- 복잡한 애니메이션 시스템 제거
- 포스터의 단순하고 효과적인 방식 채택
- "잘못하고 있어 포스터의 갤러리 시스템만 이용하고 단순한거야" - 사용자 피드백 반영

### **2. 완벽한 호버 리셋**
- `mouseleave` 이벤트에서 완벽한 초기화
- DOM 클로닝으로 이벤트 리스너 완전 재설정
- 사용자 요구사항 "호버링 후 마우스가 벗어나면 초기화가 되어야해" 완벽 충족

### **3. 성공한 API 방식 유지**
- 기존 성공했던 이미지 가져오기 방식 100% 보존
- 실제 고객 작업물 기반 현실감 있는 갤러리
- 안정적인 데이터베이스 쿼리

## 🚀 실제 적용 사례

### **전단지 시스템** (`/MlangPrintAuto/inserted/index.php`)
```javascript
// 페이지 로드 시 자동 초기화
document.addEventListener('DOMContentLoaded', function() {
    console.log('전단지 페이지 초기화 완료 - 성공한 API 방식 갤러리');
    loadLeafletGallery();
});

// API 호출
async function loadLeafletGallery() {
    const response = await fetch('/api/get_real_orders_portfolio.php?category=inserted&per_page=4');
    const data = await response.json();
    
    if (data.success && data.data && data.data.length > 0) {
        console.log(`✅ ${data.data.length}개 전단지 이미지 발견!`);
        renderGallery(data.data);
    }
}
```

### **브라우저 콘솔 성공 로그**
```
🔍 API에서 전단지 이미지 로드 시작
📊 API 응답 데이터: {success: true, data: Array(4)}
✅ 4개 전단지 이미지 발견!
🎨 포스터 방식 갤러리 렌더링 시작, 이미지 수: 4
✅ 포스터 방식 갤러리 렌더링 완료 - 4개 이미지
🎯 전단지 포스터 방식 호버링 초기화
✅ 전단지 포스터 방식 호버링 설정 완료
```

## 📞 지원 및 문의

- **개발팀**: 두손기획인쇄 개발팀
- **기술 문서**: `/MlangPrintAuto/docs/`
- **API 문서**: `/api/get_real_orders_portfolio.php`

---

*이 문서는 실제 성공한 구현을 바탕으로 작성되었으며, 다른 프로젝트에서도 동일한 방식으로 적용 가능합니다.*

**최종 검증**: 2025년 12월 10일 오후 4시 30분 - 전단지 갤러리 호버링 완벽 작동 확인 ✅