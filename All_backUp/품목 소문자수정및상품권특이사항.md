# 품목 소문자 변경 작업 및 상품권 특이사항 분석

## 1. 전체 작업 개요

### 목적
- Linux 파일 시스템의 대소문자 구분 문제 해결
- 일관된 소문자 파일명 체계 구축
- URL 리다이렉트를 통한 하위 호환성 유지

### 작업 범위
- 파일명: 대문자 → 소문자 변경
- PHP 변수: 파일명 참조 변수 소문자화
- 경로 설정: 상대 경로 수정
- .htaccess: 대문자 URL 리다이렉트 규칙 추가

---

## 2. 일반 품목 수정 항목 (전단지, 스티커, 봉투, 카다록, 소량인쇄)

### 2.1 파일명 변경
```bash
# 예시: 전단지(inserted)
inserted_List.php → inserted_list.php
inserted_NoFild.php → inserted_nofild.php
inserted_Script.php → inserted_script.php
inserted_ScriptSearch.php → inserted_scriptsearch.php
```

### 2.2 PHP 변수 수정

#### *_list.php 파일
```php
# 수정 전
$TIO_CODE="Inserted";
$T_DirUrl="../../mlangprintauto";

# 수정 후
$TIO_CODE="inserted";
$T_DirUrl=".";  // condb.php는 같은 디렉토리
```

#### *_admin.php 파일
```php
# 수정 전
$T_DirUrl=".";
$T_TABLE="Inserted";

# 수정 후
$T_DirUrl="../../mlangprintauto";  // inc.php 등은 다른 디렉토리
$T_TABLE="inserted";
include"./condb.php";  // condb.php는 현재 디렉토리
```

### 2.3 파일 참조 수정
```php
# listsearchbox.php
${TIO_CODE}_ScriptSearch.php → ${TIO_CODE}_scriptsearch.php

# *_list.php
CateList.php → catelist.php
ConDb.php → condb.php
ListSearchBox.php → listsearchbox.php
```

### 2.4 메뉴 파일 수정 (js/MlangMenu.php)
```javascript
// 모든 대문자 파일명을 소문자로 변경
'/admin/mlangprintauto/inserted_List.php' → '/admin/mlangprintauto/inserted_list.php'
```

---

## 3. 특수 품목 추가 수정 사항

### 3.1 명함 (NameCard)

#### 특이사항
- 별도의 `$TIO_CODE_ADMIN` 변수 사용

#### 추가 수정
```php
# namecard_list.php
$TIO_CODE="namecard";
$TIO_CODE_ADMIN="NameCard";  // 수정 전
$TIO_CODE_ADMIN="namecard";  // 수정 후

# namecard_admin.php
$T_TABLE="NameCard";  // 수정 전
$T_TABLE="namecard";  // 수정 후
```

### 3.2 양식지 (NcrFlambeau)

#### 추가 수정
```php
# ncrflambeau_admin.php
$T_TABLE="NcrFlambeau";  // 수정 전
$T_TABLE="ncrflambeau";  // 수정 후
```

### 3.3 상품권 (MerchandiseBond) ⚠️ 가장 복잡

#### 특이사항 1: 하드코딩된 파일명
```php
# merchandisebond_admin.php
include"./MerchandiseBond_nofild.php";  // 수정 전
include"./merchandisebond_nofild.php";  // 수정 후

<?include"MerchandiseBond_script.php";?>  // 수정 전
<?include"merchandisebond_script.php";?>  // 수정 후
```

#### 특이사항 2: mysqli_query() 파라미터 오류
```php
# merchandisebond_script.php
# 수정 전 (3번째 파라미터 중복)
mysqli_query($db, "select * from $GGTABLE where ...", $db);

# 수정 후
mysqli_query($db, "select * from $GGTABLE where ...");
```

#### 특이사항 3: mysqli_close() 조기 호출
```php
# merchandisebond_script.php
# 문제: script 파일이 include되면서 DB 연결을 닫아버림
mysqli_close($db);  // 수정 전

# 수정 후 (주석 처리)
// mysqli_close($db);
```

#### 특이사항 4: 배열 키 따옴표 누락 (PHP 경고)
```php
# 수정 전
$row[no]
$row[title]
$row_Two[no]
$row_Two[title]

# 수정 후
$row['no']
$row['title']
$row_Two['no']
$row_Two['title']
```

#### 특이사항 5: 큰따옴표 내 배열 참조 오류
```php
# 수정 전 (구문 오류 발생)
"select * from $GGTABLE where BigNo='$row['no']'"
echo("'$row_Two['title']',");
$MlangPrintAutoFildView_style=="$row['no']"

# 수정 후 (중괄호로 감싸기)
"select * from $GGTABLE where BigNo='{$row['no']}'"
echo("'{$row_Two['title']}',");
$MlangPrintAutoFildView_style=="{$row['no']}"
```

---

## 4. 상품권이 다른 품목과 달랐던 점 요약

### 4.1 코드 품질 문제
1. **mysqli 함수 사용 오류**: 파라미터 중복, 조기 연결 종료
2. **배열 키 따옴표 누락**: PHP 7.4+ 경고 발생
3. **문자열 내 배열 참조 오류**: 중괄호 미사용으로 구문 오류

### 4.2 파일명 하드코딩
- 다른 품목: `{$T_TABLE}_nofild.php` (변수 사용)
- 상품권: `MerchandiseBond_nofild.php` (하드코딩)

### 4.3 데이터베이스 연결 관리
- 다른 품목: DB 연결 유지
- 상품권: script 파일에서 `mysqli_close()` 호출로 연결 종료

---

## 5. Apache 설정 변경

### 5.1 mod_rewrite 활성화
```bash
sudo a2enmod rewrite
sudo service apache2 restart
```

### 5.2 AllowOverride 설정
```apache
# /etc/apache2/apache2.conf
<Directory /var/www/>
    Options Indexes FollowSymLinks
    AllowOverride All  # None → All로 변경
    Require all granted
</Directory>
```

### 5.3 .htaccess 생성
```apache
# /var/www/html/admin/MlangPrintAuto/.htaccess
RewriteEngine On
RewriteBase /admin/mlangprintauto/

# 대문자 패턴을 소문자로 리다이렉트
RewriteRule ^(.*)_List\.php$ $1_list.php [R=301,L]
RewriteRule ^(.*)_NoFild\.php$ $1_nofild.php [R=301,L]
RewriteRule ^(.*)_Script\.php$ $1_script.php [R=301,L]
RewriteRule ^(.*)_ScriptSearch\.php$ $1_scriptsearch.php [R=301,L]

# 기타 대문자 파일명
RewriteRule ^CateList\.php$ catelist.php [R=301,L]
RewriteRule ^OrderList\.php$ orderlist.php [R=301,L]
# ... 기타 규칙
```

---

## 6. 작업 체크리스트

### 각 품목별 수정 항목
- [ ] 파일명 소문자 변경 (*_List.php, *_NoFild.php, *_Script.php, *_ScriptSearch.php)
- [ ] *_list.php: `$TIO_CODE` 소문자 변경
- [ ] *_list.php: `$T_DirUrl="."` 설정
- [ ] *_admin.php: `$T_TABLE` 소문자 변경
- [ ] *_admin.php: `$T_DirUrl="../../mlangprintauto"` 설정
- [ ] *_admin.php: `include"./condb.php"` 확인
- [ ] 하드코딩된 파일명 검색 및 수정
- [ ] 메뉴 파일(js/MlangMenu.php) URL 소문자 변경

### 상품권 추가 체크리스트
- [ ] mysqli_query() 파라미터 확인 (중복 $db 제거)
- [ ] mysqli_close() 주석 처리
- [ ] 배열 키에 따옴표 추가 ($row[no] → $row['no'])
- [ ] 큰따옴표 내 배열 참조 중괄호 추가 ("$row['no']" → "{$row['no']}")

---

## 7. 디버깅 팁

### PHP 구문 검사
```bash
php -l filename.php
```

### 배열 키 따옴표 누락 찾기
```bash
grep -n '\$row\[' *.php | grep -v "'\|\"" 
```

### 큰따옴표 내 배열 참조 찾기
```bash
grep -n '"\$.*\[.*\]' *.php
```

### mysqli_close 찾기
```bash
grep -n 'mysqli_close' *.php
```

---

## 8. 결론

상품권(MerchandiseBond)은 다른 품목에 비해:
1. **코드 품질이 낮음**: mysqli 함수 오류, 배열 키 따옴표 누락
2. **하드코딩 많음**: 변수 대신 직접 파일명 입력
3. **DB 연결 관리 문제**: 조기 연결 종료로 후속 쿼리 실패

이러한 문제들로 인해 단순 파일명 변경만으로는 해결되지 않았으며, 코드 수정이 추가로 필요했습니다.

향후 새로운 품목 추가 시에는 전단지(inserted)나 스티커(sticker)를 템플릿으로 사용하는 것을 권장합니다.
