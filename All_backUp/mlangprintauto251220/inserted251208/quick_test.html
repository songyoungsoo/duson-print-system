<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>âš¡ ë¹ ë¥¸ ì²´í¬ë°•ìŠ¤ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 40px; background: #ecf0f1; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; border-bottom: 3px solid #3498db; padding-bottom: 20px; }
        .status { padding: 20px; margin: 20px 0; border-radius: 8px; font-size: 16px; }
        .status.pending { background: #fff3cd; border-left: 5px solid #ffc107; }
        .status.success { background: #d4edda; border-left: 5px solid #28a745; }
        .status.error { background: #f8d7da; border-left: 5px solid #dc3545; }
        button { background: #3498db; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; margin: 10px 5px; }
        button:hover { background: #2980b9; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .code { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; margin: 15px 0; white-space: pre-wrap; }
        .step { background: #ecf0f1; padding: 15px; margin: 15px 0; border-radius: 5px; border-left: 5px solid #3498db; }
        .step-number { background: #3498db; color: white; border-radius: 50%; width: 35px; height: 35px; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ ì¶”ê°€ì˜µì…˜ ì²´í¬ë°•ìŠ¤ ë¹ ë¥¸ í…ŒìŠ¤íŠ¸</h1>

        <div class="status pending" id="status">
            <strong>ğŸ“‹ ìƒíƒœ:</strong> í…ŒìŠ¤íŠ¸ ì¤€ë¹„ë¨. ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì§„ë‹¨ì„ ì‹œì‘í•˜ì„¸ìš”.
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button onclick="runQuickTest()">ğŸš€ ë¹ ë¥¸ ì§„ë‹¨ ì‹¤í–‰</button>
            <button onclick="openRealPage()" style="background: #16a085;">ğŸ”— ì‹¤ì œ í˜ì´ì§€ ì—´ê¸°</button>
            <button onclick="openDiagnosticPage()" style="background: #8e44ad;">ğŸ” ìƒì„¸ ì§„ë‹¨ í˜ì´ì§€ ì—´ê¸°</button>
        </div>

        <div id="results"></div>

        <div class="step">
            <span class="step-number">1</span>
            <strong>ë¬¸ì œ ìƒí™©:</strong> ì‚¬ìš©ìê°€ ì½”íŒ… ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí–ˆë‹¤ê³  ì£¼ì¥í•˜ì§€ë§Œ, ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì˜µì…˜ ê°€ê²©ì´ 0ì›ìœ¼ë¡œ ì €ì¥ë¨
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>ê°€ëŠ¥í•œ ì›ì¸:</strong>
            <ul>
                <li>JavaScript ì´ˆê¸°í™” ì‹¤íŒ¨ (DOMContentLoaded ë¯¸ì‹¤í–‰)</li>
                <li>ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì²´í¬ë°•ìŠ¤ì— ë°”ì¸ë”©ë˜ì§€ ì•ŠìŒ</li>
                <li>ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•ŠìŒ</li>
                <li>Hidden í•„ë“œ ì—…ë°ì´íŠ¸ ë¡œì§ ì˜¤ë¥˜</li>
            </ul>
        </div>

        <div class="step">
            <span class="step-number">3</span>
            <strong>ì§„ë‹¨ ë°©ë²•:</strong>
            <ol>
                <li>"ë¹ ë¥¸ ì§„ë‹¨ ì‹¤í–‰" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìë™ ì§„ë‹¨</li>
                <li>ë˜ëŠ” "ì‹¤ì œ í˜ì´ì§€ ì—´ê¸°"ë¥¼ ëˆŒëŸ¬ ì§ì ‘ í…ŒìŠ¤íŠ¸</li>
                <li>ì²´í¬ë°•ìŠ¤ë¥¼ í´ë¦­í•˜ê³  ë¸Œë¼ìš°ì € ì½˜ì†”(F12) í™•ì¸</li>
            </ol>
        </div>

        <div class="step">
            <span class="step-number">4</span>
            <strong>ì˜ˆìƒë˜ëŠ” ì½˜ì†” ë©”ì‹œì§€:</strong>
            <div class="code">âœ… ì •ìƒ ì‘ë™ ì‹œ:
ğŸ” DOMContentLoaded - additionalOptionsSection ì¡´ì¬: true
â° 100ms ì§€ì—° í›„ ì´ˆê¸°í™” ì‹œì‘...
ğŸ”§ ì¶”ê°€ ì˜µì…˜ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
ğŸ” ì²´í¬ë°•ìŠ¤ ê°œìˆ˜: 3
  [0] ì²´í¬ë°•ìŠ¤ ID: coating_enabled name: coating_enabled
  [1] ì²´í¬ë°•ìŠ¤ ID: folding_enabled name: folding_enabled
  [2] ì²´í¬ë°•ìŠ¤ ID: creasing_enabled name: creasing_enabled
âœ… ì¶”ê°€ ì˜µì…˜ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ (ë©”ì¸ ì‹œìŠ¤í…œ ì´í›„)

âŒ ë¬¸ì œ ë°œìƒ ì‹œ:
âŒ additionalOptionsSectionì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!
ë˜ëŠ”
ğŸ” ì²´í¬ë°•ìŠ¤ ê°œìˆ˜: 0
âŒ ì¶”ê°€ì˜µì…˜ ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!</div>
        </div>
    </div>

    <script>
        function updateStatus(message, type = 'pending') {
            const statusEl = document.getElementById('status');
            statusEl.className = 'status ' + type;
            statusEl.innerHTML = '<strong>ğŸ“‹ ìƒíƒœ:</strong> ' + message;
        }

        function showResults(html) {
            document.getElementById('results').innerHTML = html;
        }

        function runQuickTest() {
            updateStatus('í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...', 'pending');

            // iframeìœ¼ë¡œ ì‹¤ì œ í˜ì´ì§€ ë¡œë“œ
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'index.php';
            document.body.appendChild(iframe);

            iframe.onload = function() {
                setTimeout(() => {
                    const doc = iframe.contentDocument || iframe.contentWindow.document;
                    const win = iframe.contentWindow;

                    let results = '<div style="margin-top: 30px;">';
                    results += '<h2 style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">ğŸ” ì§„ë‹¨ ê²°ê³¼</h2>';

                    // 1. HTML ìš”ì†Œ í™•ì¸
                    const section = doc.getElementById('additionalOptionsSection');
                    const checkboxes = doc.querySelectorAll('.option-toggle');

                    results += '<div class="step">';
                    results += '<strong>âœ… HTML êµ¬ì¡°:</strong><br>';
                    results += `- additionalOptionsSection: ${section ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>`;
                    results += `- .option-toggle ì²´í¬ë°•ìŠ¤: ${checkboxes.length}ê°œ ${checkboxes.length === 3 ? 'âœ…' : 'âŒ (ì˜ˆìƒ: 3ê°œ)'}<br>`;
                    results += '</div>';

                    // 2. JavaScript í•¨ìˆ˜ í™•ì¸
                    const hasInit = typeof win.initAdditionalOptions === 'function';
                    const hasGetTotal = typeof win.getAdditionalOptionsTotal === 'function';
                    const hasInstance = typeof win.additionalOptionsManager !== 'undefined';

                    results += '<div class="step">';
                    results += '<strong>ğŸ“¦ JavaScript í•¨ìˆ˜:</strong><br>';
                    results += `- initAdditionalOptions: ${hasInit ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>`;
                    results += `- getAdditionalOptionsTotal: ${hasGetTotal ? 'âœ… ì¡´ì¬' : 'âŒ ì—†ìŒ'}<br>`;
                    results += `- additionalOptionsManager ì¸ìŠ¤í„´ìŠ¤: ${hasInstance ? 'âœ… ìƒì„±ë¨' : 'âŒ ì•„ì§ ì—†ìŒ'}<br>`;
                    results += '</div>';

                    // 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í…ŒìŠ¤íŠ¸
                    if (checkboxes.length > 0) {
                        const coating = doc.getElementById('coating_enabled');
                        const coatingPriceBefore = doc.getElementById('coating_price')?.value || '0';

                        results += '<div class="step">';
                        results += '<strong>ğŸ¯ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í…ŒìŠ¤íŠ¸:</strong><br>';
                        results += `- ì½”íŒ… ì²´í¬ë°•ìŠ¤ ì´ˆê¸° ìƒíƒœ: ${coating?.checked ? 'checked' : 'unchecked'}<br>`;
                        results += `- ì´ˆê¸° coating_price: ${coatingPriceBefore}ì›<br>`;

                        // ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
                        if (coating) {
                            coating.checked = true;
                            coating.dispatchEvent(new Event('change', { bubbles: true }));

                            setTimeout(() => {
                                const coatingPriceAfter = doc.getElementById('coating_price')?.value || '0';
                                const coatingOptions = doc.getElementById('coating_options');

                                results += `- í´ë¦­ í›„ coating_price: ${coatingPriceAfter}ì› ${coatingPriceAfter !== '0' ? 'âœ…' : 'âŒ'}<br>`;
                                results += `- ì½”íŒ… ì˜µì…˜ ìƒì„¸ í‘œì‹œ: ${coatingOptions && coatingOptions.style.display !== 'none' ? 'âœ… í‘œì‹œë¨' : 'âŒ ìˆ¨ê²¨ì§'}<br>`;
                                results += '</div>';

                                // ìµœì¢… íŒì •
                                if (section && checkboxes.length === 3 && hasInit && hasGetTotal && coatingPriceAfter !== '0') {
                                    updateStatus('âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.', 'success');
                                    results += '<div class="status success"><strong>ğŸ‰ ê²°ë¡ :</strong> ì¶”ê°€ì˜µì…˜ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì²´í¬ë°•ìŠ¤ë¥¼ ì‹¤ì œë¡œ í´ë¦­í•˜ì§€ ì•Šì•˜ê±°ë‚˜, ì£¼ë¬¸ ì „ì— ì²´í¬ë¥¼ í•´ì œí–ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.</div>';
                                } else {
                                    updateStatus('âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ë¬¸ì œê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
                                    results += '<div class="status error"><strong>âš ï¸ ê²°ë¡ :</strong> ì¶”ê°€ì˜µì…˜ ì‹œìŠ¤í…œì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:<br>';
                                    if (!section || checkboxes.length !== 3) results += '- HTML êµ¬ì¡° ëˆ„ë½<br>';
                                    if (!hasInit || !hasGetTotal) results += '- JavaScript ë¡œë”© ì‹¤íŒ¨<br>';
                                    if (!hasInstance) results += '- ì´ˆê¸°í™” ë¯¸ì‹¤í–‰ (DOMContentLoaded ë¬¸ì œ)<br>';
                                    if (coatingPriceAfter === '0') results += '- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¯¸ë°”ì¸ë”©<br>';
                                    results += '</div>';
                                }

                                results += '</div>';
                                showResults(results);

                                // cleanup
                                document.body.removeChild(iframe);
                            }, 500);
                        }
                    } else {
                        updateStatus('âŒ ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                        results += '</div>';
                        showResults(results);
                        document.body.removeChild(iframe);
                    }

                }, 1500); // DOMContentLoaded ëŒ€ê¸°
            };
        }

        function openRealPage() {
            window.open('index.php', '_blank');
        }

        function openDiagnosticPage() {
            window.open('diagnose_events.html', '_blank');
        }
    </script>
</body>
</html>
