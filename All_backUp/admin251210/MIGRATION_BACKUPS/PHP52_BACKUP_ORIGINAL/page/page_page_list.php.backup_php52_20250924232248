<?
$M123="..";
include"../top.php"; 
?>

<script language="JavaScript">
function MM_jumpMenu(targ,selObj,restore){
  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");
  if (restore) selObj.selectedIndex=0;
}
</script>

<table border=0 align=center width=100% cellpadding='0' cellspacing='0'>

<tr><td align=center>

<table border=0 align=center width=100% cellpadding=0 cellspacing=0>
<tr><td width=100% height=40 class='coolBar' align=right>

<table border=0 cellpadding=0 cellspacing=0><tr>
<td width=20></td>
<td>
<?
include"$M123/../db.php";
$result= mysql_query("select * from $page_big_table",$db);
$rows=mysql_num_rows($result);
if($rows){
echo("<select name='cate' onChange=\"MM_jumpMenu('parent',this,0)\"><option>-주메뉴 자료보기-</option>");
while($row= mysql_fetch_array($result)) 
{ 
echo("<option value='$PHP_SELF?cate=$row[no]'>$row[title]</option>");
}
echo("</select>");
}else{echo("&nbsp;&nbsp;&nbsp;<b>등록 자료가 없음.(주메뉴를등록해주세요!!)</b>");}

mysql_close($db); 
?>
</td>

<head>
<script language=javascript>
function SrarchCheckField()
{
var f=document.SrarchInfo;

if (f.search.value == "") {
alert("검색할 내용을 입력하세요!!");
return false;
}

}
</script>
</head>

<form name='SrarchInfo' method='post' OnSubmit='javascript:return SrarchCheckField()' action='<?echo("$PHP_SELF");?>'>
<td>
&nbsp;&nbsp;&nbsp;메뉴내용검색
<input type='text' name='search' size='25'>
<input type='submit' value='검색'>
</td>
</form>
<td>
&nbsp;&nbsp;
<input type='button' onClick="javascript:window.location.href='<?echo("$PHP_SELF");?>';" value='전체목록보기' style='width:80;'>
<input type='button' onClick="javascript:window.location.reload();" value='새로고침' style='width:60;'>
&nbsp;
</tr></table>

</td></tr>
</table>



<!------------------------------------------- 리스트 시작----------------------------------------->
<?
include"$M123/../db.php";
$table="$page_table";

if($cate){$Mlang_query="select * from $table where cate='$cate'";}else if($search){$Mlang_query="select * from $table where title like '%$search%'";}else{$Mlang_query="select * from $table";}


$query= mysql_query("$Mlang_query",$db);
$recordsu= mysql_num_rows($query);
$total = mysql_affected_rows();

$listcut= 15;  //한 페이지당 보여줄 목록 게시물수. 
if(!$offset) $offset=0; 

$result= mysql_query("$Mlang_query order by NO desc limit $offset,$listcut",$db);
$rows=mysql_num_rows($result);
if($rows){

echo("
<table border=0 align=center width=100% cellpadding='5' cellspacing='1' bgcolor='#666600'>
<tr>
<td align=center width=20% height=30><font color=white>등록번호</font></td>
<td align=center width=30%><font color=white>저장위치</font></td>
<td align=center width=30%><font color=white>메뉴 내용</font></td>
<td align=center width=20%><font color=white>관리기능</font></td>
</tr>	
");

$i=1+$offset;
while($row= mysql_fetch_array($result)) 
{ 
?>

<script>
// 소스 제작자 : http://www.script.ne.kr - Mlang
// 현글삭제하지마셔염 제작자의 자존심 입니다.
function delete_Mlang<?echo("$row[no]");?>()
{	
if(confirm("한번 삭제한 자료는 두번다시 복구 되지 않습니다.\n\n실행 하시겠습니까...............*^^*"))
if (navigator.appName == "Netscape") 
{
popup=window.open("./page_admin.php?mode=delete&no=<?echo("$row[no]");?>","pop_mlang6633","width=500,height=200,left=2000,top=2000")
popup.focus();
}
else{
popup=window.open("./page_admin.php?mode=delete&no=<?echo("$row[no]");?>","pop_mlang6633","width=500,height=200,left=2000,top=2000")
popup.focus();
}
}
</script>

<?
echo("
<tr bgcolor='#FFFFFF'>
<td>$row[no]</td>");

///////////////////////////////////////////////////////////////////////////////
$result_C_cate= mysql_query("select * from $page_big_table where no='$row[cate]'",$db);
$row_C_cate= mysql_fetch_array($result_C_cate);
///////////////////////////////////////////////////////////////////////////////
echo("<td>$row_C_cate[title]</td>");


if ($search) //검색 키워드값
{$row[title] = str_replace($search, "<b><FONT COLOR=RED>$search</FONT></b>", $row[title]);}

echo("<td>$row[title]</td>
<td align=center>
<input type='button' onClick=\"javascript:window.location.href='./page_admin.php?mode=modify&no=$row[no]';\" value='수정' style='width:50;'>
<input type='button' onClick=\"delete_Mlang$row[no]();return false;\" value='삭제'  style='width:50;'>	
</td>
</tr>
");		
		
		$i=$i+1;
} 

echo("</table>");

}else{
echo"<p align=center><b>등록 자료없음</b></p>";
}

?>

<p align='center'>

<?
if($rows){

$mlang_pagego="cate=$cate&search=$search"; // 필드속성들 전달값

$pagecut= 7;  //한 장당 보여줄 페이지수 
$one_bbs= $listcut*$pagecut;  //한 장당 실을 수 있는 목록(게시물)수 
$start_offset= intval($offset/$one_bbs)*$one_bbs;  //각 장에 처음 페이지의 $offset값. 
$end_offset= intval($recordsu/$one_bbs)*$one_bbs;  //마지막 장의 첫페이지의 $offset값. 
$start_page= intval($start_offset/$listcut)+1; //각 장에 처음 페이지의 값. 
$end_page= ($recordsu%$listcut>0)? intval($recordsu/$listcut)+1: intval($recordsu/$listcut); 
//마지막 장의 끝 페이지. 
if($start_offset!= 0) 
{ 
  $apoffset= $start_offset- $one_bbs; 
  echo "<a href='$PHP_SELF?offset=$apoffset&$mlang_pagego'>...[이전]</a>&nbsp;"; 
} 

for($i= $start_page; $i< $start_page+$pagecut; $i++) 
{ 
$newoffset= ($i-1)*$listcut; 

if($offset!= $newoffset) 
  echo "&nbsp;<a href='$PHP_SELF?offset=$newoffset&$mlang_pagego'>"; 
echo "[$i]"; 
if($offset!= $newoffset) 
  echo "</a>&nbsp;"; 

if($i==$end_page) break; 
} 

if($start_offset!= $end_offset) 
{ 
  $nextoffset= $start_offset+ $one_bbs; 
  echo "&nbsp;<a href='$PHP_SELF?offset=$nextoffset&$mlang_pagego'>[다음]...</a>"; 
} 
echo "총목록갯수: $end_page 개"; 


}

mysql_close($db); 
?> 

</p>
<!------------------------------------------- 리스트 끝----------------------------------------->	  




</td></tr>
</table>


<? include"../down.php";?>