<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª ì‹¤ì‹œê°„ ì˜µì…˜ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #2c3e50; }
        .test-area { border: 2px solid #3498db; padding: 20px; margin: 20px 0; border-radius: 5px; }
        .result { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        button:hover { background: #2980b9; }
        button:disabled { background: #95a5a6; cursor: not-allowed; }
        .log { background: #263238; color: #aed581; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; margin: 10px 0; }
        .log-entry { margin: 5px 0; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #3498db; color: white; }
        .highlight { background: #fff3cd; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ì¶”ê°€ì˜µì…˜ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸</h1>

        <div class="result info">
            <strong>ğŸ“Œ ì´ í˜ì´ì§€ì˜ ëª©ì :</strong><br>
            ì „ë‹¨ì§€ í˜ì´ì§€ì˜ ì¶”ê°€ì˜µì…˜ ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ì‹¤ì‹œê°„ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.<br>
            iframeì„ í†µí•´ ì‹¤ì œ í˜ì´ì§€ë¥¼ ë¡œë“œí•˜ê³ , JavaScriptê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
        </div>

        <h2>ğŸ® ìë™ í…ŒìŠ¤íŠ¸</h2>
        <div class="test-area">
            <button onclick="runTest1()">í…ŒìŠ¤íŠ¸ 1: í˜ì´ì§€ ë¡œë“œ í™•ì¸</button>
            <button onclick="runTest2()">í…ŒìŠ¤íŠ¸ 2: ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜</button>
            <button onclick="runTest3()">í…ŒìŠ¤íŠ¸ 3: Hidden í•„ë“œ ê°’ í™•ì¸</button>
            <button onclick="runTest4()">í…ŒìŠ¤íŠ¸ 4: ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤</button>
            <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        </div>

        <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div id="results"></div>

        <h2>ğŸ“ ìƒì„¸ ë¡œê·¸</h2>
        <div id="log" class="log"></div>

        <h2>ğŸ–¼ï¸ ì „ë‹¨ì§€ í˜ì´ì§€ (iframe)</h2>
        <div class="result warning">
            <strong>âš ï¸ ì£¼ì˜:</strong> ì•„ë˜ iframeì—ì„œ ì§ì ‘ ì²´í¬ë°•ìŠ¤ë¥¼ í´ë¦­í•´ë³´ê³ , ìœ„ì˜ "í…ŒìŠ¤íŠ¸ 3" ë²„íŠ¼ì„ ëˆŒëŸ¬ ê°’ì´ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
        </div>
        <iframe id="testFrame" src="index.php" style="width: 100%; height: 800px; border: 1px solid #ddd; border-radius: 5px;"></iframe>
    </div>

    <script>
        let logEntries = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push(entry);

            const logDiv = document.getElementById('log');
            const entryDiv = document.createElement('div');
            entryDiv.className = 'log-entry';
            entryDiv.textContent = entry;
            logDiv.appendChild(entryDiv);
            logDiv.scrollTop = logDiv.scrollHeight;

            console.log(message);
        }

        function clearLog() {
            logEntries = [];
            document.getElementById('log').innerHTML = '';
            document.getElementById('results').innerHTML = '';
            log('ë¡œê·¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function showResult(title, content, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>${title}</strong><br>${content}`;
            resultsDiv.appendChild(resultDiv);
        }

        function getIframeDocument() {
            const iframe = document.getElementById('testFrame');
            return iframe.contentDocument || iframe.contentWindow.document;
        }

        function runTest1() {
            log('ğŸ§ª í…ŒìŠ¤íŠ¸ 1 ì‹œì‘: í˜ì´ì§€ ë¡œë“œ í™•ì¸');

            const doc = getIframeDocument();

            // 1. additionalOptionsSection ì¡´ì¬ í™•ì¸
            const section = doc.getElementById('additionalOptionsSection');
            if (section) {
                log('âœ… additionalOptionsSection ì°¾ìŒ');
                showResult('âœ… Step 1 í†µê³¼', 'additionalOptionsSectionì´ ì¡´ì¬í•©ë‹ˆë‹¤.', 'success');
            } else {
                log('âŒ additionalOptionsSection ì—†ìŒ');
                showResult('âŒ Step 1 ì‹¤íŒ¨', 'additionalOptionsSectionì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            // 2. ì²´í¬ë°•ìŠ¤ í™•ì¸
            const checkboxes = doc.querySelectorAll('.option-toggle');
            log(`ğŸ” ì²´í¬ë°•ìŠ¤ ê°œìˆ˜: ${checkboxes.length}`);

            if (checkboxes.length === 3) {
                showResult('âœ… Step 2 í†µê³¼', `ì²´í¬ë°•ìŠ¤ 3ê°œ ë°œê²¬: ${Array.from(checkboxes).map(cb => cb.id).join(', ')}`, 'success');
                checkboxes.forEach((cb, i) => {
                    log(`  [${i}] ${cb.id}: checked=${cb.checked}`);
                });
            } else {
                showResult('âŒ Step 2 ì‹¤íŒ¨', `ì²´í¬ë°•ìŠ¤ ê°œìˆ˜ê°€ ${checkboxes.length}ê°œì…ë‹ˆë‹¤ (ì˜ˆìƒ: 3ê°œ)`, 'error');
            }

            // 3. Hidden í•„ë“œ í™•ì¸
            const hiddenFields = ['coating_price', 'folding_price', 'creasing_price', 'additional_options_total'];
            let allFound = true;
            hiddenFields.forEach(field => {
                const element = doc.getElementById(field);
                if (element) {
                    log(`âœ… Hidden í•„ë“œ ë°œê²¬: ${field} = ${element.value}`);
                } else {
                    log(`âŒ Hidden í•„ë“œ ì—†ìŒ: ${field}`);
                    allFound = false;
                }
            });

            if (allFound) {
                showResult('âœ… Step 3 í†µê³¼', 'Hidden í•„ë“œ ëª¨ë‘ ì¡´ì¬í•©ë‹ˆë‹¤.', 'success');
            } else {
                showResult('âŒ Step 3 ì‹¤íŒ¨', 'ì¼ë¶€ Hidden í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function runTest2() {
            log('ğŸ§ª í…ŒìŠ¤íŠ¸ 2 ì‹œì‘: ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œë®¬ë ˆì´ì…˜');

            const doc = getIframeDocument();
            const coatingCheckbox = doc.getElementById('coating_enabled');

            if (!coatingCheckbox) {
                showResult('âŒ í…ŒìŠ¤íŠ¸ 2 ì‹¤íŒ¨', 'ì½”íŒ… ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            log('ğŸ“ ì½”íŒ… ì²´í¬ë°•ìŠ¤ í´ë¦­ ì „ ìƒíƒœ: checked=' + coatingCheckbox.checked);

            // ì²´í¬ë°•ìŠ¤ í´ë¦­
            coatingCheckbox.checked = true;
            coatingCheckbox.dispatchEvent(new Event('change', { bubbles: true }));

            log('ğŸ“ ì½”íŒ… ì²´í¬ë°•ìŠ¤ í´ë¦­ í›„ ìƒíƒœ: checked=' + coatingCheckbox.checked);

            // 1ì´ˆ í›„ ê²°ê³¼ í™•ì¸
            setTimeout(() => {
                const coatingOptions = doc.getElementById('coating_options');
                if (coatingOptions && coatingOptions.style.display !== 'none') {
                    log('âœ… ì½”íŒ… ì˜µì…˜ ìƒì„¸ê°€ í‘œì‹œë¨');
                    showResult('âœ… í…ŒìŠ¤íŠ¸ 2 í†µê³¼', 'ì²´í¬ë°•ìŠ¤ í´ë¦­ ì‹œ ì˜µì…˜ ìƒì„¸ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.', 'success');
                } else {
                    log('âŒ ì½”íŒ… ì˜µì…˜ ìƒì„¸ê°€ í‘œì‹œë˜ì§€ ì•ŠìŒ');
                    showResult('âŒ í…ŒìŠ¤íŠ¸ 2 ì‹¤íŒ¨', 'ì²´í¬ë°•ìŠ¤ í´ë¦­í–ˆì§€ë§Œ ì˜µì…˜ ìƒì„¸ê°€ í‘œì‹œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. JavaScript ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', 'error');
                }
            }, 1000);
        }

        function runTest3() {
            log('ğŸ§ª í…ŒìŠ¤íŠ¸ 3 ì‹œì‘: Hidden í•„ë“œ ê°’ í™•ì¸');

            const doc = getIframeDocument();

            const table = '<table>' +
                '<tr><th>í•„ë“œëª…</th><th>í˜„ì¬ê°’</th><th>ìƒíƒœ</th></tr>' +
                `<tr><td>coating_enabled (ì²´í¬ë°•ìŠ¤)</td><td>${doc.getElementById('coating_enabled')?.checked ? 'checked' : 'unchecked'}</td><td>${doc.getElementById('coating_enabled')?.checked ? 'âœ…' : 'âš ï¸'}</td></tr>` +
                `<tr class="highlight"><td>coating_price</td><td>${doc.getElementById('coating_price')?.value || 'N/A'}</td><td>${parseInt(doc.getElementById('coating_price')?.value || 0) > 0 ? 'âœ…' : 'âš ï¸'}</td></tr>` +
                `<tr><td>folding_enabled (ì²´í¬ë°•ìŠ¤)</td><td>${doc.getElementById('folding_enabled')?.checked ? 'checked' : 'unchecked'}</td><td>${doc.getElementById('folding_enabled')?.checked ? 'âœ…' : 'âš ï¸'}</td></tr>` +
                `<tr class="highlight"><td>folding_price</td><td>${doc.getElementById('folding_price')?.value || 'N/A'}</td><td>${parseInt(doc.getElementById('folding_price')?.value || 0) > 0 ? 'âœ…' : 'âš ï¸'}</td></tr>` +
                `<tr><td>creasing_enabled (ì²´í¬ë°•ìŠ¤)</td><td>${doc.getElementById('creasing_enabled')?.checked ? 'checked' : 'unchecked'}</td><td>${doc.getElementById('creasing_enabled')?.checked ? 'âœ…' : 'âš ï¸'}</td></tr>` +
                `<tr class="highlight"><td>creasing_price</td><td>${doc.getElementById('creasing_price')?.value || 'N/A'}</td><td>${parseInt(doc.getElementById('creasing_price')?.value || 0) > 0 ? 'âœ…' : 'âš ï¸'}</td></tr>` +
                `<tr class="highlight" style="background: #fff3cd; font-weight: bold;"><td>additional_options_total</td><td>${doc.getElementById('additional_options_total')?.value || 'N/A'}</td><td>${parseInt(doc.getElementById('additional_options_total')?.value || 0) > 0 ? 'âœ… ì •ìƒ' : 'âš ï¸ 0ì›'}</td></tr>` +
                '</table>';

            showResult('ğŸ“Š Hidden í•„ë“œ í˜„ì¬ ìƒíƒœ', table, 'info');

            const total = parseInt(doc.getElementById('additional_options_total')?.value || 0);
            if (total > 0) {
                log(`âœ… ì¶”ê°€ì˜µì…˜ ì´ì•¡: ${total.toLocaleString()}ì›`);
            } else {
                log(`âš ï¸ ì¶”ê°€ì˜µì…˜ ì´ì•¡ì´ 0ì›ì…ë‹ˆë‹¤. ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.`);
            }
        }

        function runTest4() {
            log('ğŸ§ª í…ŒìŠ¤íŠ¸ 4 ì‹œì‘: ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤');

            clearLog();
            log('=== ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');

            setTimeout(() => { runTest1(); }, 500);
            setTimeout(() => { runTest2(); }, 2000);
            setTimeout(() => { runTest3(); }, 4000);
            setTimeout(() => {
                log('=== ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
                showResult('ğŸ‰ í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'ëª¨ë“  ë‹¨ê³„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.', 'success');
            }, 5000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', function() {
            log('âœ… í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            log('ğŸ’¡ "í…ŒìŠ¤íŠ¸ 4: ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤" ë²„íŠ¼ì„ ëˆŒëŸ¬ ìë™ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.');
            log('ğŸ’¡ ë˜ëŠ” ì•„ë˜ iframeì—ì„œ ì§ì ‘ ì²´í¬ë°•ìŠ¤ë¥¼ í´ë¦­í•œ í›„ "í…ŒìŠ¤íŠ¸ 3"ì„ ëˆŒëŸ¬ ê°’ì„ í™•ì¸í•˜ì„¸ìš”.');
        });
    </script>
</body>
</html>
