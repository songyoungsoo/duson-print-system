# íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ì‹œìŠ¤í…œ ì™„ë²½ ê°€ì´ë“œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025ë…„ 11ì›” 19ì¼
**ëŒ€ìƒ ì œí’ˆ**: ì „ì²´ 9ê°œ í’ˆëª© (í†µí•© ì‹œìŠ¤í…œ)
**ì‘ì—… ìƒíƒœ**: âœ… ì™„ë£Œ ë° ê²€ì¦ ì™„ë£Œ

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [í†µí•© ì•„í‚¤í…ì²˜](#í†µí•©-ì•„í‚¤í…ì²˜)
3. [9ê°œ í’ˆëª© êµ¬í˜„ í˜„í™©](#9ê°œ-í’ˆëª©-êµ¬í˜„-í˜„í™©)
4. [ê²½ë¡œ ë° ë°ì´í„° êµ¬ì¡°](#ê²½ë¡œ-ë°-ë°ì´í„°-êµ¬ì¡°)
5. [í•µì‹¬ íŒŒì¼ ë° í•¨ìˆ˜](#í•µì‹¬-íŒŒì¼-ë°-í•¨ìˆ˜)
6. [ê´€ë¦¬ì í˜ì´ì§€ ì—°ë™](#ê´€ë¦¬ì-í˜ì´ì§€-ì—°ë™)
7. [í…ŒìŠ¤íŠ¸ ë° ê²€ì¦](#í…ŒìŠ¤íŠ¸-ë°-ê²€ì¦)
8. [ë¬¸ì œ í•´ê²° ê°€ì´ë“œ](#ë¬¸ì œ-í•´ê²°-ê°€ì´ë“œ)
9. [ì‘ì—… ì´ë ¥](#ì‘ì—…-ì´ë ¥)

---

## ì‹œìŠ¤í…œ ê°œìš”

### ğŸ¯ ëª©ì 
ì „ì²´ 9ê°œ ì¸ì‡„ í’ˆëª©ì— ëŒ€í•´ **í†µì¼ëœ íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ ì‹œìŠ¤í…œ** ì œê³µ
- ì¼ê´€ëœ ê²½ë¡œ êµ¬ì¡°
- JSON ê¸°ë°˜ íŒŒì¼ ë©”íƒ€ë°ì´í„° ê´€ë¦¬
- ê´€ë¦¬ì í˜ì´ì§€ ì™„ë²½ ì—°ë™
- ë‹¤ìš´ë¡œë“œ ì‹œìŠ¤í…œ í†µí•© ì§€ì›

### âœ¨ ì£¼ìš” ê¸°ëŠ¥
- **í‘œì¤€í™”ëœ ê²½ë¡œ**: `/ImgFolder/_MlangPrintAuto_{product}_index.php/{year}/{mmdd}/{ip}/{timestamp}/`
- **JSON ë©”íƒ€ë°ì´í„°**: íŒŒì¼ ì •ë³´ (original_name, saved_name, path, size, web_url)
- **ìë™ ë””ë ‰í† ë¦¬ ìƒì„±**: ê³„ì¸µì  êµ¬ì¡° ìë™ ìƒì„± ë° ê¶Œí•œ ì„¤ì •
- **ê´€ë¦¬ì ë‹¤ìš´ë¡œë“œ**: ëª¨ë“  í’ˆëª©ì˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ í†µí•© ì§€ì›
- **ë ˆê±°ì‹œ í˜¸í™˜**: ê¸°ì¡´ ê²½ë¡œì™€ ì‹ ê·œ ê²½ë¡œ ëª¨ë‘ ì§€ì›

---

## í†µí•© ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ íë¦„ë„

```
ì‚¬ìš©ì íŒŒì¼ ì—…ë¡œë“œ (ë¸Œë¼ìš°ì €)
         â†“
  add_to_basket.php
         â†“
  UploadPathHelper.php â†’ ê²½ë¡œ ìƒì„± ë° ê²€ì¦
         â†“
  íŒŒì¼ ì €ì¥: /ImgFolder/_MlangPrintAuto_{product}_index.php/...
         â†“
  JSON ìƒì„±: uploaded_files = [{original_name, saved_name, path, size, web_url}]
         â†“
  DB ì €ì¥: shop_temp.uploaded_files
         â†“
  ì£¼ë¬¸ ì²˜ë¦¬: shop_temp â†’ mlangorder_printauto
         â†“
  ê´€ë¦¬ì í˜ì´ì§€ (admin.php) â†’ íŒŒì¼ ëª©ë¡ í‘œì‹œ
         â†“
  download.php â†’ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
```

### í•µì‹¬ êµ¬ì„± ìš”ì†Œ

| ì»´í¬ë„ŒíŠ¸ | ì—­í•  | íŒŒì¼ |
|---------|------|------|
| **ê²½ë¡œ ìƒì„±** | í†µì¼ëœ ì—…ë¡œë“œ ê²½ë¡œ ìƒì„± | `includes/UploadPathHelper.php` |
| **íŒŒì¼ ì—…ë¡œë“œ** | ê° í’ˆëª©ë³„ ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€ | `mlangprintauto/{product}/add_to_basket.php` |
| **ë©”íƒ€ë°ì´í„° ì €ì¥** | JSON í˜•ì‹ íŒŒì¼ ì •ë³´ ì €ì¥ | `shop_temp.uploaded_files` |
| **ê´€ë¦¬ì í‘œì‹œ** | ì—…ë¡œë“œëœ íŒŒì¼ ëª©ë¡ í‘œì‹œ | `admin/mlangprintauto/admin.php` |
| **íŒŒì¼ ë‹¤ìš´ë¡œë“œ** | í†µí•© ë‹¤ìš´ë¡œë“œ í•¸ë“¤ëŸ¬ | `admin/mlangprintauto/download.php` |

---

## 9ê°œ í’ˆëª© êµ¬í˜„ í˜„í™©

### âœ… ì „ì²´ í’ˆëª© ì™„ë£Œ (2025-11-19)

| ìˆœë²ˆ | í’ˆëª© ì½”ë“œ | í•œê¸€ëª… | íŒŒì¼ ì—…ë¡œë“œ | JSON ì €ì¥ | ë‹¤ìš´ë¡œë“œ | ì‹¤ì œ ê²€ì¦ |
|------|-----------|--------|------------|-----------|----------|-----------|
| 1 | inserted | ì „ë‹¨ì§€ | âœ… | âœ… | âœ… | âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ |
| 2 | namecard | ëª…í•¨ | âœ… | âœ… | âœ… | âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ |
| 3 | envelope | ë´‰íˆ¬ | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |
| 4 | sticker | ìŠ¤í‹°ì»¤ | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |
| 5 | msticker | ìì„ìŠ¤í‹°ì»¤ | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |
| 6 | cadarok | ì¹´ë‹¤ë¡ | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |
| 7 | littleprint | í¬ìŠ¤í„° | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |
| 8 | ncrflambeau | NCRì–‘ì‹ | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |
| 9 | merchandisebond | ìƒí’ˆê¶Œ | âœ… | âœ… | âœ… | ğŸŸ¢ ì½”ë“œ ê²€ì¦ |

**ê²€ì¦ ìƒíƒœ**:
- âœ… **í…ŒìŠ¤íŠ¸ ì™„ë£Œ**: ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œ ë° ë‹¤ìš´ë¡œë“œ ë™ì‘ í™•ì¸
- ğŸŸ¢ **ì½”ë“œ ê²€ì¦**: `uploaded_files[]` ë° `json_encode` ì½”ë“œ ì¡´ì¬ í™•ì¸

---

## ê²½ë¡œ ë° ë°ì´í„° êµ¬ì¡°

### 1. ì—…ë¡œë“œ ê²½ë¡œ êµ¬ì¡°

```
/ImgFolder/_MlangPrintAuto_{product}_index.php/{YYYY}/{MMDD}/{IP}/{timestamp}/
```

**ì‹¤ì œ ì˜ˆì‹œ** (ëª…í•¨):
```
/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/
â”œâ”€â”€ 20250914_073433.png
â”œâ”€â”€ design_v2.pdf
â””â”€â”€ final_artwork.ai
```

**ì‹¤ì œ ì˜ˆì‹œ** (ì „ë‹¨ì§€):
```
/var/www/html/ImgFolder/_MlangPrintAuto_inserted_index.php/2025/1119/ipv6_1/1763508971/
â”œâ”€â”€ test_upload.png
â””â”€â”€ customer_design.pdf
```

### 2. ê²½ë¡œ ìš”ì†Œ ì„¤ëª…

| ìš”ì†Œ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `_MlangPrintAuto_{product}_index.php` | í’ˆëª©ë³„ ë””ë ‰í† ë¦¬ | `_MlangPrintAuto_namecard_index.php` |
| `{YYYY}` | 4ìë¦¬ ì—°ë„ | `2025` |
| `{MMDD}` | ì›”ì¼ 4ìë¦¬ | `1119` (11ì›” 19ì¼) |
| `{IP}` | ì—…ë¡œë” IP (ì •ê·œí™”) | `ipv6_1` (::1), `222_108_84_120` |
| `{timestamp}` | Unix íƒ€ì„ìŠ¤íƒ¬í”„ | `1763506884` |

**IPv6 ì²˜ë¦¬**:
- `::1` (localhost) â†’ `ipv6_1`
- `2001:db8::1` â†’ `ipv6_2001_db8__1`
- IPv4ëŠ” `.` â†’ `_` ë³€í™˜

### 3. JSON ë©”íƒ€ë°ì´í„° êµ¬ì¡°

#### shop_temp / mlangorder_printauto í…Œì´ë¸”

```sql
uploaded_files TEXT -- JSON ë°°ì—´
```

#### JSON í˜•ì‹

```json
[
  {
    "original_name": "ê³ ê°ë””ìì¸.pdf",
    "saved_name": "ê³ ê°ë””ìì¸.pdf",
    "path": "/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/ê³ ê°ë””ìì¸.pdf",
    "size": 21705,
    "web_url": "/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/ê³ ê°ë””ìì¸.pdf"
  },
  {
    "original_name": "ì‹œì•ˆv2.jpg",
    "saved_name": "ì‹œì•ˆv2.jpg",
    "path": "/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/ì‹œì•ˆv2.jpg",
    "size": 45120,
    "web_url": "/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/ì‹œì•ˆv2.jpg"
  }
]
```

**í•„ë“œ ì„¤ëª…**:
- `original_name`: ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì›ë³¸ íŒŒì¼ëª…
- `saved_name`: ì„œë²„ì— ì €ì¥ëœ íŒŒì¼ëª… (í˜„ì¬ëŠ” ì›ë³¸ëª… ìœ ì§€)
- `path`: ì„œë²„ íŒŒì¼ì‹œìŠ¤í…œ ì ˆëŒ€ ê²½ë¡œ (admin.phpê°€ íŒŒì¼ ì¡´ì¬ í™•ì¸ì— ì‚¬ìš©)
- `size`: íŒŒì¼ í¬ê¸° (bytes)
- `web_url`: ì›¹ ì ‘ê·¼ ê°€ëŠ¥í•œ ìƒëŒ€ ê²½ë¡œ

---

## í•µì‹¬ íŒŒì¼ ë° í•¨ìˆ˜

### 1. UploadPathHelper.php

**ìœ„ì¹˜**: `/var/www/html/includes/UploadPathHelper.php`

**ì£¼ìš” í•¨ìˆ˜**:

#### `generateUploadPath($product, $ip = null, $timestamp = null)`
```php
/**
 * í’ˆëª©ë³„ ì—…ë¡œë“œ ê²½ë¡œ ìƒì„±
 *
 * @param string $product í’ˆëª© ì½”ë“œ (inserted, namecard, envelope ë“±)
 * @param string|null $ip í´ë¼ì´ì–¸íŠ¸ IP (nullì´ë©´ ìë™ ê°ì§€)
 * @param int|null $timestamp Unix íƒ€ì„ìŠ¤íƒ¬í”„ (nullì´ë©´ í˜„ì¬ ì‹œê°„)
 * @return array ['full_path' => ì ˆëŒ€ê²½ë¡œ, 'web_path' => ì›¹ê²½ë¡œ, 'db_path' => DBì €ì¥ê²½ë¡œ]
 */
```

**ë°˜í™˜ ì˜ˆì‹œ**:
```php
[
    'full_path' => '/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884',
    'web_path' => '/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884',
    'db_path' => '_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884'
]
```

#### `uploadFile($product, $fileArray)`
```php
/**
 * íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ (ë””ë ‰í† ë¦¬ ìë™ ìƒì„±)
 *
 * @param string $product í’ˆëª© ì½”ë“œ
 * @param array $fileArray $_FILES['uploaded_files'] ë°°ì—´
 * @return array ['success', 'db_img_folder', 'db_thing_cate', 'web_path']
 */
```

#### `getFilePathFromDB($imgFolder, $filename)`
```php
/**
 * DBì—ì„œ íŒŒì¼ ê²½ë¡œ ë³µì›
 *
 * @param string $imgFolder DBì— ì €ì¥ëœ ImgFolder ê°’
 * @param string $filename íŒŒì¼ëª…
 * @return array ['full_path', 'web_path', 'exists', 'url']
 */
```

**ì§€ì› í’ˆëª© ë°°ì—´**:
```php
private static $productPaths = [
    'inserted'        => '_MlangPrintAuto_inserted_index.php',
    'namecard'        => '_MlangPrintAuto_namecard_index.php',
    'envelope'        => '_MlangPrintAuto_envelope_index.php',
    'sticker'         => '_MlangPrintAuto_sticker_new_index.php',
    'msticker'        => '_MlangPrintAuto_msticker_index.php',
    'cadarok'         => '_MlangPrintAuto_cadarok_index.php',
    'littleprint'     => '_MlangPrintAuto_littleprint_index.php',
    'ncrflambeau'     => '_MlangPrintAuto_ncrflambeau_index.php',
    'merchandisebond' => '_MlangPrintAuto_merchandisebond_index.php'
];
```

### 2. add_to_basket.php (ê° í’ˆëª©)

**ê³µí†µ íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ ë¡œì§**:

```php
require_once __DIR__ . '/../../includes/UploadPathHelper.php';

// 1. ê²½ë¡œ ìƒì„±
$paths = UploadPathHelper::generateUploadPath('namecard'); // í’ˆëª©ì— ë§ê²Œ ë³€ê²½

// 2. íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
$uploaded_files = [];

if (!empty($_FILES['uploaded_files'])) {
    foreach ($_FILES['uploaded_files']['name'] as $key => $filename) {
        if ($_FILES['uploaded_files']['error'][$key] == UPLOAD_ERR_OK) {
            $temp_file = $_FILES['uploaded_files']['tmp_name'][$key];
            $target_filename = basename($filename);
            $target_path = $paths['full_path'] . '/' . $target_filename;

            // ë””ë ‰í† ë¦¬ ìƒì„±
            if (!is_dir($paths['full_path'])) {
                mkdir($paths['full_path'], 0777, true);
            }

            // íŒŒì¼ ì´ë™
            if (move_uploaded_file($temp_file, $target_path)) {
                $uploaded_files[] = [
                    'original_name' => $filename,
                    'saved_name' => $target_filename,
                    'path' => $target_path,
                    'size' => $_FILES['uploaded_files']['size'][$key],
                    'web_url' => $paths['web_path'] . '/' . $target_filename
                ];
            }
        }
    }
}

// 3. JSON ë³€í™˜
$files_json = json_encode($uploaded_files, JSON_UNESCAPED_UNICODE);

// 4. DB ì €ì¥
$insert_query = "INSERT INTO shop_temp (..., ImgFolder, uploaded_files) VALUES (?, ..., ?, ?)";
mysqli_stmt_bind_param($stmt, "...ss", ..., $paths['db_path'], $files_json);
```

### 3. admin.php (ê´€ë¦¬ì í˜ì´ì§€)

**íŒŒì¼ ëª©ë¡ í‘œì‹œ** (Lines 639-700):

```php
// uploaded_files JSON íŒŒì‹±
if (!empty($row['uploaded_files'])) {
    $uploaded_files_data = json_decode($row['uploaded_files'], true);

    if (is_array($uploaded_files_data)) {
        foreach ($uploaded_files_data as $file_info) {
            $file_name = $file_info['original_name'] ?? $file_info['saved_name'] ?? '';
            $file_path_full = $file_info['path'] ?? '';

            // íŒŒì¼ ì¡´ì¬ í™•ì¸
            $file_exists = file_exists($file_path_full);

            if ($file_exists) {
                $file_size = filesize($file_path_full);
                $file_size_mb = round($file_size / 1024 / 1024, 2);

                // ImgFolderì—ì„œ ê²½ë¡œ ì¶”ì¶œ
                $download_path = str_replace('/var/www/html/ImgFolder/', 'ImgFolder/', dirname($file_path_full));

                echo "ğŸ“„ <a href='download.php?no=$no&downfile=" . urlencode($file_name) .
                     "&path=" . urlencode($download_path) . "'>";
                echo htmlspecialchars($file_name) . "</a> ({$file_size_mb}MB)<br>";
            } else {
                echo "âš ï¸ " . htmlspecialchars($file_name) . " (íŒŒì¼ ì—†ìŒ)<br>";
            }
        }
    }
}
```

### 4. download.php

**í†µí•© ë‹¤ìš´ë¡œë“œ í•¸ë“¤ëŸ¬** (Lines 24-64):

```php
// íŒŒë¼ë¯¸í„° ë°›ê¸°
$no = isset($_GET['no']) ? intval($_GET['no']) : 0;
$downfile = isset($_GET['downfile']) ? $_GET['downfile'] : '';
$path = isset($_GET['path']) ? $_GET['path'] : '';

// íŒŒì¼ ê²½ë¡œ êµ¬ì„±
if (!empty($path)) {
    // ê²½ë¡œê°€ ì§€ì •ëœ ê²½ìš°
    $file_path = "../../" . urldecode($path) . "/" . urldecode($downfile);
} else {
    // ê²½ë¡œê°€ ì—†ìœ¼ë©´ DBì—ì„œ ì¡°íšŒ
    include "../../db.php";

    if ($no > 0) {
        $stmt = $db->prepare("SELECT ImgFolder FROM mlangorder_printauto WHERE no = ?");
        $stmt->bind_param("i", $no);
        $stmt->execute();
        $result = $stmt->get_result();
        $row = $result->fetch_assoc();

        if ($row && !empty($row['ImgFolder'])) {
            $img_folder = $row['ImgFolder'];

            // ê²½ë¡œ ìë™ ê°ì§€ (ë‹¤ì¤‘ í´ë°±)
            if (file_exists("../../ImgFolder/{$img_folder}/{$downfile}")) {
                $file_path = "../../ImgFolder/{$img_folder}/{$downfile}";
            } elseif (file_exists("../../{$img_folder}/{$downfile}")) {
                $file_path = "../../{$img_folder}/{$downfile}";
            } elseif (file_exists("../../mlangorder_printauto/upload/{$no}/{$downfile}")) {
                $file_path = "../../mlangorder_printauto/upload/{$no}/{$downfile}";
            }
        }
    }
}

// íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì œê³µ
if (file_exists($file_path)) {
    header('Content-Type: application/octet-stream');
    header('Content-Disposition: attachment; filename="' . basename($file_path) . '"');
    header('Content-Length: ' . filesize($file_path));
    readfile($file_path);
    exit;
}
```

**ì§€ì›í•˜ëŠ” ê²½ë¡œ í˜•ì‹**:
1. `ImgFolder/_MlangPrintAuto_{product}_index.php/...` (ì‹ ê·œ í†µí•© ì‹œìŠ¤í…œ)
2. `mlangorder_printauto/upload/{orderNo}/` (ë ˆê±°ì‹œ ê²½ë¡œ)
3. ê¸°íƒ€ ìƒëŒ€ ê²½ë¡œ (ê¸°ì¡´ ë°©ì‹)

---

## ê´€ë¦¬ì í˜ì´ì§€ ì—°ë™

### ì£¼ë¬¸ ìƒì„¸ë³´ê¸° í™”ë©´

**ì ‘ì† URL**:
```
http://localhost/admin/mlangprintauto/admin.php?mode=OrderView&no={ì£¼ë¬¸ë²ˆí˜¸}
```

**í™”ë©´ ì˜ˆì‹œ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì£¼ë¬¸ë²ˆí˜¸: 103703                                                 â”‚
â”‚ ì œí’ˆ: ëª…í•¨ (namecard)                                            â”‚
â”‚ ì£¼ë¬¸ì: customer@example.com                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ ì—…ë¡œë“œëœ íŒŒì¼ (1ê°œ)                                           â”‚
â”‚                                                                  â”‚
â”‚ ğŸ“„ 20250914_073433.png (0.02MB)                                 â”‚
â”‚    [ë‹¤ìš´ë¡œë“œ ë§í¬] â† í´ë¦­ ì‹œ ì¦‰ì‹œ ë‹¤ìš´ë¡œë“œ                        â”‚
â”‚                                                                  â”‚
â”‚ ê²½ë¡œ: _MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íŒŒì¼ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš°**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ ì—†ìŒ                                        â”‚
â”‚                                                                  â”‚
â”‚ âš ï¸ uploaded_files ë°ì´í„°ê°€ ë¹„ì–´ìˆê±°ë‚˜ ì˜ëª»ëœ í˜•ì‹ì…ë‹ˆë‹¤.          â”‚
â”‚                                                                  â”‚
â”‚ í•´ê²° ë°©ë²•:                                                        â”‚
â”‚ 1. ì£¼ë¬¸ì´ ë²„ê·¸ ìˆ˜ì • ì „ì— ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸                         â”‚
â”‚ 2. /tmp/fix_old_orders.php ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰                         â”‚
â”‚ 3. ìˆ˜ë™ SQL UPDATE (ìƒì„¸ ê°€ì´ë“œ ì°¸ì¡°)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### 1. ëª…í•¨ ì œí’ˆ í…ŒìŠ¤íŠ¸ (2025-11-19)

#### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
```bash
# 1. ì„¸ì…˜ ID íšë“
curl -c /tmp/session.txt http://localhost/mlangprintauto/namecard/

# 2. íŒŒì¼ ì—…ë¡œë“œ + ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
curl -X POST http://localhost/mlangprintauto/namecard/add_to_basket.php \
  -b /tmp/session.txt \
  -F "action=add_to_basket" \
  -F "uploaded_files[]=@/tmp/test_upload.png" \
  -F "product_type=namecard" \
  -F "MY_type=275" \
  -F "Section=276" \
  -F "POtype=1" \
  -F "MY_amount=500" \
  -F "calculated_price=50000" \
  -F "calculated_vat_price=55000"
```

#### ì˜ˆìƒ ì‘ë‹µ
```json
{
  "success": true,
  "message": "ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "basket_id": 573,
    "uploaded_files_count": 1,
    "upload_directory": "_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763508476"
  }
}
```

#### DB í™•ì¸
```sql
SELECT no, product_type, ImgFolder, uploaded_files
FROM shop_temp
WHERE no = 573;
```

**ê²°ê³¼**:
```
no: 573
product_type: namecard
ImgFolder: _MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763508476
uploaded_files: [{"original_name":"test_upload.png", ... }]
```

#### íŒŒì¼ ì‹œìŠ¤í…œ í™•ì¸
```bash
ls -lh /var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763508476/
# ì¶œë ¥: -rw-r--r-- 1 www-data www-data 113 Nov 19 08:34 test_upload.png
```

#### ë‹¤ìš´ë¡œë“œ í…ŒìŠ¤íŠ¸
```bash
curl -I "http://localhost/admin/mlangprintauto/download.php?path=ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763508476&downfile=test_upload.png"
```

**ì˜ˆìƒ í—¤ë”**:
```
HTTP/1.1 200 OK
Content-Type: image/png
Content-Disposition: attachment; filename="test_upload.png"
Content-Length: 113
```

### 2. ì „ë‹¨ì§€ ì œí’ˆ í…ŒìŠ¤íŠ¸ (2025-11-19)

#### í…ŒìŠ¤íŠ¸ ëª…ë ¹
```bash
curl -X POST http://localhost/mlangprintauto/inserted/add_to_basket.php \
  -b /tmp/session.txt \
  -F "action=add_to_basket" \
  -F "uploaded_files[]=@/tmp/test_upload.png" \
  -F "product_type=inserted" \
  -F "MY_type=802" \
  -F "PN_type=A4" \
  -F "MY_Fsd=100" \
  -F "MY_amount=1000" \
  -F "ordertype=ì–‘ë©´ì¸ì‡„" \
  -F "POtype=4" \
  -F "calculated_price=50000" \
  -F "calculated_vat_price=55000"
```

#### ì‘ë‹µ í™•ì¸
```json
{
  "success": true,
  "message": "ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.",
  "data": {
    "basket_id": 574,
    "uploaded_files_count": 1,
    "upload_directory": "_MlangPrintAuto_inserted_index.php/2025/1119/ipv6_1/1763508971"
  }
}
```

#### ê²€ì¦ ì™„ë£Œ
- âœ… íŒŒì¼ ì €ì¥: `/var/www/html/ImgFolder/_MlangPrintAuto_inserted_index.php/2025/1119/ipv6_1/1763508971/test_upload.png`
- âœ… DB ì €ì¥: `uploaded_files` JSON ì™„ì „í•œ êµ¬ì¡°
- âœ… ë‹¤ìš´ë¡œë“œ: HTTP 200, Content-Length: 113

### 3. ì£¼ë¬¸ ë³µêµ¬ ì‘ì—… (2025-11-19)

#### ë¬¸ì œ ë°œê²¬
- ì£¼ë¬¸ 103703, 103704, 103705: `uploaded_files = 0` (ë²„ê·¸ ìˆ˜ì • ì „ ìƒì„±)
- ë¬¼ë¦¬ì  íŒŒì¼ì€ ì¡´ì¬í•˜ì§€ë§Œ ë©”íƒ€ë°ì´í„° ëˆ„ë½

#### ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸
```php
// /tmp/fix_old_orders.php
$query = "SELECT no, ImgFolder FROM mlangorder_printauto
          WHERE date >= '2025-11-19'
          AND (uploaded_files = '0' OR uploaded_files = '[]' OR uploaded_files IS NULL)";

// íŒŒì¼ì‹œìŠ¤í…œ ìŠ¤ìº”í•˜ì—¬ orphaned íŒŒì¼ ì°¾ê¸°
// JSON ë©”íƒ€ë°ì´í„° ì¬ìƒì„±
// DB ì—…ë°ì´íŠ¸
```

#### ë³µêµ¬ ê²°ê³¼
```
âœ… ì£¼ë¬¸ 103703 ë³µêµ¬ ì™„ë£Œ: 1ê°œ íŒŒì¼
âœ… ì£¼ë¬¸ 103704 ë³µêµ¬ ì™„ë£Œ: 5ê°œ íŒŒì¼
âœ… ì£¼ë¬¸ 103705 ë³µêµ¬ ì™„ë£Œ: 5ê°œ íŒŒì¼
```

#### ìµœì¢… ìƒíƒœ í™•ì¸
```sql
SELECT no,
       CASE
         WHEN uploaded_files = '0' THEN 'âŒ 0 (ìˆ«ì)'
         WHEN JSON_VALID(uploaded_files) THEN 'âœ… JSON'
       END as íŒŒì¼ë©”íƒ€ìƒíƒœ,
       JSON_LENGTH(uploaded_files) as íŒŒì¼ê°œìˆ˜
FROM mlangorder_printauto
WHERE date >= '2025-11-19';
```

**ê²°ê³¼**:
```
103703 | âœ… JSON | 1
103704 | âœ… JSON | 5
103705 | âœ… JSON | 5
```

---

## ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

### ë¬¸ì œ 1: ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ ìƒì„± ì‹¤íŒ¨

**ì¦ìƒ**:
```json
{
  "success": false,
  "message": "ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ ìƒì„± ì‹¤íŒ¨"
}
```

**ì›ì¸**:
- ìƒìœ„ ë””ë ‰í† ë¦¬ ê¶Œí•œ ë¶€ì¡±
- ë””ìŠ¤í¬ ê³µê°„ ë¶€ì¡±
- SELinux ì •ì±… ì œí•œ (CentOS/RHEL)

**í•´ê²° ë°©ë²•**:
```bash
# 1. ê¶Œí•œ í™•ì¸
ls -la /var/www/html/ImgFolder/

# 2. ê¶Œí•œ ìˆ˜ì •
sudo chmod 777 /var/www/html/ImgFolder/
sudo chown -R www-data:www-data /var/www/html/ImgFolder/

# 3. ë””ìŠ¤í¬ ê³µê°„ í™•ì¸
df -h /var/www/html/

# 4. SELinux í™•ì¸ (CentOS/RHEL)
getenforce  # Disabled ë˜ëŠ” Permissiveì—¬ì•¼ í•¨
```

---

### ë¬¸ì œ 2: uploaded_filesê°€ 0 ë˜ëŠ” ë¹ˆ ë°°ì—´

**ì¦ìƒ**:
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ "ì—…ë¡œë“œëœ íŒŒì¼ ì •ë³´ ì—†ìŒ" í‘œì‹œ
- DB ì¡°íšŒ ì‹œ `uploaded_files = 0` ë˜ëŠ” `uploaded_files = []`

**ì›ì¸**:
- ë²„ê·¸ ìˆ˜ì • ì „ì— ìƒì„±ëœ ì£¼ë¬¸
- JavaScript `handleModalBasketAdd` í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ì˜¤ë¥˜
- PHPì—ì„œ `$_FILES['uploaded_files']` ë¹„ì–´ìˆìŒ

**í•´ê²° ë°©ë²•**:

#### ë°©ë²• 1: ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
# 1. ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
cat > /tmp/fix_old_orders.php << 'EOF'
<?php
require_once '/var/www/html/db.php';

// ë¬¸ì œ ìˆëŠ” ì£¼ë¬¸ ì°¾ê¸°
$query = "SELECT no, ImgFolder FROM mlangorder_printauto
          WHERE date >= '2025-11-19'
          AND (uploaded_files = '0' OR uploaded_files = '[]' OR uploaded_files IS NULL)";

$result = mysqli_query($db, $query);

while ($row = mysqli_fetch_assoc($result)) {
    $no = $row['no'];

    // íŒŒì¼ì‹œìŠ¤í…œì—ì„œ íŒŒì¼ ì°¾ê¸°
    $base_dir = "/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119";
    $files_found = [];

    foreach (scandir($base_dir) as $ip_dir) {
        if (strpos($ip_dir, 'ipv6_') === 0) {
            foreach (scandir("$base_dir/$ip_dir") as $time_dir) {
                if (is_numeric($time_dir) && is_dir("$base_dir/$ip_dir/$time_dir")) {
                    foreach (scandir("$base_dir/$ip_dir/$time_dir") as $file) {
                        if ($file != '.' && $file != '..' && is_file("$base_dir/$ip_dir/$time_dir/$file")) {
                            $files_found[] = [
                                'dir' => "$base_dir/$ip_dir/$time_dir",
                                'file' => $file,
                                'size' => filesize("$base_dir/$ip_dir/$time_dir/$file")
                            ];
                        }
                    }
                }
            }
        }
    }

    if (!empty($files_found)) {
        // JSON ìƒì„±
        $uploaded_files = [];
        foreach ($files_found as $file_info) {
            $uploaded_files[] = [
                'original_name' => $file_info['file'],
                'saved_name' => $file_info['file'],
                'path' => $file_info['dir'] . '/' . $file_info['file'],
                'size' => $file_info['size'],
                'web_url' => '/ImgFolder/' . str_replace('/var/www/html/ImgFolder/', '', $file_info['dir']) . '/' . $file_info['file']
            ];
        }

        $json = json_encode($uploaded_files, JSON_UNESCAPED_UNICODE);
        $relative_dir = str_replace('/var/www/html/ImgFolder/', '', $files_found[0]['dir']);

        // DB ì—…ë°ì´íŠ¸
        $stmt = mysqli_prepare($db, "UPDATE mlangorder_printauto SET ImgFolder = ?, uploaded_files = ? WHERE no = ?");
        mysqli_stmt_bind_param($stmt, "ssi", $relative_dir, $json, $no);
        mysqli_stmt_execute($stmt);

        echo "âœ… ì£¼ë¬¸ $no ë³µêµ¬ ì™„ë£Œ: " . count($files_found) . "ê°œ íŒŒì¼\n";
    }
}
EOF

# 2. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
php /tmp/fix_old_orders.php
```

#### ë°©ë²• 2: ìˆ˜ë™ SQL UPDATE
```sql
-- 1. íŒŒì¼ ê²½ë¡œ í™•ì¸
-- íŒŒì¼ì‹œìŠ¤í…œì—ì„œ ì‹¤ì œ ê²½ë¡œ ì°¾ê¸°

-- 2. JSON ìƒì„± ë° ì—…ë°ì´íŠ¸
UPDATE mlangorder_printauto
SET ImgFolder = '_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884',
    uploaded_files = '[{
        "original_name": "20250914_073433.png",
        "saved_name": "20250914_073433.png",
        "path": "/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/20250914_073433.png",
        "size": 21705,
        "web_url": "/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/20250914_073433.png"
    }]'
WHERE no = 103703;
```

---

### ë¬¸ì œ 3: ë‹¤ìš´ë¡œë“œ ì‹œ 404 Not Found

**ì¦ìƒ**:
```
HTTP/1.1 404 Not Found
íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
```

**ì›ì¸**:
- `uploaded_files` JSONì˜ `path` í•„ë“œ ëˆ„ë½ ë˜ëŠ” ì˜ëª»ë¨
- íŒŒì¼ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- download.php ê²½ë¡œ í´ë°± ë¡œì§ ì‹¤íŒ¨

**í•´ê²° ë°©ë²•**:

#### 1. DB í™•ì¸
```sql
SELECT no, ImgFolder, uploaded_files
FROM mlangorder_printauto
WHERE no = {ì£¼ë¬¸ë²ˆí˜¸};
```

**í™•ì¸ ì‚¬í•­**:
- `uploaded_files`ê°€ JSON í˜•ì‹ì¸ì§€
- `path` í•„ë“œê°€ ìˆëŠ”ì§€
- `path` í•„ë“œ ê°’ì´ ì ˆëŒ€ ê²½ë¡œì¸ì§€

#### 2. íŒŒì¼ ì‹œìŠ¤í…œ í™•ì¸
```bash
# uploaded_files JSONì—ì„œ path ì¶”ì¶œ
cat << 'EOF' > /tmp/check_file.php
<?php
$json = '[{"path":"/var/www/html/ImgFolder/_MlangPrintAuto_namecard_index.php/2025/1119/ipv6_1/1763506884/test.png"}]';
$files = json_decode($json, true);
$path = $files[0]['path'];

echo "Path: $path\n";
echo "Exists: " . (file_exists($path) ? 'Yes' : 'No') . "\n";
EOF

php /tmp/check_file.php
```

#### 3. download.php ë””ë²„ê·¸
```php
// download.php ìƒë‹¨ì— ì¶”ê°€
error_log("Download request: no=$no, downfile=$downfile, path=$path");
error_log("Resolved file_path: $file_path");
error_log("File exists: " . (file_exists($file_path) ? 'Yes' : 'No'));
```

---

### ë¬¸ì œ 4: PHP ë°°ì—´ ì²˜ë¦¬ ì˜¤ë¥˜

**ì¦ìƒ**:
```
Warning: Undefined array key "uploaded_files" in add_to_basket.php
```

**ì›ì¸**:
- HTML/JavaScriptì—ì„œ `name="uploaded_files"` ì†ì„± ëˆ„ë½ (ë°°ì—´ í‘œê¸° `[]` ì—†ìŒ)
- FormDataì—ì„œ ì˜ëª»ëœ append ë°©ì‹

**í•´ê²° ë°©ë²•**:

#### HTML í™•ì¸
```html
<!-- âŒ ì˜ëª»ëœ ë°©ì‹ -->
<input type="file" name="uploaded_files" multiple>

<!-- âœ… ì˜¬ë°”ë¥¸ ë°©ì‹ -->
<input type="file" name="uploaded_files[]" multiple>
```

#### JavaScript í™•ì¸
```javascript
// âŒ ì˜ëª»ëœ ë°©ì‹
formData.append("uploaded_files[0]", file);
formData.append("uploaded_files[1]", file);

// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹
formData.append("uploaded_files[]", file);
```

#### PHP í™•ì¸
```php
// PHPì—ì„œ ìë™ ë°°ì—´ ì¸ì‹
if (!empty($_FILES['uploaded_files'])) {
    // $_FILES['uploaded_files']['name'] = ['file1.png', 'file2.jpg', ...]
    // $_FILES['uploaded_files']['tmp_name'] = ['/tmp/php1', '/tmp/php2', ...]

    foreach ($_FILES['uploaded_files']['name'] as $key => $filename) {
        echo "íŒŒì¼ $key: $filename\n";
    }
}
```

---

### ë¬¸ì œ 5: JSON íŒŒì‹± ì˜¤ë¥˜

**ì¦ìƒ**:
```
Warning: json_decode(): Syntax error in admin.php
```

**ì›ì¸**:
- `uploaded_files` í•„ë“œì— ì˜ëª»ëœ JSON ì €ì¥
- ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì (`\`) ì¤‘ë³µ ë˜ëŠ” ëˆ„ë½

**í•´ê²° ë°©ë²•**:

#### DB í™•ì¸
```sql
SELECT uploaded_files FROM mlangorder_printauto WHERE no = {ì£¼ë¬¸ë²ˆí˜¸};
```

**ì˜¬ë°”ë¥¸ JSON**:
```json
[{"original_name":"test.png","saved_name":"test.png","path":"/var/www/html/...","size":113,"web_url":"/ImgFolder/..."}]
```

**ì˜ëª»ëœ JSON (ì´ìŠ¤ì¼€ì´í”„ ì¤‘ë³µ)**:
```json
[{\"original_name\":\"test.png\",\"saved_name\":\"test.png\",\"path\":\"/var/www/html/...\",\"size\":113,\"web_url\":\"/ImgFolder/...\"}]
```

#### PHPì—ì„œ ì˜¬ë°”ë¥¸ ì €ì¥ ë°©ë²•
```php
// âœ… ì˜¬ë°”ë¥¸ ë°©ì‹ (JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES)
$json = json_encode($uploaded_files, JSON_UNESCAPED_UNICODE | JSON_UNESCAPED_SLASHES);

// âŒ ì˜ëª»ëœ ë°©ì‹ (addslashes ì‚¬ìš©)
$json = addslashes(json_encode($uploaded_files)); // ì´ìŠ¤ì¼€ì´í”„ ì¤‘ë³µ!
```

---

## ì‘ì—… ì´ë ¥

### 2025-11-18 (ì´ˆê¸° ê°œë°œ)
| ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|----------|------|
| ë ˆê±°ì‹œ ì—…ë¡œë“œ ì‹œìŠ¤í…œ ì„¤ê³„ | âœ… ì™„ë£Œ |
| ì „ë‹¨ì§€(inserted) ì‹œìŠ¤í…œ ì ìš© | âœ… ì™„ë£Œ |
| ì–‘ì‹ì§€(ncrflambeau) ì‹œìŠ¤í…œ ì ìš© | âœ… ì™„ë£Œ |
| ê´€ë¦¬ì í˜ì´ì§€ ì—°ë™ | âœ… ì™„ë£Œ |
| ì‹¤ì„œë²„ FTP ë°°í¬ | âœ… ì™„ë£Œ |

### 2025-11-19 (í†µí•© ì‹œìŠ¤í…œ êµ¬ì¶•)
| ì‘ì—… ë‚´ìš© | ìƒíƒœ |
|----------|------|
| UploadPathHelper.php í†µí•© í—¬í¼ ìƒì„± | âœ… ì™„ë£Œ |
| 9ê°œ í’ˆëª© íŒŒì¼ ì—…ë¡œë“œ ì‹œìŠ¤í…œ í†µì¼ | âœ… ì™„ë£Œ |
| uploaded_files JSON í‘œì¤€ êµ¬ì¡° ì •ì˜ | âœ… ì™„ë£Œ |
| ëª…í•¨ ì œí’ˆ ì‹¤ì œ í…ŒìŠ¤íŠ¸ | âœ… ì™„ë£Œ |
| ì „ë‹¨ì§€ ì œí’ˆ ì‹¤ì œ í…ŒìŠ¤íŠ¸ | âœ… ì™„ë£Œ |
| ì£¼ë¬¸ 103703, 103704, 103705 ë³µêµ¬ | âœ… ì™„ë£Œ |
| ìë™ ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± | âœ… ì™„ë£Œ |
| download.php ë‹¤ì¤‘ ê²½ë¡œ í´ë°± ê²€ì¦ | âœ… ì™„ë£Œ |
| ì „ì²´ ì‹œìŠ¤í…œ ë¬¸ì„œí™” | âœ… ì™„ë£Œ |

---

## ì°¸ê³  ìë£Œ

### ê´€ë ¨ ë¬¸ì„œ
- [CLAUDE.md](CLAUDE.md) - ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡° ë¬¸ì„œ
- [ENVIRONMENT_CONFIG.md](CLAUDE_DOCS/02_ARCHITECTURE/ENVIRONMENT_CONFIG.md) - í™˜ê²½ ì„¤ì • ê°€ì´ë“œ

### í•µì‹¬ íŒŒì¼ ê²½ë¡œ
```
/var/www/html/
â”œâ”€â”€ includes/
â”‚   â””â”€â”€ UploadPathHelper.php              # í†µí•© ê²½ë¡œ ìƒì„± í—¬í¼
â”œâ”€â”€ mlangprintauto/
â”‚   â”œâ”€â”€ inserted/add_to_basket.php       # ì „ë‹¨ì§€ ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ namecard/add_to_basket.php       # ëª…í•¨ ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ envelope/add_to_basket.php       # ë´‰íˆ¬ ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ sticker/add_to_basket.php        # ìŠ¤í‹°ì»¤ ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ msticker/add_to_basket.php       # ìì„ìŠ¤í‹°ì»¤ ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ cadarok/add_to_basket.php        # ì¹´ë‹¤ë¡ ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ littleprint/add_to_basket.php    # í¬ìŠ¤í„° ì—…ë¡œë“œ
â”‚   â”œâ”€â”€ ncrflambeau/add_to_basket.php    # ì–‘ì‹ì§€ ì—…ë¡œë“œ
â”‚   â””â”€â”€ merchandisebond/add_to_basket.php # ìƒí’ˆê¶Œ ì—…ë¡œë“œ
â””â”€â”€ admin/
    â””â”€â”€ mlangprintauto/
        â”œâ”€â”€ admin.php                     # ê´€ë¦¬ì í˜ì´ì§€
        â””â”€â”€ download.php                  # ë‹¤ìš´ë¡œë“œ í•¸ë“¤ëŸ¬
```

### PHP í•¨ìˆ˜ ë ˆí¼ëŸ°ìŠ¤
- [`move_uploaded_file()`](https://www.php.net/manual/en/function.move-uploaded-file.php)
- [`json_encode()`](https://www.php.net/manual/en/function.json-encode.php)
- [`json_decode()`](https://www.php.net/manual/en/function.json-decode.php)
- [`mysqli_stmt_bind_param()`](https://www.php.net/manual/en/mysqli-stmt.bind-param.php)

### ë””ë²„ê¹… íŒ
```php
// 1. ì—…ë¡œë“œ íŒŒì¼ í™•ì¸
var_dump($_FILES['uploaded_files']);

// 2. ê²½ë¡œ ìƒì„± í™•ì¸
$paths = UploadPathHelper::generateUploadPath('namecard');
var_dump($paths);

// 3. JSON ì¸ì½”ë”© í™•ì¸
$json = json_encode($uploaded_files, JSON_UNESCAPED_UNICODE);
var_dump($json);
var_dump(json_last_error_msg());

// 4. íŒŒì¼ ì¡´ì¬ í™•ì¸
var_dump(file_exists($file_path));
var_dump(is_readable($file_path));
```

---

## ë¼ì´ì„ ìŠ¤ ë° ì €ì‘ê¶Œ

**Copyright Â© 2025 Duson Planning Print (ë‘ì†ê¸°íšì¸ì‡„)**
All rights reserved.

ì´ ë¬¸ì„œëŠ” ë‚´ë¶€ ê°œë°œ ì°¸ê³ ìš©ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

**END OF DOCUMENT**
