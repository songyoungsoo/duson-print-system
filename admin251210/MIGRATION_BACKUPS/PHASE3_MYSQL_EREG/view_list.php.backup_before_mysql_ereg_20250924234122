<?php
declare(strict_types=1);


// ⚠️  XSS 보호 권장: echo 시 htmlspecialchars() 사용을 고려하세요
// ✅ PHP 7.4 호환: 입력 변수 초기화
$mode = $_GET['mode'] ?? $_POST['mode'] ?? '';
$no = $_GET['no'] ?? $_POST['no'] ?? '';
$search = $_GET['search'] ?? $_POST['search'] ?? '';
$id = $_GET['id'] ?? $_POST['id'] ?? '';
$name = $_GET['name'] ?? $_POST['name'] ?? '';
$code = $_GET['code'] ?? $_POST['code'] ?? '';
$page = $_GET['page'] ?? $_POST['page'] ?? '';

include"../../../db.php";
include"../../config.php";
include"view_admin.php";
$TopTableWidth="630";
?>

<html>
<head>
<title>MlangWeb관리프로그램(3.0)-MlangWebOffice: 거래내역서 인쇄</title>
<meta http-equiv="Content-type" content="text/html; charset=euc-kr">
<!--------------------------------------------------------------------------------

     프로그램명: MlangWeb관리프로그램 버젼3.0
     프로그램 제작툴-에디터플러스2
     프로그램언어: PHP, javascript, DHTML, html
     제작자: Mlang 

// 3.0 에 추가된  기능 --------------------------------------------------------------//

(1) 게시판 버그 수정
(2) PAGE 관리기능 버그 수정
(3) Photo자료실 관리기능 추가
(4) 거래실적 결과물 관리기능 추가
(5) 회원 입력폼 관리기능 추가

//-------------------------------------------------------------------------------//

* 현 사이트는 MYSQLDB(MySql데이터베이스) 화 작업되어져 있는 홈페이지 입니다.
* 홈페이지의 해킹, 사고등으로 자료가 없어질시 5분안에 복구가 가능합니다.
* 현사이트는 PHP프로그램화 되어져 있음으로 웹초보자가 자료를 수정/삭제 가능합니다.
* 페이지 수정시 의뢰자가 HTML에디터 추가를 원하면 프로그램을 지원합니다.
* 모든 페이지는 웹상에서 관리할수 있습니다.

   프로그램 에러 있을시 : ☏ 011-548-7038, 임태희 (전화안받을시 문자를주셔염*^^*)
----------------------------------------------------------------------------------->
<style>
body,td,input,select,submit {color:black; font-size:9pt; FONT-FAMILY:굴림; word-break:break-all;}
td, table{BORDER-COLOR:#4C4C4C; border-collapse:collapse; color:#000000; font-size:10pt; FONT-FAMILY:굴림; word-break:break-all;}
.Td_b{font:bold; font-size:12pt;}
.Td_2{font-size:12pt;}
.Td_Bgcolor_1{color:#FFFFFF;}
</style>

</head>

<body LEFTMARGIN='0' TOPMARGIN='0' MARGINWIDTH='0' MARGINHEIGHT='0' bgcolor='#FFFFFF'>

<table border=0 align=center width='<?=$TopTableWidth?>' cellpadding=0 cellspacing=0>
<tr><td width=100% height=20>&nbsp;</td></tr>
<tr>
<td width='100%'>

<!------------------------------ 제출처 출력 부분  시작 ------------------------------->
<p align=center>
<font style='font-size:18pt; font:bold;'>거래내역서 </font>
<font style='font-size:11pt; color:#336666'>( 등록NO: <?=$no?> )</font>
</p>

<table border=0 align=center width='100%' cellpadding=0 cellspacing=5 style='word-break:break-all;'>

<tr>
<td width=20% align=right class='Td_b'>제출처&nbsp;&nbsp;</td>
<td width=30% class='Td_2'><?echo("$Viewbiz_name");?></td>
<td width=20% align=right class='Td_b'>담당자&nbsp;&nbsp;</td>
<td width=30% class='Td_2'><?echo("$Viewa_name");?></td>
</tr>

<tr>
<td align=right class='Td_b'>현장명&nbsp;&nbsp;</td>
<td><?echo("$Viewb_name");?></td>
<td align=right class='Td_b'>본사TEL&nbsp;&nbsp;</td>
<td>
<?echo("$Viewtel_1");?> - <?echo("$Viewtel_2");?> - <?echo("$Viewtel_3");?>
</td>
</tr>

<tr>
<td align=right colspan=4>&nbsp;<?=date("Y");?>&nbsp;년&nbsp;<?=date("m");?>&nbsp;월&nbsp;<?=date("d");?>&nbsp;일&nbsp;</td>
</tr>
</table>
<!------------------------------ 제출처 출력 부분  끄읕 ------------------------------->

<!--------------------------------- SoList 출력 시작 ---------------------------------->
<table border=1 align=center width='100%' cellpadding='5' cellspacing='0' style='word-break:break-all;'>
<tr bgcolor='#757575'>
<td align=center height=25 class='Td_Bgcolor_1' width=90>거래일자</td>
<td align=center class='Td_Bgcolor_1' width=105>기종</td>
<td align=center class='Td_Bgcolor_1' width=105>장비번호</td>
<td align=center class='Td_Bgcolor_1' width=90>기사명</td>
<td align=center class='Td_Bgcolor_1' width=100>금액</td>
<td align=center class='Td_Bgcolor_1' width=140>비고</td>
</tr>

<?php 
$table="MlangWebOffice_Biz_particulars where admin_no='$no'";

if($TDsearch){ // 검색모드일경우
$Mlang_query="select * from $table and $TDsearch like '%$TDsearchValue%'";
}else{
$Mlang_query="select * from $table";
}

$query= mysqli_query($db, "$Mlang_query",$db);
$recordsu= mysql_num_rows($query);
$total = mysql_affected_rows();

$listcut= 25;  //한 페이지당 보여줄 목록 게시물수. 
if(!$offset) $offset=0; 

$result= mysqli_query($db, "$Mlang_query order by NO desc limit $offset,$listcut",$db);

$rows=mysql_num_rows($result);
if($rows){


while($row= mysqli_fetch_array($result)) 
{ 
?>

<tr>
<td align=center height=25><?=$row[biz_date]?></td>
<td align=center><?=$row[kinds]?></td>
<td align=center><?=$row[fitting_no]?></td>
<td align=center><?=$row[engineer_name]?></td>
<td align=center><?$sum = "$row[money]"; $sum = number_format($sum);  echo("$sum"); $sum = str_replace(",","",$sum);?></td>
<td align=center><?=$row[remark]?></td>
</tr>

<?php 
		$i=$i+1;
} 


}else{

if($search){
echo"<tr><td colspan=10><p align=center><BR><BR>관련 검색 자료없음</p></td></tr>";
}else if($TDsearchValue){ // 회원 간단검색 TDsearch //  TDsearchValue
echo"<tr><td colspan=10><p align=center><BR><BR>$TDsearch 로 검색되는 $TDsearchValue - 관련 검색 자료없음</p></td></tr>";
}else{
echo"<tr><td colspan=10><p align=center><BR><BR>등록 자료없음</p></td></tr>";
}

}

?>


</table>


<table border=0 align=center width='100%' cellpadding=0 cellspacing=3 style='word-break:break-all;'>
<tr>
<td align=left class='Td_2'>&nbsp;* 계산서 발행시 VAT 10% 별도</td>
<td align=right class='Td_2'>발행: <b>아하중기</b>&nbsp;</td>
</tr>
</table>

<p align='center'>

<?php 
if($rows){

if($TDsearch){
	$mlang_pagego="mode=$mode&no=$no&TDsearch=$TDsearch&TDsearchValue=$TDsearchValue$YUh_offset";
}else{
	$mlang_pagego="mode=$mode&no=$no$YUh_offset"; 
}

$pagecut= 7;  //한 장당 보여줄 페이지수 
$one_bbs= $listcut*$pagecut;  //한 장당 실을 수 있는 목록(게시물)수 
$start_offset= intval($offset/$one_bbs)*$one_bbs;  //각 장에 처음 페이지의 $offset값. 
$end_offset= intval($recordsu/$one_bbs)*$one_bbs;  //마지막 장의 첫페이지의 $offset값. 
$start_page= intval($start_offset/$listcut)+1; //각 장에 처음 페이지의 값. 
$end_page= ($recordsu%$listcut>0)? intval($recordsu/$listcut)+1: intval($recordsu/$listcut); 
//마지막 장의 끝 페이지. 
if($start_offset!= 0) 
{ 
  $apoffset= $start_offset- $one_bbs; 
  echo "<a href='$PHP_SELF?offset=$apoffset&$mlang_pagego'>...[이전]</a>&nbsp;"; 
} 

for($i= $start_page; $i< $start_page+$pagecut; $i++) 
{ 
$newoffset= ($i-1)*$listcut; 

if($offset!= $newoffset){
  echo "&nbsp;<a href='$PHP_SELF?offset=$newoffset&$mlang_pagego'>($i)</a>&nbsp;"; 
}else{echo("&nbsp;<font style='font:bold; color:green;'>($i)</font>&nbsp;"); } 

if($i==$end_page) break; 
} 

if($start_offset!= $end_offset) 
{ 
  $nextoffset= $start_offset+ $one_bbs; 
  echo "&nbsp;<a href='$PHP_SELF?offset=$nextoffset&$mlang_pagego'>[다음]...</a>"; 
} 
echo "총목록갯수: $end_page 개"; 


}

mysqli_close($db); 
?> 

</p>
<!--------------------------------- SoList 출력 끄읕 ---------------------------------->

</td></tr>
</table>

<p align=center>
웹 소프트웨어 제공: WEBSIL.net (홈페이지제작/웹프로그램개발전문기업)
</p>

</body>

</html>