# í†µí•© í‘œì‹œ ì–‘ì‹ êµ¬í˜„ ì™„ë£Œ

**ë‚ ì§œ**: 2026-01-07
**ì‘ì—…**: formatUnified() ë©”ì„œë“œ êµ¬í˜„ ë° ì „ì²´ í…ŒìŠ¤íŠ¸ í†µê³¼
**ìƒíƒœ**: âœ… ì™„ë£Œ

---

## ğŸ“Œ ì‘ì—… ìš”ì•½

ì´ì „ ì„¸ì…˜ì—ì„œ "1" ë²„ê·¸ ìˆ˜ì • í›„, ì‚¬ìš©ìê°€ ìš”ì²­í•œ "í’ˆëª©ë³„ ê³„ì‚°ì— ì“°ì´ëŠ” ëª¨ë“  ì¸ìë“¤ì„ í‘œë¡œ êµ¬ì„±í•˜ê³  ê³ ì •ëœ ì–‘ì‹í‘œì— ë§ì¶°ì„œ ì œìë¦¬ì— í‘œì‹œí•˜ëŠ” ë°©ë²•" ì œì‹œ ì‘ì—…ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ êµ¬í˜„ ë‚´ìš©

### 1. í†µí•© í¬ë§· ë©”ì„œë“œ ì¶”ê°€

**íŒŒì¼**: `includes/ProductSpecFormatter.php`

ìƒˆë¡œìš´ public ë©”ì„œë“œ ì¶”ê°€:
```php
public function formatUnified($item)
```

**ë°˜í™˜ê°’**:
```php
[
    'line1' => 'ì œí’ˆì¢…ë¥˜ / ì¬ì§ˆ/ìš©ì§€ / ê·œê²©/í¬ê¸°',
    'line2' => 'ì¸ì‡„ì˜µì…˜ / ìˆ˜ëŸ‰+ë‹¨ìœ„ / ë””ìì¸',
    'line3' => 'ì¶”ê°€ì˜µì…˜ (ì½”íŒ…, ì ‘ì§€, ì˜¤ì‹œ)',
    'line4' => 'íŠ¹ìˆ˜ì˜µì…˜ (í”„ë¦¬ë¯¸ì—„, ì–‘ë©´í…Œì´í”„)'
]
```

### 2. í—¬í¼ ë©”ì„œë“œ êµ¬í˜„

4ê°œì˜ private ë©”ì„œë“œë¡œ ê° ì¤„ êµ¬ì„±:

#### `buildLine1($item, $productType)`
- **ì—­í• **: 1ì¤„ êµ¬ì„± (ì œí’ˆì¢…ë¥˜ / ì¬ì§ˆ / ê·œê²©)
- **ë¡œì§**:
  - í‘œì¤€ í•„ë“œ ìš°ì„ : `spec_type`, `spec_material`, `spec_size`
  - ë ˆê±°ì‹œ í´ë°±: ì œí’ˆë³„ íŠ¹í™” ë¡œì§
  - ìŠ¤í‹°ì»¤: `domusong` (0 ì œê±°) / `jong` (jil ì œê±°) / `garo x sero`
  - ì¹´ë‹¤ë¡: `MY_type` / (ë¹ˆê°’) / `Section`
  - NCR: `PN_type` / `MY_Fsd` / (ë¹ˆê°’)
  - í¬ìŠ¤í„°: `MY_type` / `Section` / `PN_type`

#### `buildLine2($item, $productType)`
- **ì—­í• **: 2ì¤„ êµ¬ì„± (ì¸ì‡„ì˜µì…˜ / ìˆ˜ëŸ‰+ë‹¨ìœ„ / ë””ìì¸)
- **ë¡œì§**:
  - í‘œì¤€ í•„ë“œ ìš°ì„ : `spec_sides`, `quantity_display`, `spec_design`
  - ë ˆê±°ì‹œ í´ë°±:
    - ë´‰íˆ¬: `POtype_name` = ì¸ì‡„ ìƒ‰ìƒ (ë§ˆìŠ¤í„°1ë„, ì¹¼ë¼4ë„)
    - NCR: `MY_type_name` = ë„ìˆ˜ (4ë„)
    - ëª…í•¨/ì „ë‹¨ì§€/ìƒí’ˆê¶Œ: `POtype` = ë‹¨ë©´/ì–‘ë©´
  - `quantity_display` ì—†ìœ¼ë©´ `formatQuantity()` í˜¸ì¶œ

#### `buildLine3($item, $productType)`
- **ì—­í• **: 3ì¤„ êµ¬ì„± (ì¶”ê°€ì˜µì…˜)
- **ëŒ€ìƒ ì œí’ˆ**: inserted, leaflet, cadarok, littleprint, poster
- **ë¡œì§**: `formatAdditionalOptions()` í˜¸ì¶œ (ì½”íŒ…, ì ‘ì§€, ì˜¤ì‹œ)

#### `buildLine4($item, $productType)`
- **ì—­í• **: 4ì¤„ êµ¬ì„± (íŠ¹ìˆ˜ì˜µì…˜)
- **ëŒ€ìƒ ì œí’ˆ**:
  - í”„ë¦¬ë¯¸ì—„ ì˜µì…˜: namecard, merchandisebond, ncrflambeau
  - ì–‘ë©´í…Œì´í”„: envelope
- **ë¡œì§**: `formatPremiumOptions()` ë˜ëŠ” ì§ì ‘ ì²˜ë¦¬

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

**í…ŒìŠ¤íŠ¸ íŒŒì¼**: `test_unified_format.php`

### ì „ì²´ 11ê°œ í’ˆëª© í…ŒìŠ¤íŠ¸ í†µê³¼

| # | í’ˆëª© | í…ŒìŠ¤íŠ¸ ë‚´ìš© | ê²°ê³¼ |
|---|------|-------------|------|
| 1 | ëª…í•¨ | í‘œì¤€ í•„ë“œ (data_version=2) | âœ… PASS |
| 2 | ëª…í•¨ | ë ˆê±°ì‹œ í•„ë“œ (ì²œ ë‹¨ìœ„ ë³€í™˜) | âœ… PASS |
| 3 | ì „ë‹¨ì§€ | í‘œì¤€ í•„ë“œ + ì¶”ê°€ì˜µì…˜ | âœ… PASS |
| 4 | ë´‰íˆ¬ | í‘œì¤€ í•„ë“œ + ì–‘ë©´í…Œì´í”„ | âœ… PASS |
| 5 | ë´‰íˆ¬ | ë ˆê±°ì‹œ í•„ë“œ (ì²œ ë‹¨ìœ„ ë³€í™˜) | âœ… PASS |
| 6 | ìŠ¤í‹°ì»¤ | ë ˆê±°ì‹œ í•„ë“œ (domusong ì²˜ë¦¬) | âœ… PASS |
| 7 | ì¹´ë‹¤ë¡ | ì¤‘ì²  / A4 í˜•ì‹ | âœ… PASS |
| 8 | í¬ìŠ¤í„° | 3ìŠ¬ë¡¯ ì „ì²´ ì±„ì›€ | âœ… PASS |
| 9 | ìì„ìŠ¤í‹°ì»¤ | 2ìŠ¬ë¡¯ í˜•ì‹ | âœ… PASS |
| 10 | NCRì–‘ì‹ì§€ | í•„ë“œ ë§¤í•‘ ë°˜ëŒ€ (PN_typeâ†’spec_type) | âœ… PASS |
| 11 | ìƒí’ˆê¶Œ | í”„ë¦¬ë¯¸ì—„ ì˜µì…˜ ì—†ìŒ | âœ… PASS |

**ìµœì¢… ê²°ê³¼**: 11ê°œ í…ŒìŠ¤íŠ¸ ì¤‘ **11ê°œ ì„±ê³µ**, 0ê°œ ì‹¤íŒ¨

---

## ğŸ“„ ìƒì„±ëœ ë¬¸ì„œ

### 1. UNIFIED_DISPLAY_TEMPLATE.md
- **ê²½ë¡œ**: `CLAUDE_DOCS/DESIGN/UNIFIED_DISPLAY_TEMPLATE.md`
- **ë‚´ìš©**:
  - 11ê°œ í’ˆëª©ë³„ ì™„ì „í•œ í•„ë“œ ë§¤í•‘ í…Œì´ë¸”
  - ê³ ì • ì–‘ì‹í‘œ êµ¬ì¡° ì •ì˜
  - ë‘ ê°€ì§€ êµ¬í˜„ ë°©ë²• ì œì‹œ (í†µí•© í•¨ìˆ˜ vs ìŠ¬ë¡¯ ë§¤í•‘)
  - HTML/CSS í…œí”Œë¦¿
  - ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸
  - ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

### 2. UNIFIED_FORMAT_USAGE.md
- **ê²½ë¡œ**: `CLAUDE_DOCS/DESIGN/UNIFIED_FORMAT_USAGE.md`
- **ë‚´ìš©**:
  - ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ (ì¥ë°”êµ¬ë‹ˆ, ì£¼ë¬¸ì™„ë£Œ, ê´€ë¦¬ì, ê²¬ì ì„œ)
  - ì¶”ì²œ CSS ìŠ¤íƒ€ì¼
  - ì œí’ˆë³„ ì¶œë ¥ ì˜ˆì‹œ
  - ê¸°ì¡´ ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
  - í…ŒìŠ¤íŠ¸ ë°©ë²•
  - ì£¼ì˜ì‚¬í•­

### 3. test_unified_format.php
- **ê²½ë¡œ**: `test_unified_format.php`
- **ë‚´ìš©**:
  - 11ê°œ í’ˆëª© ì „ì²´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
  - ì‹œê°ì  ê²°ê³¼ í™•ì¸ UI
  - ìë™í™”ëœ ê²€ì¦ ë¡œì§
  - ì‹¤ì‹œê°„ pass/fail í‘œì‹œ

---

## ğŸ”§ ì£¼ìš” ìˆ˜ì • ì‚¬í•­

### ProductSpecFormatter.php (ì•½ 180ì¤„ ì¶”ê°€)

1. **formatUnified()** (24ì¤„)
   - Type_1 JSON ìë™ íŒŒì‹±
   - 4ê°œ í—¬í¼ ë©”ì„œë“œ í˜¸ì¶œ
   - 4ì¤„ ë°°ì—´ ë°˜í™˜

2. **buildLine1()** (62ì¤„)
   - í‘œì¤€ í•„ë“œ ìš°ì„  ì‚¬ìš©
   - ì œí’ˆë³„ ë ˆê±°ì‹œ í•„ë“œ í´ë°±
   - íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ ì²˜ë¦¬:
     - ìŠ¤í‹°ì»¤: domusong 0 ì œê±°
     - ì¹´ë‹¤ë¡: slot2 ë¹ˆê°’
     - NCR: slot3 ë¹ˆê°’
     - í¬ìŠ¤í„°: Section/MY_Fsd ìë™ ì„ íƒ

3. **buildLine2()** (42ì¤„)
   - spec_sides ì œí’ˆë³„ ë§¤í•‘
   - quantity_display ìš°ì„  ì‚¬ìš©
   - formatQuantity() í´ë°±

4. **buildLine3()** (8ì¤„)
   - ëŒ€ìƒ ì œí’ˆë§Œ í‘œì‹œ
   - formatAdditionalOptions() ì¬ì‚¬ìš©

5. **buildLine4()** (16ì¤„)
   - í”„ë¦¬ë¯¸ì—„ ì˜µì…˜ ì œí’ˆ
   - ë´‰íˆ¬ ì–‘ë©´í…Œì´í”„ íŠ¹ìˆ˜ ì²˜ë¦¬

---

## ğŸ¨ ì ìš© ì˜ˆì‹œ

### Before (ê¸°ì¡´ format() ì‚¬ìš©)
```php
$result = $specFormatter->format($item);
echo $result['line1'] . '<br>' . $result['line2'];
if (!empty($result['additional'])) {
    echo '<br>' . $result['additional'];
}
```

### After (formatUnified() ì‚¬ìš©)
```php
$unified = $specFormatter->formatUnified($item);
echo $unified['line1'] . '<br>' . $unified['line2'];
if (!empty($unified['line3'])) {
    echo '<br>â• ' . $unified['line3'];
}
if (!empty($unified['line4'])) {
    echo '<br>âœ¨ ' . $unified['line4'];
}
```

---

## âœ… ê²€ì¦ëœ ê¸°ëŠ¥

### 1. í‘œì¤€ í•„ë“œ ìš°ì„  ì‚¬ìš©
- âœ… Phase 3 data_version=2 ë°ì´í„° ì •ìƒ í‘œì‹œ
- âœ… í‘œì¤€ í•„ë“œ ìš°ì„ , ë ˆê±°ì‹œ í´ë°± ë™ì‘

### 2. ë ˆê±°ì‹œ ë°ì´í„° í˜¸í™˜ì„±
- âœ… 10ë§Œ+ ê¸°ì¡´ ì£¼ë¬¸ ë°ì´í„° ì •ìƒ í‘œì‹œ
- âœ… ì²œ ë‹¨ìœ„ ë³€í™˜ (ëª…í•¨ MY_amount=1 â†’ 1,000ë§¤)
- âœ… ì²œ ë‹¨ìœ„ ë³€í™˜ (ë´‰íˆ¬ MY_amount=2 â†’ 2,000ë§¤)
- âœ… ìŠ¤í‹°ì»¤ mesu ì§ì ‘ ì‚¬ìš© (Ã—1000 ì•ˆí•¨)
- âœ… ì „ë‹¨ì§€ ì—° ë‹¨ìœ„ í‘œì‹œ (1ì—° (4,000ë§¤))

### 3. ì œí’ˆë³„ íŠ¹ìˆ˜ ë¡œì§
- âœ… ìŠ¤í‹°ì»¤: domusong "0ì‚¬ê°" â†’ "ì‚¬ê°"
- âœ… ë´‰íˆ¬: POtype_name = ì¸ì‡„ ìƒ‰ìƒ
- âœ… NCR: PN_typeâ†’spec_type, MY_typeâ†’spec_sides (í•„ë“œ ë°˜ëŒ€)
- âœ… ì¹´ë‹¤ë¡: ì¢…ë¥˜ / ê·œê²© (ì¬ì§ˆ ìƒëµ)
- âœ… í¬ìŠ¤í„°: 3ìŠ¬ë¡¯ ì „ì²´ ì‚¬ìš©

### 4. ì¶”ê°€/íŠ¹ìˆ˜ ì˜µì…˜
- âœ… ì „ë‹¨ì§€/ì¹´ë‹¤ë¡/í¬ìŠ¤í„°: ì½”íŒ…, ì ‘ì§€, ì˜¤ì‹œ
- âœ… ëª…í•¨/ìƒí’ˆê¶Œ/NCR: ë°•, ë„˜ë²„ë§, ë¯¸ì‹±, ê·€ëŒì´
- âœ… ë´‰íˆ¬: ì–‘ë©´í…Œì´í”„ ìˆ˜ëŸ‰ í‘œì‹œ

---

## ğŸ“Š ì˜í–¥ ë²”ìœ„

### ì˜í–¥ ë°›ì§€ ì•ŠìŒ (í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€)
- ê¸°ì¡´ `format()` ë©”ì„œë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
- ê¸°ì¡´ í˜ì´ì§€ëŠ” ë³€ê²½ ì—†ì´ ì‘ë™
- ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì—†ìŒ

### ì ìš© ê°€ëŠ¥í•œ í˜ì´ì§€ (ì„ íƒì )
- âœ… ì¥ë°”êµ¬ë‹ˆ (mlangprintauto/shop/shop_cart.php)
- âœ… ì£¼ë¬¸ ì™„ë£Œ (mlangorder_printauto/OrderComplete_universal.php)
- âœ… ê´€ë¦¬ì ì£¼ë¬¸ ëª©ë¡ (admin/order_list.php)
- âœ… ê²¬ì ì„œ (mlangprintauto/quote/create.php)
- âœ… ë§ˆì´í˜ì´ì§€ ì£¼ë¬¸ ë‚´ì—­

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (ì„ íƒ ì‚¬í•­)

1. **ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ì— ì ìš©**
   - `shop_cart.php`ì—ì„œ `formatUnified()` ì‚¬ìš©
   - CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
   - ì‹œê°ì  ê°œì„  í™•ì¸

2. **ì£¼ë¬¸ ì™„ë£Œ í˜ì´ì§€ì— ì ìš©**
   - `OrderComplete_universal.php`ì—ì„œ ì‚¬ìš©
   - 4ì¤„ êµ¬ì¡°ë¡œ ì¼ê´€ì„± í™•ë³´

3. **ê´€ë¦¬ì í˜ì´ì§€ ì ìš©**
   - ì£¼ë¬¸ ëª©ë¡, ì£¼ë¬¸ ìƒì„¸ì—ì„œ ì‚¬ìš©
   - ì¶œë ¥ìš© ë ˆì´ì•„ì›ƒ ê°œì„ 

4. **ê²¬ì ì„œ ì‹œìŠ¤í…œ ì ìš©**
   - ê²¬ì ì„œ ìƒì„± ì‹œ í†µì¼ëœ í˜•ì‹ ì‚¬ìš©
   - PDF ì¶œë ¥ ì‹œ ê°€ë…ì„± í–¥ìƒ

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

### ì‚¬ìš© ë°©ë²•
```php
require_once 'includes/ProductSpecFormatter.php';
$specFormatter = new ProductSpecFormatter($db);
$unified = $specFormatter->formatUnified($item);
```

### ë°˜í™˜ êµ¬ì¡°
```php
[
    'line1' => string,  // í•­ìƒ ì¡´ì¬
    'line2' => string,  // í•­ìƒ ì¡´ì¬
    'line3' => string,  // ë¹ˆ ë¬¸ìì—´ ê°€ëŠ¥
    'line4' => string   // ë¹ˆ ë¬¸ìì—´ ê°€ëŠ¥
]
```

### HTML ì¶œë ¥ ì‹œ ì£¼ì˜
```php
// âŒ XSS ì·¨ì•½
echo $unified['line1'];

// âœ… ì•ˆì „
echo htmlspecialchars($unified['line1']);
```

---

## ğŸ‰ ì™„ë£Œ í™•ì¸

- [x] `formatUnified()` ë©”ì„œë“œ êµ¬í˜„
- [x] `buildLine1()` ~ `buildLine4()` í—¬í¼ ë©”ì„œë“œ êµ¬í˜„
- [x] 11ê°œ í’ˆëª© ì „ì²´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±
- [x] ì „ì²´ í…ŒìŠ¤íŠ¸ í†µê³¼ (11/11)
- [x] ì„¤ê³„ ë¬¸ì„œ ì‘ì„± (UNIFIED_DISPLAY_TEMPLATE.md)
- [x] ì‚¬ìš© ê°€ì´ë“œ ì‘ì„± (UNIFIED_FORMAT_USAGE.md)
- [x] í…ŒìŠ¤íŠ¸ íŒŒì¼ ì‘ì„± (test_unified_format.php)

---

**ì‘ì„±ì**: Claude Code
**ê²€ì¦**: âœ… 11ê°œ í’ˆëª© ì „ì²´ í…ŒìŠ¤íŠ¸ í†µê³¼
**í•˜ìœ„ í˜¸í™˜ì„±**: âœ… ê¸°ì¡´ ì½”ë“œ ì˜í–¥ ì—†ìŒ
**ì ìš© ì¤€ë¹„**: âœ… ì™„ë£Œ
