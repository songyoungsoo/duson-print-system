<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD E2E í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .link-list a {
            display: block;
            padding: 10px 15px;
            margin: 5px 0;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }
        .link-list a:hover {
            background: #5568d3;
        }
        .test-result {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
            font-family: monospace;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Admin System CRUD E2E í…ŒìŠ¤íŠ¸</h1>

    <!-- 1. í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>1. í˜ì´ì§€ ì ‘ê·¼ í…ŒìŠ¤íŠ¸</h2>
        <div class="link-list">
            <a href="index.php" target="_blank">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a>
            <a href="product_manager.php" target="_blank">ğŸ“¦ ì œí’ˆ ê´€ë¦¬ ë©”ì¸</a>
            <a href="product_manager.php?product=namecard" target="_blank">ğŸ’³ ëª…í•¨ ê´€ë¦¬</a>
            <a href="product_manager.php?product=inserted" target="_blank">ğŸ“„ ì „ë‹¨ì§€ ê´€ë¦¬</a>
            <a href="order_manager.php" target="_blank">ğŸ“‹ ì£¼ë¬¸ ê´€ë¦¬</a>
        </div>
    </div>

    <!-- 2. API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>2. API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testAPI('get')">GET API í…ŒìŠ¤íŠ¸</button>
        <button onclick="testAPI('config')">Config API í…ŒìŠ¤íŠ¸</button>
        <button onclick="testAPI('categories')">Categories API í…ŒìŠ¤íŠ¸</button>
        <div id="api-result" class="test-result" style="display:none;"></div>
    </div>

    <!-- 3. ì œí’ˆ ì¡°íšŒ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>3. ì œí’ˆ ì¡°íšŒ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testProductList('namecard')">ëª…í•¨ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ</button>
        <button onclick="testProductList('inserted')">ì „ë‹¨ì§€ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ</button>
        <button onclick="testProductView(1)">ëª…í•¨ ìƒì„¸ ì¡°íšŒ (ID:1)</button>
        <div id="product-result" class="test-result" style="display:none;"></div>
    </div>

    <!-- 4. ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
        <h2>4. ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <input type="text" id="search-keyword" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" style="padding: 8px; width: 200px;">
        <button onclick="testSearch()">ê²€ìƒ‰ ì‹¤í–‰</button>
        <div id="search-result" class="test-result" style="display:none;"></div>
    </div>

    <!-- 5. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½ -->
    <div class="test-section">
        <h2>5. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h2>
        <div id="summary" class="test-result"></div>
    </div>

    <script>
        let testResults = {
            passed: 0,
            failed: 0
        };

        // API í…ŒìŠ¤íŠ¸
        async function testAPI(type) {
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...';

            try {
                let url, body;

                if (type === 'get') {
                    url = 'api/product_crud.php';
                    body = JSON.stringify({
                        action: 'get',
                        product: 'namecard',
                        id: 1
                    });
                } else if (type === 'config') {
                    url = 'api/get_product_config.php?product=namecard';
                    const response = await fetch(url);
                    const data = await response.json();
                    resultDiv.innerHTML = `<span class="success">âœ… ì„±ê³µ</span><br>` + JSON.stringify(data, null, 2);
                    testResults.passed++;
                    updateSummary();
                    return;
                } else if (type === 'categories') {
                    url = 'api/get_categories.php?product=namecard&selector=MY_type';
                    const response = await fetch(url);
                    const data = await response.json();
                    resultDiv.innerHTML = `<span class="success">âœ… ì„±ê³µ</span><br>` + JSON.stringify(data, null, 2);
                    testResults.passed++;
                    updateSummary();
                    return;
                }

                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: body
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">âœ… ì„±ê³µ</span><br>` + JSON.stringify(data, null, 2);
                    testResults.passed++;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ì‹¤íŒ¨</span><br>` + data.message;
                    testResults.failed++;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ì˜¤ë¥˜</span><br>` + error.message;
                testResults.failed++;
            }

            updateSummary();
        }

        // ì œí’ˆ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
        async function testProductList(product) {
            const resultDiv = document.getElementById('product-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ì¡°íšŒ ì¤‘...';

            try {
                const response = await fetch(`product_manager.php?product=${product}`);
                const html = await response.text();

                if (html.includes('ì œí’ˆ ê´€ë¦¬') || html.includes(product)) {
                    resultDiv.innerHTML = `<span class="success">âœ… ${product} ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì„±ê³µ</span><br>í˜ì´ì§€ ë¡œë“œë¨`;
                    testResults.passed++;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ì¡°íšŒ ì‹¤íŒ¨</span>`;
                    testResults.failed++;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ì˜¤ë¥˜</span><br>` + error.message;
                testResults.failed++;
            }

            updateSummary();
        }

        // ì œí’ˆ ìƒì„¸ ì¡°íšŒ
        async function testProductView(id) {
            const resultDiv = document.getElementById('product-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ì¡°íšŒ ì¤‘...';

            try {
                const response = await fetch(`product_manager.php?product=namecard&action=view&id=${id}`);
                const html = await response.text();

                if (html.includes('ìƒì„¸ ì •ë³´') || html.includes('ID: ' + id)) {
                    resultDiv.innerHTML = `<span class="success">âœ… ëª…í•¨ ìƒì„¸ ì¡°íšŒ ì„±ê³µ (ID: ${id})</span>`;
                    testResults.passed++;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ì¡°íšŒ ì‹¤íŒ¨</span>`;
                    testResults.failed++;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ì˜¤ë¥˜</span><br>` + error.message;
                testResults.failed++;
            }

            updateSummary();
        }

        // ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
        async function testSearch() {
            const keyword = document.getElementById('search-keyword').value;
            const resultDiv = document.getElementById('search-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ê²€ìƒ‰ ì¤‘...';

            try {
                const response = await fetch(`product_manager.php?product=namecard&search=${encodeURIComponent(keyword)}`);
                const html = await response.text();

                if (html.includes('ê²€ìƒ‰') || html.includes(keyword)) {
                    resultDiv.innerHTML = `<span class="success">âœ… ê²€ìƒ‰ ì„±ê³µ</span><br>í‚¤ì›Œë“œ: "${keyword}"`;
                    testResults.passed++;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ ê²€ìƒ‰ ì‹¤íŒ¨</span>`;
                    testResults.failed++;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ ì˜¤ë¥˜</span><br>` + error.message;
                testResults.failed++;
            }

            updateSummary();
        }

        // ê²°ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            const total = testResults.passed + testResults.failed;
            const passRate = total > 0 ? Math.round((testResults.passed / total) * 100) : 0;

            summaryDiv.innerHTML = `
                <strong>í…ŒìŠ¤íŠ¸ ê²°ê³¼:</strong><br>
                ì „ì²´: ${total}ê±´<br>
                <span class="success">ì„±ê³µ: ${testResults.passed}ê±´</span><br>
                <span class="error">ì‹¤íŒ¨: ${testResults.failed}ê±´</span><br>
                í†µê³¼ìœ¨: ${passRate}%
            `;
        }

        // ì´ˆê¸° ìš”ì•½ í‘œì‹œ
        updateSummary();
    </script>
</body>
</html>
