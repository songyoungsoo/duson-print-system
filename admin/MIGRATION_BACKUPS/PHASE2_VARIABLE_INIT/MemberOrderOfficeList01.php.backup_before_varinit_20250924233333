<?php
declare(strict_types=1);
if($mode=="ChickBoxAll"){ // 배송완료처리 

include"../../db.php";

if ( !$check ) {
echo ("<script language=javascript>
window.alert('삭제 [처리]할 체크항목이 없습니다.\\n\\n[삭제] 처리할 것을 체크하여 주십시요.');
history.go(-1);
</script>
");
exit;
}


for($i=0;$i<count($check);$i++) {

	// 업데이트 ImgFolder  로 다중업로드형식으로 변경하였다... 수정해야 한다.					 	
	//$Mlang_DIR = opendir("../../MlangOrder_PrintAuto/upload/$check[$i]"); // upload 폴더 OPEN
	//while($ufiles = readdir($Mlang_DIR)) {
		//if(($ufiles != ".") && ($ufiles != "..")) {
		//	unlink("../../MlangOrder_PrintAuto/upload/$check[$i]/$ufiles"); // 파일들 삭제
		//}
	//}
	//closedir($Mlang_DIR);

	//rmdir("../../MlangOrder_PrintAuto/upload/$check[$i]");  // upload 폴더 삭제


$qry="delete from MlangPrintAuto_MemberOrderOffice where no='$check[$i]'";
mysqli_query($db, $qry);
}

mysqli_close($db);

          echo ("<script language=javascript>
          window.alert('체크한 항목을 정상적으로 [삭제] 처리 하였습니다..');
           </script>
           <meta http-equiv='Refresh' content='0; URL=$PHP_SELF'>
            ");
            exit;

} ////////////////////////////////////////////////////////////////////////////////////////////////////////


if($mode=="delete"){

include"../../db.php";
$result = mysqli_query($db, "DELETE FROM MlangPrintAuto_MemberOrderOffice WHERE no='$no'");

	echo ("
		<script language=javascript>
		alert('$no 번의 자료을 정상적으로 삭제 하였습니다.');
        opener.parent.location.reload();
        window.self.close();
		</script>
	");
mysqli_close($db);

exit;
} //////////////////////////////////////////////////////////////////////////////////////////////////////////////


$M123="..";
include"../top.php"; 

echo ("<script language=javascript>
window.alert('현페이지 [주문자 접수일보] 의 프로그램은 테스트 해보실수 있습니다.\\n\\n그러나 현 프로그램은 1차  제작자의 의뢰에 맞추어 제작 하엿음으로\\n\\n사용여부에 대하여서는 별도로 협의하셔야 합니다.');
</script>
");
	
?>

<head>

<script>
function popUp(L, e) {
if(n4) {
var barron = document.layers[L]
barron.left = e.pageX 
barron.top = e.pageY + 5
barron.visibility = "visible"
}
else if(e4) {
var barron = document.all[L]
barron.style.pixelLeft = event.clientX + document.body.scrollLeft 
barron.style.pixelTop = event.clientY + document.body.scrollTop + 5
barron.style.visibility = "visible"
}
}
function popDown(L) {
if(n4) document.layers[L].visibility = "hidden"
else if(e4) document.all[L].style.visibility = "hidden"
}
n4 = (document.layers) ? 1 : 0
e4 = (document.all) ? 1 : 0
</script>

<script>
function allcheck(MemoPlusecheckForm) { 
for( var i=0; i<MemoPlusecheckForm.elements.length; i++) { 
var check = MemoPlusecheckForm.elements[i]; 
check.checked = true; 
} 
return; 
} 

function uncheck(MemoPlusecheckForm) { 
for( var i=0; i<MemoPlusecheckForm.elements.length; i++) { 
var check = MemoPlusecheckForm.elements[i]; 
check.checked = false; 
} 
return; 
} 

function DelGCheckField(){
if (confirm('자료을 삭제처리 하시려 하십니다....\n\n한번 삭제한 자료는 복구 되지 않으니 신중을 기해주세요.............!!')){
document.MemoPlusecheckForm.action="<?=$PHP_SELF?>";
document.MemoPlusecheckForm.submit(); 
} 
}
</script>

<SCRIPT LANGUAGE=JAVASCRIPT src='../js/exchange.js'></SCRIPT>

</head>


<table border=0 align=center width=100% cellpadding='8' cellspacing='3' class='coolBar'>
<tr>
<td align=left>

<?$CateFF="style='font-size:10pt; background-color:#429EB2; color:#FFFFFF;' selected";?>

   <table border=0 cellpadding=2 cellspacing=0 width=100%> 
     <tr>
	    <form method='post' name='TDsearch' OnSubmit='javascript:return TDsearchCheckField()' action='<?=$PHP_SELF?>'>
	    <td align=left>
&nbsp;날짜검색 :&nbsp;
<input type='text' name='YearOne' size='10' onClick="Calendar(this);" value='<?=$YearOne?>'>
~
<input type='text' name='YearTwo' size='10' onClick="Calendar(this);" value='<?=$YearTwo?>'>
&nbsp;&nbsp;
<select name='Type'>
<option value='One_1' <?if($Type=="inserted"){echo("$CateFF");}?>>작성자</option>
<option value='One_3' <?if($Type=="sticker"){echo("$CateFF");}?>>업체명</option>
</select>
		&nbsp;&nbsp;<b>검색어 :&nbsp;</b>
        <input type='text' name='TDsearchValue' size='30'>
        <input type='submit' value=' 검 색 '>
		<?if($Type){?>
		<input type='button' onClick="javascript:window.location='<?=$PHP_SELF?>';" value='처음으로..'>
		<?}?>
	    </td>
		</form>
	 </tr>
  </table>

</td>
	 <td align=right>
	 <input type='button' onClick="javascript:popup=window.open('./MemberOrderOffice/int.php?mode=bizinfo', 'MViertbizinfo','width=450,height=300,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no'); popup.focus();" value='사업자정보'>
	 <input type='button' onClick="javascript:popup=window.open('./MemberOrderOffice/admin.php?mode=form', 'MViertWSubmitr','width=650,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no'); popup.focus();" value=' 신자료 입력 '>
	 </td>
</tr>
</table>

<!------------------------------------------- 리스트 시작----------------------------------------->
<table border=0 align=center width=100% cellpadding='5' cellspacing='1' class='coolBar'>
<tr>
<td align=center>번호</td>
<td align=center>작성자</td>
<td align=center>업체명</td>
<td align=center>업체구분</td>
<td align=center>등록일</td>
<td align=center>관리</td>
</tr>

<form method='post' name='MemoPlusecheckForm'>
<INPUT TYPE="hidden" name='mode' value='ChickBoxAll'>

<?
function Error($msg) {
echo ("<script language=javascript>
window.alert('$msg');
history.go(-1);
</script>
");
exit;
}

include"../../db.php";
$table="MlangPrintAuto_MemberOrderOffice";

if($Type){ // 검색어 값

if($YearOne){ if(!$YearTwo){ $msg="날짜 검색을 하시려면  ~ 이전 의 값을 입력해 주셔야 합니다."; Error($msg); }  }
if($YearTwo){ if(!$YearOne){ $msg="날짜 검색을 하시려면  ~ 이후 의 값을 입력해 주셔야 합니다."; Error($msg); }  }

        if($YearOne || $YearTwo){ $YearOneOk=$YearOne." 00:00:00";  $YearTwoOk=$YearTwo." 00:00:00"; 
		   $Mlang_query="select * from $table where date > '$YearOneOk' and date < '$YearTwoOk' and $Type like '%$TDsearchValue%'";
		  }else{
		    $Mlang_query="select * from $table where $Type like '%$TDsearchValue%'";
		}	             

}else{ // 일반모드 일때
$Mlang_query="select * from $table";
}

$query= mysqli_query($db, "$Mlang_query",$db);
$recordsu= mysql_num_rows($query);
$total = mysql_affected_rows();

$listcut= 20;  //한 페이지당 보여줄 목록 게시물수. 
if(!$offset) $offset=0; 

if($CountWW){
$result= mysqli_query($db, "$Mlang_query order by $CountWW $s limit $offset,$listcut",$db);
}else{
$result= mysqli_query($db, "$Mlang_query order by NO desc limit $offset,$listcut",$db);
}

$rows=mysql_num_rows($result);
if($rows){


while($row= mysqli_fetch_array($result)) 
{ 
?>


<tr bgcolor='#575757'>
<td align=center>
&nbsp;
<?if($row[OrderStyle]=="5"){}else{?>
<input type=checkbox name=check[] value='<?=$row[no]?>'>
<?}?>
<font color=white><?=$row[no]?></font>
&nbsp;
</td>
<td align=center><font color=white><?=htmlspecialchars($row[One_1]);?></font></td>
<td align=center><font color=white><?=htmlspecialchars($row[One_3]);?></font></td>
<td align=center><font color=white>
<?if($row[One_2]=="1"){?>신규업체<?}?>
<?if($row[One_2]=="2"){?>거래업체<?}?>
<?if($row[One_2]=="3"){?>하청<?}?>
</font></td>
<td align=center><font color=white><?=htmlspecialchars($row[date]);?></font></td>
<td align=center>
<input type='button' onClick="javascript:popup=window.open('./MemberOrderOffice/admin.php?mode=form&code=fff&no=<?=$row[no]?>', 'MViertWSubmitr','width=650,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no');" value='복제등록'>
<input type='button' onClick="javascript:popup=window.open('./MemberOrderOffice/admin.php?mode=form&code=Print&no=<?=$row[no]?>', 'MViertWSubmitr','width=650,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no');" value='인쇄모드'>
<input type='button' onClick="javascript:popup=window.open('./MemberOrderOffice/admin.php?mode=form&code=modify&no=<?=$row[no]?>', 'MViertWmodify','width=650,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no'); popup.focus();" value='수정'>
</td>
</tr>

<?
		$i=$i+1;
} 


}else{

if($TDsearchValue){ // 회원 간단검색 TDsearch //  TDsearchValue
echo"<tr><td colspan=10><p align=center><BR><BR>$TDsearch 로 검색되는 $TDsearchValue - 관련 검색 자료없음</p></td></tr>";
}else if($OrderCate){
echo"<tr><td colspan=10><p align=center><BR><BR>$cate 로 검색되는 - 관련 검색 자료없음</p></td></tr>";
}else{
echo"<tr><td colspan=10><p align=center><BR><BR>등록 자료없음</p></td></tr>";
}

}

?>

<tr><td colspan=12 height=10></td</tr>
</table>

     <table border=0 align=center width=100% cellpadding=0 cellspacing=0>
       <tr>
         <td>
<input type='button' onClick="javascript:allcheck(MemoPlusecheckForm);" value=' 전 체 선 택 '><input type='button' onClick="javascript:uncheck(MemoPlusecheckForm);" value=' 선 택 해 제 '><input type='button' onClick="javascript:DelGCheckField();" value=' 체크항목 삭 제 '>
		 </td>
       </tr>
	   </form>
     </table>



<p align='center'>

<?
if($rows){

if($TDsearchValue){
$mlang_pagego="TDsearch=$TDsearch&TDsearchValue=$TDsearchValue"; // 필드속성들 전달값
}else if($OrderStyleYU9OK){
$mlang_pagego="OrderStyleYU9OK=$OrderStyleYU9OK"; // 필드속성들 전달값
}else if($OrderCate){
$mlang_pagego="OrderCate=$OrderCate"; // 필드속성들 전달값
}else{}

$pagecut= 7;  //한 장당 보여줄 페이지수 
$one_bbs= $listcut*$pagecut;  //한 장당 실을 수 있는 목록(게시물)수 
$start_offset= intval($offset/$one_bbs)*$one_bbs;  //각 장에 처음 페이지의 $offset값. 
$end_offset= intval($recordsu/$one_bbs)*$one_bbs;  //마지막 장의 첫페이지의 $offset값. 
$start_page= intval($start_offset/$listcut)+1; //각 장에 처음 페이지의 값. 
$end_page= ($recordsu%$listcut>0)? intval($recordsu/$listcut)+1: intval($recordsu/$listcut); 
//마지막 장의 끝 페이지. 
if($start_offset!= 0) 
{ 
  $apoffset= $start_offset- $one_bbs; 
  echo "<a href='$PHP_SELF?offset=$apoffset&$mlang_pagego'>...[이전]</a>&nbsp;"; 
} 

for($i= $start_page; $i< $start_page+$pagecut; $i++) 
{ 
$newoffset= ($i-1)*$listcut; 

if($offset!= $newoffset){
  echo "&nbsp;<a href='$PHP_SELF?offset=$newoffset&$mlang_pagego'>($i)</a>&nbsp;"; 
}else{echo("&nbsp;<font style='font:bold; color:green;'>($i)</font>&nbsp;"); } 

if($i==$end_page) break; 
} 

if($start_offset!= $end_offset) 
{ 
  $nextoffset= $start_offset+ $one_bbs; 
  echo "&nbsp;<a href='$PHP_SELF?offset=$nextoffset&$mlang_pagego'>[다음]...</a>"; 
} 
echo "총목록갯수: $end_page 개"; 


}

mysqli_close($db); 
?> 

</p>
<!------------------------------------------- 리스트 끝----------------------------------------->