<?php
declare(strict_types=1);


// ⚠️  XSS 보호 권장: echo 시 htmlspecialchars() 사용을 고려하세요
// ✅ PHP 7.4 호환: 입력 변수 초기화
$mode = $_GET['mode'] ?? $_POST['mode'] ?? '';
$no = $_GET['no'] ?? $_POST['no'] ?? '';
$search = $_GET['search'] ?? $_POST['search'] ?? '';
$id = $_GET['id'] ?? $_POST['id'] ?? '';
$name = $_GET['name'] ?? $_POST['name'] ?? '';
$code = $_GET['code'] ?? $_POST['code'] ?? '';
$page = $_GET['page'] ?? $_POST['page'] ?? '';

$M123="..";
include"../top.php"; 
?>

<head>
<script>
function clearField(field)
{
	if (field.value == field.defaultValue) {
		field.value = "";
	}
}
function checkField(field)
{
	if (!field.value) {
		field.value = field.defaultValue;
	}
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function Biz_particularsBigDel(no){
	if (confirm(+no+'번 자료를 삭제 하시겠습니까..?\n\n제출처 정보와 거래내역의 모든 자료까지 동시에 다 같이 삭제가 됩니다.\n\n한번 삭제한 자료는 복구 되지 않으니 신중을 기해주세요.............!!')) {
		str='./Biz_particulars/admin.php?no='+no+'&mode=BigDelete';
        popup = window.open("","","scrollbars=no,resizable=yes,width=400,height=50,top=2000,left=2000");
        popup.document.location.href=str;
        popup.focus();
	}
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
</script>

</head>

<?php 
include"../../db.php";
$table="MlangWebOffice_Biz_particulars_admin";

if($TDsearchValue){ // 검색
$Mlang_query="select * from $table where $TDsearch like '%$TDsearchValue%'";
}else{ // 일반모드 일때
$Mlang_query="select * from $table";
}

$query= mysqli_query($db, "$Mlang_query",$db);
$recordsu= mysql_num_rows($query);
$total = mysql_affected_rows();

$listcut= 20;  //한 페이지당 보여줄 목록 게시물수. 
if(!$offset) $offset=0; 
?>


<table border=0 align=center width=100% cellpadding='5' cellspacing='3' class='coolBar'>
<tr>
<td align=left colspan=2>
<font color=red>*</font> 현 페이지는 거래내역서(인쇄)를 목적으로 만들어진 프로그램 입니다.<BR>
<font color=red>*</font> 이용방법 : 제출처 정보 입력하기 클릭 => 제출처, 현장명등... 입력 => 정보자세히보기 클릭 => 거래일자, 장비번호등... 수정가능
</td>
</tr>
<tr>
<td>
   <table border=0 align=center width=100% cellpadding=0 cellspacing=0>
     <tr>
	    <form method='post' name='TDsearch' OnSubmit='javascript:return TDsearchCheckField()' action='<?=$PHP_SELF?>'>
	    <td align=left>
		<b>검색 :&nbsp;</b>
		<select name='TDsearch'>
		<option value='bizname'>현장명</option>
		<option value='ceoname'>제출처</option>
		<option value='ceoname'>담당자</option>
        <input type='text' name='TDsearchValue' size='20'>
        <input type='submit' value=' 검 색 '>
	    </td>
		</form>
	 </tr>
	</table>
</td>
<td align=right valign=bottom>
자료 수-<font style='color:blue;'><b><?=$total?></b></font>&nbsp;개
<input type='button' onClick="javascript:popup=window.open('./Biz_particulars/admin.php?mode=form', 'WebOffice_Biz_particularsForm','width=700,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no'); popup.focus();" value=' 제출처 정보 입력하기 '>
</td>
</tr>
</table>


<!------------------------------------------- 리스트 시작----------------------------------------->
<table border=0 align=center width=100% cellpadding='5' cellspacing='1' class='coolBar'>
<tr>
<td align=center>등록NO</td>
<td align=center>현장명</td>
<td align=center>제출처</td>
<td align=center>담당자</td>
<td align=center>관리기능</td>
</tr>

<?php 
$result= mysqli_query($db, "$Mlang_query order by NO desc limit $offset,$listcut",$db);
$rows=mysql_num_rows($result);
if($rows){


while($row= mysqli_fetch_array($result)) 
{ 
?>

<tr bgcolor='#575757'>
<td align=center><font color=white><?=$row[no]?></font></td>
<td align=center><font color=white><?=$row[a_name]?></font></td>
<td align=center><font color=white><?=$row[b_name]?></font></td>
<td align=center><font color=white>
<?php 
$result_staff=mysqli_query($db, "select * from WebOffice_customer_staff where customer_no=$row[no]",$db);
$total_staff = mysql_affected_rows();
if($result_staff){echo("$total_staff");}else{echo("자료무");}
?>
명</font></td>
<td align=center>
<input type='button' onClick="javascript:popup=window.open('./Biz_particulars/view_list.php?no=<?=$row[no]?>', 'WebOffice_Biz_particularsViewList','width=700,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no'); popup.focus();" value='인쇄 모드'>
<input type='button' onClick="javascript:popup=window.open('./Biz_particulars/admin.php?mode=form&code=modify&no=<?=$row[no]?>', 'WebOffice_Biz_particularsModifyj3','width=700,height=600,top=0,left=0,menubar=no,resizable=no,statusbar=no,scrollbars=yes,toolbar=no'); popup.focus();"value=' 수정 '>
<input type='button' onClick="javascript:Biz_particularsBigDel('<?=$row[no]?>');" value=' 삭제 '>
</td>
<tr>

<?php 
		$i=$i+1;
} 


}else{

if($search){
echo"<tr><td colspan=10><p align=center><BR><BR>관련 검색 자료없음</p></td></tr>";
}else{
echo"<tr><td colspan=10><p align=center><BR><BR>등록 자료없음</p></td></tr>";
}

}

?>


</table>



<p align='center'>

<?php 
if($rows){

$mlang_pagego="cate=$cate$title_search=$title_search"; // 필드속성들 전달값

$pagecut= 7;  //한 장당 보여줄 페이지수 
$one_bbs= $listcut*$pagecut;  //한 장당 실을 수 있는 목록(게시물)수 
$start_offset= intval($offset/$one_bbs)*$one_bbs;  //각 장에 처음 페이지의 $offset값. 
$end_offset= intval($recordsu/$one_bbs)*$one_bbs;  //마지막 장의 첫페이지의 $offset값. 
$start_page= intval($start_offset/$listcut)+1; //각 장에 처음 페이지의 값. 
$end_page= ($recordsu%$listcut>0)? intval($recordsu/$listcut)+1: intval($recordsu/$listcut); 
//마지막 장의 끝 페이지. 
if($start_offset!= 0) 
{ 
  $apoffset= $start_offset- $one_bbs; 
  echo "<a href='$PHP_SELF?offset=$apoffset&$mlang_pagego'>...[이전]</a>&nbsp;"; 
} 

for($i= $start_page; $i< $start_page+$pagecut; $i++) 
{ 
$newoffset= ($i-1)*$listcut; 

if($offset!= $newoffset){
  echo "&nbsp;<a href='$PHP_SELF?offset=$newoffset&$mlang_pagego'>($i)</a>&nbsp;"; 
}else{echo("&nbsp;<font style='font:bold; color:green;'>($i)</font>&nbsp;"); } 

if($i==$end_page) break; 
} 

if($start_offset!= $end_offset) 
{ 
  $nextoffset= $start_offset+ $one_bbs; 
  echo "&nbsp;<a href='$PHP_SELF?offset=$nextoffset&$mlang_pagego'>[다음]...</a>"; 
} 
echo "총목록갯수: $end_page 개"; 


}

mysqli_close($db); 
?> 

</p>
<!------------------------------------------- 리스트 끝----------------------------------------->

<?php 
include"../down.php";
?>