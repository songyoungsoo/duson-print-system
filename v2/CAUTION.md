# V2 개발 주의사항 (AI 협업 시 필독)

> 이 문서는 AI와 협업하여 개발할 때 반드시 지켜야 할 사항을 기록합니다.
> 실제 발생한 문제를 바탕으로 작성되었습니다.

---

## 1. 하드코딩 금지 - DB 데이터는 반드시 DB에서 가져올 것

### 발생한 문제 (2025-01-26)

**파일**: `src/Services/AI/ChatbotService.php`

```php
// ❌ 잘못된 코드 - AI가 추측으로 하드코딩
$lines[] = "4단계 - 수량: 0.5연(250매), 1연(500매), 2연(1000매)... (1연=500매)";
```

**실제 DB 데이터**:
| 규격 | 1연당 매수 |
|------|-----------|
| 국2절 | 1,000매 |
| A3 | 2,000매 |
| A4 | 4,000매 |
| A5 | 8,000매 |
| A6 | 16,000매 |

→ "1연=500매"는 **완전히 틀린 정보**였음

### 왜 이런 일이 발생했는가?

1. **AI 할루시네이션 (Hallucination)**
   - AI가 학습 데이터에서 "인쇄 1연 = 500매"라는 패턴을 봄
   - DB 확인 없이 "그럴듯한" 값을 자신있게 작성
   
2. **검증 단계 생략**
   - DB에서 실제 데이터를 조회하지 않음
   - 인쇄업계 "일반 상식"이라고 가정

### 올바른 방법

```php
// ✅ 올바른 코드 - DB에서 실제 데이터 조회
$sql = "SELECT DISTINCT Section, quantity, quantityTwo 
        FROM mlangprintauto_inserted";
$result = mysqli_query($this->db, $sql);
// ... 실제 데이터로 출력
```

---

## 2. AI 협업 시 검증 체크리스트

### 코드 작성 전

- [ ] 수치/데이터가 포함된 경우 → **DB 또는 원본 소스 먼저 확인**
- [ ] "업계 표준", "일반적으로" 같은 가정 → **실제 데이터로 검증**
- [ ] 하드코딩이 필요한 경우 → **왜 하드코딩인지 주석으로 명시**

### 코드 리뷰 시

- [ ] 하드코딩된 숫자/문자열이 있는가?
- [ ] 그 값의 출처가 명확한가?
- [ ] DB에서 가져올 수 있는 데이터를 하드코딩하지 않았는가?

---

## 3. AI가 틀릴 수 있는 영역

| 영역 | 위험도 | 이유 |
|------|--------|------|
| **업계 특화 데이터** | 🔴 높음 | 인쇄업계 특수 용어/단위는 일반 학습 데이터와 다를 수 있음 |
| **회사 내부 규칙** | 🔴 높음 | 두손기획인쇄만의 가격 체계, 단위 기준 |
| **DB 스키마 해석** | 🟡 중간 | 컬럼명만 보고 의미 추측 가능 |
| **일반 프로그래밍** | 🟢 낮음 | 표준화된 영역 |

---

## 4. 이 프로젝트의 데이터 원칙

### V1 DB가 진실의 원천 (Single Source of Truth)

```
/var/www/html/db.php          → DB 연결
/var/www/html/config.env.php  → DB 설정 (dsp1830/ds701018)
```

### 주요 테이블과 신뢰할 수 있는 데이터

| 테이블 | 신뢰할 수 있는 컬럼 |
|--------|---------------------|
| `mlangprintauto_namecard` | style, Section, quantity, money, DesignMoney, POtype |
| `mlangprintauto_inserted` | style, Section, quantity, quantityTwo, money |
| `mlangprintauto_transactioncate` | no, title, Ttable, BigNo, TreeNo |

### 절대 추측하면 안 되는 것

- 가격 (money, DesignMoney)
- 수량 단위 (quantity, quantityTwo)
- 옵션 이름 (title)
- 제품 카테고리 구조 (BigNo, TreeNo)

---

## 5. 문제 발생 시 대응

### AI가 잘못된 정보를 넣었을 때

1. **즉시 수정** - 잘못된 하드코딩 제거
2. **DB 조회로 대체** - 실제 데이터 사용
3. **이 문서에 기록** - 같은 실수 방지

### 의심스러운 코드 발견 시

```bash
# 하드코딩된 숫자 찾기
grep -rn "[0-9]\{3,\}매\|[0-9]\{3,\}원\|[0-9]연=" /var/www/html/v2/src/

# DB 조회 없이 가격/수량 출력하는 코드 찾기
grep -rn "lines\[\].*=" /var/www/html/v2/src/Services/AI/
```

---

## 변경 이력

| 날짜 | 내용 | 작성자 |
|------|------|--------|
| 2025-01-26 | 최초 작성 - 전단지 연수/매수 하드코딩 문제 | AI (Claude) |

---

> **핵심 원칙**: AI가 "알고 있다"고 하는 것도 DB로 검증하라.
> 
> 컴퓨터는 추측하지 않지만, AI는 추측한다. 그리고 그 추측은 틀릴 수 있다.
